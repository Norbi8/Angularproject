import{a as vh,b as wh,c as ca,d as Ih,e as Si,f as ua,g as $r,h as Eh,i as Th,j as la,k as nt,l as Ri,m as Wt,n as Wr,o as Di,p as ha,q as bh,r as Qr,s as Hr,t as ue,u as Qt}from"./chunk-BB7XAQ6R.js";import{Aa as kn,Ab as gh,Ba as sa,C as ta,Ca as mh,E as ea,G as lh,Ga as Te,I as hh,Ma as vt,Mb as aa,N as na,O as zr,P as dh,Q as Je,R as ia,S as Gr,T as ra,Vb as ce,X as et,Xa as ph,Y as Dt,_ as lt,aa as P,ba as Kt,c as we,ca as fh,f as He,fa as $t,fc as _h,g as rh,gc as yh,h as sh,ha as Ct,i as oh,ia as Ai,k as ae,l as Ye,m as Jo,n as Xe,r as Ie,s as ah,v as ch,va as Ee,wa as Kr,y as uh,z as Zo,zb as oa}from"./chunk-OZSVB7QB.js";import{a as bt,e as Xo,f as g}from"./chunk-CQCHLVVT.js";var _g="firebase",yg="10.10.0";ue(_g,yg,"app");var Xr=new oa("ANGULARFIRE2_VERSION");function Bw(n,t,e){if(t){if(t.length===1)return t[0];let s=t.filter(o=>o.app===e);if(s.length===1)return s[0]}return e.container.getProvider(n).getImmediate({optional:!0})}var vg=(n,t)=>{let e=t?[t]:Hr(),i=[];return e.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Ci=class{constructor(){return vg(wg)}},wg="app-check";function xn(){}var Yr=class{zone;delegate;constructor(t,e=oh){this.zone=t,this.delegate=e}now(){return this.delegate.now()}schedule(t,e,i){let r=this.zone,s=function(o){r.runGuarded(()=>{t.apply(this,[o])})};return this.delegate.schedule(s,e,i)}},da=class{zone;task=null;constructor(t){this.zone=t}call(t,e){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",xn,{},xn,xn)),e.pipe(ra({next:i,complete:i,error:i})).subscribe(t).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ah=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new Yr(Zone.current)),this.insideAngular=e.run(()=>new Yr(Zone.current,sh)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(P(vt))};static \u0275prov=et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ki(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Ig(n){return ki().ngZone.runOutsideAngular(()=>n())}function Ze(n){return ki().ngZone.run(()=>n())}function jw(n){return n.pipe(ae(ki().outsideAngular))}function fa(n){return Eg(ki())(n)}function Eg(n){return function(e){return e=e.lift(new da(n.ngZone)),e.pipe(Ye(n.outsideAngular),ae(n.insideAngular))}}var Tg=(n,t)=>function(){let i=arguments;return t&&setTimeout(()=>{t.state==="scheduled"&&t.invoke()},10),Ze(()=>n.apply(void 0,i))},Uw=(n,t)=>function(){let e,i=arguments;for(let s=0;s<arguments.length;s++)typeof i[s]=="function"&&(t&&(e||=Ze(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",xn,{},xn,xn))),i[s]=Tg(i[s],e));let r=Ig(()=>n.apply(this,i));if(!t)if(r instanceof we){let s=ki();return r.pipe(Ye(s.outsideAngular),ae(s.insideAngular))}else return Ze(()=>r);return r instanceof we?r.pipe(fa):r instanceof Promise?Ze(()=>new Promise((s,o)=>r.then(a=>Ze(()=>s(a)),a=>Ze(()=>o(a))))):typeof r=="function"&&e?function(){return setTimeout(()=>{e&&e.state==="scheduled"&&e.invoke()},10),r.apply(this,arguments)}:Ze(()=>r)};var Ag="firebase",Sg="10.10.0";Qt.registerVersion(Ag,Sg,"app-compat");var Rg=["ngOnDestroy"],Rh=(n,t,e,i={})=>new Proxy(n,{get:(r,s)=>e.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(Rg.indexOf(s)>-1)return()=>{};let o=t.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>e.run(()=>u)):e.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(l=>{let h=l?.(...u);return i?.spy?.apply&&i.spy.apply(s,u,h),h})})})});var Jr=class{constructor(t){return t}},Zr=new lt("angularfire2.app.options"),ts=new lt("angularfire2.app.name");function ma(n,t,e){let i=typeof e=="string"&&e||"[DEFAULT]",r=typeof e=="object"&&e||{};r.name=r.name||i;let o=Qt.apps.filter(a=>a&&a.name===r.name)[0]||t.runOutsideAngular(()=>Qt.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Dg("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Jr(o)}var Dg=(n,...t)=>{aa()&&typeof console<"u"&&console[n](...t)},Cg={provide:Jr,useFactory:ma,deps:[Zr,vt,[new fh,ts]]},Yw=(()=>{class n{static initializeApp(e,i){return{ngModule:n,providers:[{provide:Zr,useValue:e},{provide:ts,useValue:i}]}}constructor(e){Qt.registerVersion("angularfire",Xr.full,"core"),Qt.registerVersion("angularfire",Xr.full,"app-compat"),Qt.registerVersion("angular",gh.full,e.toString())}static \u0275fac=function(i){return new(i||n)(P(kn))};static \u0275mod=Ct({type:n});static \u0275inj=Dt({providers:[Cg]})}return n})();function Dh(n,t,e,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return kg(r,o)||(Sh("error",`${t} was already initialized on the ${e} Firebase App with different settings.${xg?" You may need to reload as Firebase is not HMR aware.":""}`),Sh("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function kg(n,t){try{return n.toString()===t.toString()}catch{return n===t}}var xg=typeof module<"u"&&!!module.hot,Sh=(n,...t)=>{aa()&&typeof console<"u"&&console[n](...t)};globalThis.\u0275AngularfireInstanceCache||=[];var Vg=new lt("cdk-dir-doc",{providedIn:"root",factory:Mg});function Mg(){return Kt(ce)}var Og=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Fg(n){let t=n?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?Og.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var aI=(()=>{let t=class t{constructor(i){if(this.value="ltr",this.change=new Kr,i){let r=i.body?i.body.dir:null,s=i.documentElement?i.documentElement.dir:null;this.value=Fg(r||s||"ltr")}}ngOnDestroy(){this.change.complete()}};t.\u0275fac=function(r){return new(r||t)(P(Vg,8))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var pa=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ct({type:t}),t.\u0275inj=Dt({});let n=t;return n})();var _a;try{_a=typeof Intl<"u"&&Intl.v8BreakIterator}catch{_a=!1}var Lt=(()=>{let t=class t{constructor(i){this._platformId=i,this.isBrowser=this._platformId?_h(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||_a)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};t.\u0275fac=function(r){return new(r||t)(P(kn))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Pn,Ch=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function mI(){if(Pn)return Pn;if(typeof document!="object"||!document)return Pn=new Set(Ch),Pn;let n=document.createElement("input");return Pn=new Set(Ch.filter(t=>(n.setAttribute("type",t),n.type===t))),Pn}var xi;function Lg(){if(xi==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>xi=!0}))}finally{xi=xi||!1}return xi}function Nn(n){return Lg()?n:!!n.capture}var ga;function Bg(){if(ga==null){let n=typeof document<"u"?document.head:null;ga=!!(n&&(n.createShadowRoot||n.attachShadow))}return ga}function kh(n){if(Bg()){let t=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function Ae(n){return n.composedPath?n.composedPath()[0]:n.target}function xh(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function jg(n){return n!=null&&`${n}`!="false"}function Ug(n,t=0){return qg(n)?Number(n):t}function qg(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function va(n){return Array.isArray(n)?n:[n]}function tn(n){return n instanceof Ee?n.nativeElement:n}var zg=(()=>{let t=class t{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var _I=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ct({type:t}),t.\u0275inj=Dt({providers:[zg]});let n=t;return n})();var Nh=new Set,en,Gg=(()=>{let t=class t{constructor(i,r){this._platform=i,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):$g}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&Kg(i,this._nonce),this._matchMedia(i)}};t.\u0275fac=function(r){return new(r||t)(P(Lt),P(mh,8))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function Kg(n,t){if(!Nh.has(n))try{en||(en=document.createElement("style"),t&&(en.nonce=t),en.setAttribute("type","text/css"),document.head.appendChild(en)),en.sheet&&(en.sheet.insertRule(`@media ${n} {body{ }}`,0),Nh.add(n))}catch(e){console.error(e)}}function $g(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var Mh=(()=>{let t=class t{constructor(i,r){this._mediaMatcher=i,this._zone=r,this._queries=new Map,this._destroySubject=new He}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return Vh(va(i)).some(s=>this._registerQuery(s).mql.matches)}observe(i){let s=Vh(va(i)).map(a=>this._registerQuery(a).observable),o=ah(s);return o=ch(o.pipe(ea(1)),o.pipe(zr(1),ta(0))),o.pipe(Ie(a=>{let c={matches:!1,breakpoints:{}};return a.forEach(({matches:u,query:l})=>{c.matches=c.matches||u,c.breakpoints[l]=u}),c}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);let r=this._mediaMatcher.matchMedia(i),o={observable:new we(a=>{let c=u=>this._zone.run(()=>a.next(u));return r.addListener(c),()=>{r.removeListener(c)}}).pipe(dh(r),Ie(({matches:a})=>({query:i,matches:a})),Gr(this._destroySubject)),mql:r};return this._queries.set(i,o),o}};t.\u0275fac=function(r){return new(r||t)(P(Gg),P(vt))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function Vh(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Ia(n){return n.buttons===0||n.detail===0}function Ea(n){let t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}var Qg=new lt("cdk-input-modality-detector-options"),Hg={ignoreKeys:[18,17,224,91,16]},Lh=650,Vn=Nn({passive:!0,capture:!0}),Yg=(()=>{let t=class t{get mostRecentModality(){return this._modality.value}constructor(i,r,s,o){this._platform=i,this._mostRecentTarget=null,this._modality=new rh(null),this._lastTouchMs=0,this._onKeydown=a=>{this._options?.ignoreKeys?.some(c=>c===a.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Ae(a))},this._onMousedown=a=>{Date.now()-this._lastTouchMs<Lh||(this._modality.next(Ia(a)?"keyboard":"mouse"),this._mostRecentTarget=Ae(a))},this._onTouchstart=a=>{if(Ea(a)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Ae(a)},this._options=bt(bt({},Hg),o),this.modalityDetected=this._modality.pipe(zr(1)),this.modalityChanged=this.modalityDetected.pipe(lh()),i.isBrowser&&r.runOutsideAngular(()=>{s.addEventListener("keydown",this._onKeydown,Vn),s.addEventListener("mousedown",this._onMousedown,Vn),s.addEventListener("touchstart",this._onTouchstart,Vn)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Vn),document.removeEventListener("mousedown",this._onMousedown,Vn),document.removeEventListener("touchstart",this._onTouchstart,Vn))}};t.\u0275fac=function(r){return new(r||t)(P(Lt),P(vt),P(ce),P(Qg,8))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var ns=function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n}(ns||{}),Xg=new lt("cdk-focus-monitor-default-options"),es=Nn({passive:!0,capture:!0}),tE=(()=>{let t=class t{constructor(i,r,s,o,a){this._ngZone=i,this._platform=r,this._inputModalityDetector=s,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new He,this._rootNodeFocusAndBlurListener=c=>{let u=Ae(c);for(let l=u;l;l=l.parentElement)c.type==="focus"?this._onFocus(c,l):this._onBlur(c,l)},this._document=o,this._detectionMode=a?.detectionMode||ns.IMMEDIATE}monitor(i,r=!1){let s=tn(i);if(!this._platform.isBrowser||s.nodeType!==1)return Xe();let o=kh(s)||this._getDocument(),a=this._elementInfo.get(s);if(a)return r&&(a.checkChildren=!0),a.subject;let c={checkChildren:r,subject:new He,rootNode:o};return this._elementInfo.set(s,c),this._registerGlobalListeners(c),c.subject}stopMonitoring(i){let r=tn(i),s=this._elementInfo.get(r);s&&(s.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(s))}focusVia(i,r,s){let o=tn(i),a=this._getDocument().activeElement;o===a?this._getClosestElementsInfo(o).forEach(([c,u])=>this._originChanged(c,r,u)):(this._setOrigin(r),typeof o.focus=="function"&&o.focus(s))}ngOnDestroy(){this._elementInfo.forEach((i,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return this._detectionMode===ns.EVENTUAL||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,r){i.classList.toggle("cdk-focused",!!r),i.classList.toggle("cdk-touch-focused",r==="touch"),i.classList.toggle("cdk-keyboard-focused",r==="keyboard"),i.classList.toggle("cdk-mouse-focused",r==="mouse"),i.classList.toggle("cdk-program-focused",r==="program")}_setOrigin(i,r=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=i,this._originFromTouchInteraction=i==="touch"&&r,this._detectionMode===ns.IMMEDIATE){clearTimeout(this._originTimeoutId);let s=this._originFromTouchInteraction?Lh:1;this._originTimeoutId=setTimeout(()=>this._origin=null,s)}})}_onFocus(i,r){let s=this._elementInfo.get(r),o=Ae(i);!s||!s.checkChildren&&r!==o||this._originChanged(r,this._getFocusOrigin(o),s)}_onBlur(i,r){let s=this._elementInfo.get(r);!s||s.checkChildren&&i.relatedTarget instanceof Node&&r.contains(i.relatedTarget)||(this._setClasses(r),this._emitOrigin(s,null))}_emitOrigin(i,r){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(r))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;let r=i.rootNode,s=this._rootNodeFocusListenerCount.get(r)||0;s||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,es),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,es)}),this._rootNodeFocusListenerCount.set(r,s+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Gr(this._stopInputModalityDetector)).subscribe(o=>{this._setOrigin(o,!0)}))}_removeGlobalListeners(i){let r=i.rootNode;if(this._rootNodeFocusListenerCount.has(r)){let s=this._rootNodeFocusListenerCount.get(r);s>1?this._rootNodeFocusListenerCount.set(r,s-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,es),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,es),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,r,s){this._setClasses(i,r),this._emitOrigin(s,r),this._lastFocusOrigin=r}_getClosestElementsInfo(i){let r=[];return this._elementInfo.forEach((s,o)=>{(o===i||s.checkChildren&&o.contains(i))&&r.push([o,s])}),r}_isLastInteractionFromInputLabel(i){let{_mostRecentTarget:r,mostRecentModality:s}=this._inputModalityDetector;if(s!=="mouse"||!r||r===i||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA"||i.disabled)return!1;let o=i.labels;if(o){for(let a=0;a<o.length;a++)if(o[a].contains(r))return!0}return!1}};t.\u0275fac=function(r){return new(r||t)(P(vt),P(Lt),P(Yg),P(ce,8),P(Xg,8))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var nn=function(n){return n[n.NONE=0]="NONE",n[n.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",n[n.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",n}(nn||{}),Oh="cdk-high-contrast-black-on-white",Fh="cdk-high-contrast-white-on-black",wa="cdk-high-contrast-active",Bh=(()=>{let t=class t{constructor(i,r){this._platform=i,this._document=r,this._breakpointSubscription=Kt(Mh).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return nn.NONE;let i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);let r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(i):null,o=(s&&s.backgroundColor||"").replace(/ /g,"");switch(i.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return nn.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return nn.BLACK_ON_WHITE}return nn.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let i=this._document.body.classList;i.remove(wa,Oh,Fh),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===nn.BLACK_ON_WHITE?i.add(wa,Oh):r===nn.WHITE_ON_BLACK&&i.add(wa,Fh)}}};t.\u0275fac=function(r){return new(r||t)(P(Lt),P(ce))},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();function Zg(){return!0}var t_=new lt("mat-sanity-checks",{providedIn:"root",factory:Zg}),rs=(()=>{let t=class t{constructor(i,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return xh()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[i]}};t.\u0275fac=function(r){return new(r||t)(P(Bh),P(t_,8),P(ce))},t.\u0275mod=Ct({type:t}),t.\u0275inj=Dt({imports:[pa,pa]});let n=t;return n})();var jh=class{constructor(t,e,i,r,s){this._defaultMatcher=t,this.ngControl=e,this._parentFormGroup=i,this._parentForm=r,this._stateChanges=s,this.errorState=!1}updateErrorState(){let t=this.errorState,e=this._parentFormGroup||this._parentForm,i=this.matcher||this._defaultMatcher,r=this.ngControl?this.ngControl.control:null,s=i?.isErrorState(r,e)??!1;s!==t&&(this.errorState=s,this._stateChanges.next())}};var UE=(()=>{let t=class t{isErrorState(i,r){return!!(i&&i.invalid&&(i.touched||r&&r.submitted))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var qE=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ct({type:t}),t.\u0275inj=Dt({imports:[rs,rs]});let n=t;return n})(),Vt=function(n){return n[n.FADING_IN=0]="FADING_IN",n[n.VISIBLE=1]="VISIBLE",n[n.FADING_OUT=2]="FADING_OUT",n[n.HIDDEN=3]="HIDDEN",n}(Vt||{}),Aa=class{constructor(t,e,i,r=!1){this._renderer=t,this.element=e,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=Vt.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},Uh=Nn({passive:!0,capture:!0}),Sa=class{constructor(){this._events=new Map,this._delegateEventHandler=t=>{let e=Ae(t);e&&this._events.get(t.type)?.forEach((i,r)=>{(r===e||r.contains(e))&&i.forEach(s=>s.handleEvent(t))})}}addHandler(t,e,i,r){let s=this._events.get(e);if(s){let o=s.get(i);o?o.add(r):s.set(i,new Set([r]))}else this._events.set(e,new Map([[i,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,Uh)})}removeHandler(t,e,i){let r=this._events.get(t);if(!r)return;let s=r.get(e);s&&(s.delete(i),s.size===0&&r.delete(e),r.size===0&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,Uh)))}},qh={enterDuration:225,exitDuration:150},e_=800,zh=Nn({passive:!0,capture:!0}),Gh=["mousedown","touchstart"],Kh=["mouseup","mouseleave","touchend","touchcancel"],Pi=class Pi{constructor(t,e,i,r){this._target=t,this._ngZone=e,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=tn(i))}fadeInRipple(t,e,i={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s=bt(bt({},qh),i.animation);i.centered&&(t=r.left+r.width/2,e=r.top+r.height/2);let o=i.radius||n_(t,e,r),a=t-r.left,c=e-r.top,u=s.enterDuration,l=document.createElement("div");l.classList.add("mat-ripple-element"),l.style.left=`${a-o}px`,l.style.top=`${c-o}px`,l.style.height=`${o*2}px`,l.style.width=`${o*2}px`,i.color!=null&&(l.style.backgroundColor=i.color),l.style.transitionDuration=`${u}ms`,this._containerElement.appendChild(l);let h=window.getComputedStyle(l),d=h.transitionProperty,f=h.transitionDuration,I=d==="none"||f==="0s"||f==="0s, 0s"||r.width===0&&r.height===0,v=new Aa(this,l,i,I);l.style.transform="scale3d(1, 1, 1)",v.state=Vt.FADING_IN,i.persistent||(this._mostRecentTransientRipple=v);let w=null;return!I&&(u||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let C=()=>this._finishRippleTransition(v),x=()=>this._destroyRipple(v);l.addEventListener("transitionend",C),l.addEventListener("transitioncancel",x),w={onTransitionEnd:C,onTransitionCancel:x}}),this._activeRipples.set(v,w),(I||!u)&&this._finishRippleTransition(v),v}fadeOutRipple(t){if(t.state===Vt.FADING_OUT||t.state===Vt.HIDDEN)return;let e=t.element,i=bt(bt({},qh),t.config.animation);e.style.transitionDuration=`${i.exitDuration}ms`,e.style.opacity="0",t.state=Vt.FADING_OUT,(t._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){let e=tn(t);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,Gh.forEach(i=>{Pi._eventManager.addHandler(this._ngZone,i,e,this)}))}handleEvent(t){t.type==="mousedown"?this._onMousedown(t):t.type==="touchstart"?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Kh.forEach(e=>{this._triggerElement.addEventListener(e,this,zh)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){t.state===Vt.FADING_IN?this._startFadeOutTransition(t):t.state===Vt.FADING_OUT&&this._destroyRipple(t)}_startFadeOutTransition(t){let e=t===this._mostRecentTransientRipple,{persistent:i}=t.config;t.state=Vt.VISIBLE,!i&&(!e||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){let e=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=Vt.HIDDEN,e!==null&&(t.element.removeEventListener("transitionend",e.onTransitionEnd),t.element.removeEventListener("transitioncancel",e.onTransitionCancel)),t.element.remove()}_onMousedown(t){let e=Ia(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+e_;!this._target.rippleDisabled&&!e&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!Ea(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let e=t.changedTouches;if(e)for(let i=0;i<e.length;i++)this.fadeInRipple(e[i].clientX,e[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{let e=t.state===Vt.VISIBLE||t.config.terminateOnPointerUp&&t.state===Vt.FADING_IN;!t.config.persistent&&e&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let t=this._triggerElement;t&&(Gh.forEach(e=>Pi._eventManager.removeHandler(e,t,this)),this._pointerUpEventsRegistered&&Kh.forEach(e=>t.removeEventListener(e,this,zh)))}};Pi._eventManager=new Sa;var Ra=Pi;function n_(n,t,e){let i=Math.max(Math.abs(n-e.left),Math.abs(n-e.right)),r=Math.max(Math.abs(t-e.top),Math.abs(t-e.bottom));return Math.sqrt(i*i+r*r)}var Hh=new lt("mat-ripple-global-options"),i_=(()=>{let t=class t{get disabled(){return this._disabled}set disabled(i){i&&this.fadeOutAllNonPersistent(),this._disabled=i,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(i){this._trigger=i,this._setupTriggerEventsIfEnabled()}constructor(i,r,s,o,a){this._elementRef=i,this._animationMode=a,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=o||{},this._rippleRenderer=new Ra(this,r,i,s)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:bt(bt(bt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(i,r=0,s){return typeof i=="number"?this._rippleRenderer.fadeInRipple(i,r,bt(bt({},this.rippleConfig),s)):this._rippleRenderer.fadeInRipple(0,0,bt(bt({},this.rippleConfig),i))}};t.\u0275fac=function(r){return new(r||t)(Te(Ee),Te(vt),Te(Lt),Te(Hh,8),Te(sa,8))},t.\u0275dir=Ai({type:t,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(r,s){r&2&&ph("mat-ripple-unbounded",s.unbounded)},inputs:{color:[$t.None,"matRippleColor","color"],unbounded:[$t.None,"matRippleUnbounded","unbounded"],centered:[$t.None,"matRippleCentered","centered"],radius:[$t.None,"matRippleRadius","radius"],animation:[$t.None,"matRippleAnimation","animation"],disabled:[$t.None,"matRippleDisabled","disabled"],trigger:[$t.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let n=t;return n})(),zE=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ct({type:t}),t.\u0275inj=Dt({imports:[rs,rs]});let n=t;return n})();var $h={capture:!0},Wh=["focus","click","mouseenter","touchstart"],Ta="mat-ripple-loader-uninitialized",ba="mat-ripple-loader-class-name",Qh="mat-ripple-loader-centered",is="mat-ripple-loader-disabled",GE=(()=>{let t=class t{constructor(){this._document=Kt(ce,{optional:!0}),this._animationMode=Kt(sa,{optional:!0}),this._globalRippleOptions=Kt(Hh,{optional:!0}),this._platform=Kt(Lt),this._ngZone=Kt(vt),this._hosts=new Map,this._onInteraction=i=>{if(!(i.target instanceof HTMLElement))return;let s=i.target.closest(`[${Ta}]`);s&&this._createRipple(s)},this._ngZone.runOutsideAngular(()=>{for(let i of Wh)this._document?.addEventListener(i,this._onInteraction,$h)})}ngOnDestroy(){let i=this._hosts.keys();for(let r of i)this.destroyRipple(r);for(let r of Wh)this._document?.removeEventListener(r,this._onInteraction,$h)}configureRipple(i,r){i.setAttribute(Ta,""),(r.className||!i.hasAttribute(ba))&&i.setAttribute(ba,r.className||""),r.centered&&i.setAttribute(Qh,""),r.disabled&&i.setAttribute(is,"")}getRipple(i){return this._hosts.get(i)||this._createRipple(i)}setDisabled(i,r){let s=this._hosts.get(i);if(s){s.disabled=r;return}r?i.setAttribute(is,""):i.removeAttribute(is)}_createRipple(i){if(!this._document)return;let r=this._hosts.get(i);if(r)return r;i.querySelector(".mat-ripple")?.remove();let s=this._document.createElement("span");s.classList.add("mat-ripple",i.getAttribute(ba)),i.append(s);let o=new i_(new Ee(s),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return o._isInitialized=!0,o.trigger=i,o.centered=i.hasAttribute(Qh),o.disabled=i.hasAttribute(is),this.attachRipple(i,o),o}attachRipple(i,r){i.removeAttribute(Ta),this._hosts.set(i,r)}destroyRipple(i){let r=this._hosts.get(i);r&&(r.ngOnDestroy(),this._hosts.delete(i))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=et({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Yh=class{constructor(t){return t}},Xh=class{constructor(){return Hr()}};var r_=new Map,s_={activated:!1,tokenObservers:[]},o_={initialized:!1,enabled:!1};function Bt(n){return r_.get(n)||Object.assign({},s_)}function nd(){return o_}var a_="https://content-firebaseappcheck.googleapis.com/v1";var c_="exchangeDebugToken",Jh={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},cT=24*60*60*1e3;var Ca=class{constructor(t,e,i,r,s){if(this.operation=t,this.retryPolicy=e,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(t){return g(this,null,function*(){this.stop();try{this.pending=new ca,this.pending.promise.catch(e=>{}),yield u_(this.getNextRun(t)),this.pending.resolve(),yield this.pending.promise,this.pending=new ca,this.pending.promise.catch(e=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}};function u_(n){return new Promise(t=>{setTimeout(t,n)})}var l_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Se=new Th("appCheck","AppCheck",l_);function id(n){if(!Bt(n).activated)throw Se.create("use-before-activation",{appName:n.name})}function rd(i,r){return g(this,arguments,function*({url:n,body:t},e){let s={"Content-Type":"application/json"},o=e.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(t),headers:s},c;try{c=yield fetch(n,a)}catch(f){throw Se.create("fetch-network-error",{originalErrorMessage:f?.message})}if(c.status!==200)throw Se.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(f){throw Se.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=u.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw Se.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:u.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function sd(n,t){let{projectId:e,appId:i,apiKey:r}=n.options;return{url:`${a_}/projects/${e}/apps/${i}:${c_}?key=${r}`,body:{debug_token:t}}}var h_="firebase-app-check-database",d_=1,ka="firebase-app-check-store";var ss=null;function f_(){return ss||(ss=new Promise((n,t)=>{try{let e=indexedDB.open(h_,d_);e.onsuccess=i=>{n(i.target.result)},e.onerror=i=>{var r;t(Se.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},e.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(ka,{keyPath:"compositeKey"})}}}catch(e){t(Se.create("storage-open",{originalErrorMessage:e?.message}))}}),ss)}function m_(n,t){return p_(g_(n),t)}function p_(n,t){return g(this,null,function*(){let i=(yield f_()).transaction(ka,"readwrite"),s=i.objectStore(ka).put({compositeKey:n,value:t});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var u;a(Se.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function g_(n){return`${n.options.appId}-${n.name}`}var xa=new Wr("@firebase/app-check");function Da(n,t){return $r()?m_(n,t).catch(e=>{xa.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function od(){return nd().enabled}function ad(){return g(this,null,function*(){let n=nd();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var __={error:"UNKNOWN_ERROR"};function y_(n){return vh.encodeString(JSON.stringify(n),!1)}function Pa(n,t=!1){return g(this,null,function*(){let e=n.app;id(e);let i=Bt(e),r=i.token,s;if(r&&!Ni(r)&&(i.token=void 0,r=void 0),!r){let c=yield i.cachedTokenPromise;c&&(Ni(c)?r=c:yield Da(e,void 0))}if(!t&&r&&Ni(r))return{token:r.token};let o=!1;if(od()){i.exchangeTokenPromise||(i.exchangeTokenPromise=rd(sd(e,yield ad()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let c=yield i.exchangeTokenPromise;return yield Da(e,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Bt(e).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?xa.warn(c.message):xa.error(c),s=c}let a;return r?s?Ni(r)?a={token:r.token,internalError:s}:a=td(s):(a={token:r.token},i.token=r,yield Da(e,r)):a=td(s),o&&E_(e,a),a})}function v_(n){return g(this,null,function*(){let t=n.app;id(t);let{provider:e}=Bt(t);if(od()){let i=yield ad(),{token:r}=yield rd(sd(t,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield e.getToken();return{token:i}}})}function w_(n,t,e,i){let{app:r}=n,s=Bt(r),o={next:e,error:i,type:t};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Ni(s.token)){let a=s.token;Promise.resolve().then(()=>{e({token:a.token}),Zh(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Zh(n))}function cd(n,t){let e=Bt(n),i=e.tokenObservers.filter(r=>r.next!==t);i.length===0&&e.tokenRefresher&&e.tokenRefresher.isRunning()&&e.tokenRefresher.stop(),e.tokenObservers=i}function Zh(n){let{app:t}=n,e=Bt(t),i=e.tokenRefresher;i||(i=I_(n),e.tokenRefresher=i),!i.isRunning()&&e.isTokenAutoRefreshEnabled&&i.start()}function I_(n){let{app:t}=n;return new Ca(()=>g(this,null,function*(){let e=Bt(t),i;if(e.token?i=yield Pa(n,!0):i=yield Pa(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let e=Bt(t);if(e.token){let i=e.token.issuedAtTimeMillis+(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)*.5+3e5,r=e.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},Jh.RETRIAL_MIN_WAIT,Jh.RETRIAL_MAX_WAIT)}function E_(n,t){let e=Bt(n).tokenObservers;for(let i of e)try{i.type==="EXTERNAL"&&t.error!=null?i.error(t.error):i.next(t)}catch{}}function Ni(n){return n.expireTimeMillis-Date.now()>0}function td(n){return{token:y_(__),error:n}}var Na=class{constructor(t,e){this.app=t,this.heartbeatServiceProvider=e}_delete(){let{tokenObservers:t}=Bt(this.app);for(let e of t)cd(this.app,e.next);return Promise.resolve()}};function T_(n,t){return new Na(n,t)}function b_(n){return{getToken:t=>Pa(n,t),getLimitedUseToken:()=>v_(n),addTokenListener:t=>w_(n,"INTERNAL",t),removeTokenListener:t=>cd(n.app,t)}}var A_="@firebase/app-check",S_="0.8.3";var R_="app-check",ed="app-check-internal";function D_(){Di(new Ri(R_,n=>{let t=n.getProvider("app").getImmediate(),e=n.getProvider("heartbeat");return T_(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,t,e)=>{n.getProvider(ed).initialize()})),Di(new Ri(ed,n=>{let t=n.getProvider("app-check").getImmediate();return b_(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),ue(A_,S_)}D_();var C_=["localhost","0.0.0.0","127.0.0.1"],wT=typeof window<"u"&&C_.includes(window.location.hostname);var x_=new lt("angularfire2.auth.use-emulator"),P_=new lt("angularfire2.auth.settings"),N_=new lt("angularfire2.auth.tenant-id"),V_=new lt("angularfire2.auth.langugage-code"),M_=new lt("angularfire2.auth.use-device-language"),O_=new lt("angularfire.auth.persistence"),F_=(n,t,e,i,r,s,o,a)=>Dh(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=t.runOutsideAngular(()=>n.auth());if(e&&c.useEmulator(...e),i&&(c.tenantId=i),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[u,l]of Object.entries(o))c.settings[u]=l;return a&&c.setPersistence(a),c},[e,i,r,s,o,a]),OT=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(e,i,r,s,o,a,c,u,l,h,d,f){let I=new He,v=Xe(void 0).pipe(ae(o.outsideAngular),Je(()=>s.runOutsideAngular(()=>import("./chunk-Y2S6VZ5I.js"))),Ie(()=>ma(e,s,i)),Ie(w=>F_(w,s,a,u,l,h,c,d)),na({bufferSize:1,refCount:!1}));if(yh(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Xe(null);else{v.pipe(hh()).subscribe();let w=v.pipe(Je(S=>S.getRedirectResult().then(M=>M,()=>null)),fa,na({bufferSize:1,refCount:!1})),C=v.pipe(Je(S=>new we(M=>({unsubscribe:s.runOutsideAngular(()=>S.onAuthStateChanged(B=>M.next(B),B=>M.error(B),()=>M.complete()))})))),x=v.pipe(Je(S=>new we(M=>({unsubscribe:s.runOutsideAngular(()=>S.onIdTokenChanged(B=>M.next(B),B=>M.error(B),()=>M.complete()))}))));this.authState=w.pipe(ia(C),Ye(o.outsideAngular),ae(o.insideAngular)),this.user=w.pipe(ia(x),Ye(o.outsideAngular),ae(o.insideAngular)),this.idToken=this.user.pipe(Je(S=>S?Jo(S.getIdToken()):Xe(null))),this.idTokenResult=this.user.pipe(Je(S=>S?Jo(S.getIdTokenResult()):Xe(null))),this.credential=uh(w,I,this.authState.pipe(Zo(S=>!S))).pipe(Ie(S=>S?.user?S:null),Ye(o.outsideAngular),ae(o.insideAngular))}return Rh(this,v,s,{spy:{apply:(w,C,x)=>{(w.startsWith("signIn")||w.startsWith("createUser"))&&x.then(S=>I.next(S))}}})}static \u0275fac=function(i){return new(i||n)(P(Zr),P(ts,8),P(kn),P(vt),P(Ah),P(x_,8),P(P_,8),P(N_,8),P(V_,8),P(M_,8),P(O_,8),P(Ci,8))};static \u0275prov=et({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var L_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ut={},T,ec=ec||{},k=L_||self;function vs(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function Wi(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function B_(n){return Object.prototype.hasOwnProperty.call(n,Va)&&n[Va]||(n[Va]=++j_)}var Va="closure_uid_"+(1e9*Math.random()>>>0),j_=0;function U_(n,t,e){return n.call.apply(n.bind,arguments)}function q_(n,t,e){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(t,r)}}return function(){return n.apply(t,arguments)}}function wt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?wt=U_:wt=q_,wt.apply(null,arguments)}function os(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var i=e.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function dt(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[r].apply(i,o)}}function Re(){this.s=this.s,this.o=this.o}var z_=0;Re.prototype.s=!1;Re.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),z_!=0)&&B_(this)};Re.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Id=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function nc(n){let t=n.length;if(0<t){let e=Array(t);for(let i=0;i<t;i++)e[i]=n[i];return e}return[]}function ud(n,t){for(let e=1;e<arguments.length;e++){let i=arguments[e];if(vs(i)){let r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function It(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}It.prototype.h=function(){this.defaultPrevented=!0};var G_=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};k.addEventListener("test",e,t),k.removeEventListener("test",e,t)}catch{}return n}();function Bi(n){return/^[\s\xa0]*$/.test(n)}function ws(){var n=k.navigator;return n&&(n=n.userAgent)?n:""}function Ht(n){return ws().indexOf(n)!=-1}function ic(n){return ic[" "](n),n}ic[" "]=function(){};function K_(n,t){var e=Ny;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var $_=Ht("Opera"),Ln=Ht("Trident")||Ht("MSIE"),Ed=Ht("Edge"),Ba=Ed||Ln,Td=Ht("Gecko")&&!(ws().toLowerCase().indexOf("webkit")!=-1&&!Ht("Edge"))&&!(Ht("Trident")||Ht("MSIE"))&&!Ht("Edge"),W_=ws().toLowerCase().indexOf("webkit")!=-1&&!Ht("Edge");function bd(){var n=k.document;return n?n.documentMode:void 0}var ja;t:{if(as="",cs=function(){var n=ws();if(Td)return/rv:([^\);]+)(\)|;)/.exec(n);if(Ed)return/Edge\/([\d\.]+)/.exec(n);if(Ln)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(W_)return/WebKit\/(\S+)/.exec(n);if($_)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),cs&&(as=cs?cs[1]:""),Ln&&(us=bd(),us!=null&&us>parseFloat(as))){ja=String(us);break t}ja=as}var as,cs,us,Ua;k.document&&Ln?(Ma=bd(),Ua=Ma||parseInt(ja,10)||void 0):Ua=void 0;var Ma,Q_=Ua;function ji(n,t){if(It.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(Td){t:{try{ic(t.nodeName);var r=!0;break t}catch{}r=!1}r||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:H_[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ji.$.h.call(this)}}dt(ji,It);var H_={2:"touch",3:"pen",4:"mouse"};ji.prototype.h=function(){ji.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Qi="closure_listenable_"+(1e6*Math.random()|0),Y_=0;function X_(n,t,e,i,r){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!i,this.la=r,this.key=++Y_,this.fa=this.ia=!1}function Is(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function rc(n,t,e){for(let i in n)t.call(e,n[i],i,n)}function J_(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function Ad(n){let t={};for(let e in n)t[e]=n[e];return t}var ld="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sd(n,t){let e,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(e in i)n[e]=i[e];for(let s=0;s<ld.length;s++)e=ld[s],Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}}function Es(n){this.src=n,this.g={},this.h=0}Es.prototype.add=function(n,t,e,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=za(n,t,i,r);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new X_(t,this.src,s,!!i,r),t.ia=e,n.push(t)),t};function qa(n,t){var e=t.type;if(e in n.g){var i=n.g[e],r=Id(i,t),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(Is(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function za(n,t,e,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==i)return r}return-1}var sc="closure_lm_"+(1e6*Math.random()|0),Oa={};function Rd(n,t,e,i,r){if(i&&i.once)return Cd(n,t,e,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Rd(n,t[s],e,i,r);return null}return e=cc(e),n&&n[Qi]?n.O(t,e,Wi(i)?!!i.capture:!!i,r):Dd(n,t,e,!1,i,r)}function Dd(n,t,e,i,r,s){if(!t)throw Error("Invalid event type");var o=Wi(r)?!!r.capture:!!r,a=ac(n);if(a||(n[sc]=a=new Es(n)),e=a.add(t,e,i,o,s),e.proxy)return e;if(i=Z_(),e.proxy=i,i.src=n,i.listener=e,n.addEventListener)G_||(r=o),r===void 0&&(r=!1),n.addEventListener(t.toString(),i,r);else if(n.attachEvent)n.attachEvent(xd(t.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return e}function Z_(){function n(e){return t.call(n.src,n.listener,e)}let t=ty;return n}function Cd(n,t,e,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Cd(n,t[s],e,i,r);return null}return e=cc(e),n&&n[Qi]?n.P(t,e,Wi(i)?!!i.capture:!!i,r):Dd(n,t,e,!0,i,r)}function kd(n,t,e,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)kd(n,t[s],e,i,r);else i=Wi(i)?!!i.capture:!!i,e=cc(e),n&&n[Qi]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=za(s,e,i,r),-1<e&&(Is(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=ac(n))&&(t=n.g[t.toString()],n=-1,t&&(n=za(t,e,i,r)),(e=-1<n?t[n]:null)&&oc(e))}function oc(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[Qi])qa(t.i,n);else{var e=n.type,i=n.proxy;t.removeEventListener?t.removeEventListener(e,i,n.capture):t.detachEvent?t.detachEvent(xd(e),i):t.addListener&&t.removeListener&&t.removeListener(i),(e=ac(t))?(qa(e,n),e.h==0&&(e.src=null,t[sc]=null)):Is(n)}}}function xd(n){return n in Oa?Oa[n]:Oa[n]="on"+n}function ty(n,t){if(n.fa)n=!0;else{t=new ji(t,this);var e=n.listener,i=n.la||n.src;n.ia&&oc(n),n=e.call(i,t)}return n}function ac(n){return n=n[sc],n instanceof Es?n:null}var Fa="__closure_events_fn_"+(1e9*Math.random()>>>0);function cc(n){return typeof n=="function"?n:(n[Fa]||(n[Fa]=function(t){return n.handleEvent(t)}),n[Fa])}function ht(){Re.call(this),this.i=new Es(this),this.S=this,this.J=null}dt(ht,Re);ht.prototype[Qi]=!0;ht.prototype.removeEventListener=function(n,t,e,i){kd(this,n,t,e,i)};function gt(n,t){var e,i=n.J;if(i)for(e=[];i;i=i.J)e.push(i);if(n=n.S,i=t.type||t,typeof t=="string")t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var r=t;t=new It(i,n),Sd(t,r)}if(r=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];r=ls(o,i,!0,t)&&r}if(o=t.g=n,r=ls(o,i,!0,t)&&r,r=ls(o,i,!1,t)&&r,e)for(s=0;s<e.length;s++)o=t.g=e[s],r=ls(o,i,!1,t)&&r}ht.prototype.N=function(){if(ht.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],i=0;i<e.length;i++)Is(e[i]);delete n.g[t],n.h--}}this.J=null};ht.prototype.O=function(n,t,e,i){return this.i.add(String(n),t,!1,e,i)};ht.prototype.P=function(n,t,e,i){return this.i.add(String(n),t,!0,e,i)};function ls(n,t,e,i){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,c=o.la||o.src;o.ia&&qa(n.i,o),r=a.call(c,i)!==!1&&r}}return r&&!i.defaultPrevented}var uc=k.JSON.stringify,Ga=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function ey(){var n=lc;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var Ka=class{constructor(){this.h=this.g=null}add(t,e){let i=Pd.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}},Pd=new Ga(()=>new $a,n=>n.reset()),$a=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function ny(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function iy(n){k.setTimeout(()=>{throw n},0)}var Ui,qi=!1,lc=new Ka,Nd=()=>{let n=k.Promise.resolve(void 0);Ui=()=>{n.then(ry)}},ry=()=>{for(var n;n=ey();){try{n.h.call(n.g)}catch(e){iy(e)}var t=Pd;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}qi=!1};function Ts(n,t){ht.call(this),this.h=n||1,this.g=t||k,this.j=wt(this.qb,this),this.l=Date.now()}dt(Ts,ht);T=Ts.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),gt(this,"tick"),this.ga&&(hc(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function hc(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){Ts.$.N.call(this),hc(this),delete this.g};function dc(n,t,e){if(typeof n=="function")e&&(n=wt(n,e));else if(n&&typeof n.handleEvent=="function")n=wt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:k.setTimeout(n,t||0)}function Vd(n){n.g=dc(()=>{n.g=null,n.i&&(n.i=!1,Vd(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var Wa=class extends Re{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Vd(this)}N(){super.N(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function zi(n){Re.call(this),this.h=n,this.g={}}dt(zi,Re);var hd=[];function Md(n,t,e,i){Array.isArray(e)||(e&&(hd[0]=e.toString()),e=hd);for(var r=0;r<e.length;r++){var s=Rd(t,e[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Od(n){rc(n.g,function(t,e){this.g.hasOwnProperty(e)&&oc(t)},n),n.g={}}zi.prototype.N=function(){zi.$.N.call(this),Od(this)};zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function bs(){this.g=!0}bs.prototype.Ea=function(){this.g=!1};function sy(n,t,e,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+`
`+e+`
`+o})}function oy(n,t,e,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+`
`+e+`
`+s+" "+o})}function On(n,t,e,i){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+cy(n,e)+(i?" "+i:"")})}function ay(n,t){n.info(function(){return"TIMEOUT: "+t})}bs.prototype.info=function(){};function cy(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var i=e[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return uc(e)}catch{return t}}var an={},dd=null;function As(){return dd=dd||new ht}an.Ta="serverreachability";function Fd(n){It.call(this,an.Ta,n)}dt(Fd,It);function Gi(n){let t=As();gt(t,new Fd(t))}an.STAT_EVENT="statevent";function Ld(n,t){It.call(this,an.STAT_EVENT,n),this.stat=t}dt(Ld,It);function At(n){let t=As();gt(t,new Ld(t,n))}an.Ua="timingevent";function Bd(n,t){It.call(this,an.Ua,n),this.size=t}dt(Bd,It);function Hi(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){n()},t)}var Ss={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},jd={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function fc(){}fc.prototype.h=null;function fd(n){return n.h||(n.h=n.i())}function Ud(){}var Yi={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function mc(){It.call(this,"d")}dt(mc,It);function pc(){It.call(this,"c")}dt(pc,It);var Qa;function Rs(){}dt(Rs,fc);Rs.prototype.g=function(){return new XMLHttpRequest};Rs.prototype.i=function(){return{}};Qa=new Rs;function Xi(n,t,e,i){this.l=n,this.j=t,this.m=e,this.W=i||1,this.U=new zi(this),this.P=uy,n=Ba?125:void 0,this.V=new Ts(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new qd}function qd(){this.i=null,this.g="",this.h=!1}var uy=45e3,zd={},Ha={};T=Xi.prototype;T.setTimeout=function(n){this.P=n};function Ya(n,t,e){n.L=1,n.A=Cs(he(t)),n.u=e,n.S=!0,Gd(n,null)}function Gd(n,t){n.G=Date.now(),Ji(n),n.B=he(n.A);var e=n.B,i=n.W;Array.isArray(i)||(i=[String(i)]),Jd(e.i,"t",i),n.o=0,e=n.l.J,n.h=new qd,n.g=wf(n.l,e?t:null,!n.u),0<n.O&&(n.M=new Wa(wt(n.Pa,n,n.g),n.O)),Md(n.U,n.g,"readystatechange",n.nb),t=n.I?Ad(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Gi(),sy(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let t=this.M;t&&Yt(n)==3?t.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)t:{let l=Yt(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Ba||this.g&&(this.h.h||this.g.ja()||_d(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?Gi(3):Gi(2)),Ds(this);var e=this.g.da();this.ca=e;e:if(Kd(this)){var i=_d(this.g);n="";var r=i.length,s=Yt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){rn(this),Li(this);var o="";break e}this.h.i=new k.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,n+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,oy(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Bi(a)){var u=a;break e}}u=null}if(e=u)On(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xa(this,e);else{this.i=!1,this.s=3,At(12),rn(this),Li(this);break t}}this.S?($d(this,l,o),Ba&&this.i&&l==3&&(Md(this.U,this.V,"tick",this.mb),this.V.start())):(On(this.j,this.m,o,null),Xa(this,o)),l==4&&rn(this),this.i&&!this.J&&(l==4?gf(this.l,this):(this.i=!1,Ji(this)))}else ky(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,At(12)):(this.s=0,At(13)),rn(this),Li(this)}}}catch{}finally{}};function Kd(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function $d(n,t,e){let i=!0,r;for(;!n.J&&n.o<e.length;)if(r=ly(n,e),r==Ha){t==4&&(n.s=4,At(14),i=!1),On(n.j,n.m,null,"[Incomplete Response]");break}else if(r==zd){n.s=4,At(15),On(n.j,n.m,e,"[Invalid Chunk]"),i=!1;break}else On(n.j,n.m,r,null),Xa(n,r);Kd(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,At(16),i=!1),n.i=n.i&&i,i?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Ic(t),t.M=!0,At(11))):(On(n.j,n.m,e,"[Invalid Chunked Response]"),rn(n),Li(n))}T.mb=function(){if(this.g){var n=Yt(this.g),t=this.g.ja();this.o<t.length&&(Ds(this),$d(this,n,t),this.i&&n!=4&&Ji(this))}};function ly(n,t){var e=n.o,i=t.indexOf(`
`,e);return i==-1?Ha:(e=Number(t.substring(e,i)),isNaN(e)?zd:(i+=1,i+e>t.length?Ha:(t=t.slice(i,i+e),n.o=i+e,t)))}T.cancel=function(){this.J=!0,rn(this)};function Ji(n){n.Y=Date.now()+n.P,Wd(n,n.P)}function Wd(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Hi(wt(n.lb,n),t)}function Ds(n){n.C&&(k.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(ay(this.j,this.B),this.L!=2&&(Gi(),At(17)),rn(this),this.s=2,Li(this)):Wd(this,this.Y-n)};function Li(n){n.l.H==0||n.J||gf(n.l,n)}function rn(n){Ds(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,hc(n.V),Od(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function Xa(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||Ja(e.i,n))){if(!n.K&&Ja(e.i,n)&&e.H==3){try{var i=e.Ja.g.parse(t)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)ps(e),Ps(e);else break t;wc(e),At(18)}}else e.Fa=r[1],0<e.Fa-e.V&&37500>r[2]&&e.G&&e.A==0&&!e.v&&(e.v=Hi(wt(e.ib,e),6e3));if(1>=ef(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else sn(e,11)}else if((n.K||e.g==n)&&ps(e),!Bi(t))for(r=e.Ja.g.parse(t),t=0;t<r.length;t++){let u=r[t];if(e.V=u[0],u=u[1],e.H==2)if(u[0]=="c"){e.K=u[1],e.pa=u[2];let l=u[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=u[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=u[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,e.L=i,e.l.info("backChannelRequestTimeoutMs_="+i)),i=e;let f=n.g;if(f){let I=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(I){var s=i.i;s.g||I.indexOf("spdy")==-1&&I.indexOf("quic")==-1&&I.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(gc(s,s.h),s.h=null))}if(i.F){let v=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(i.Da=v,K(i.I,i.F,v))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),i=e;var o=n;if(i.wa=vf(i,i.J?i.pa:null,i.Y),o.K){nf(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.C&&(Ds(a),Ji(a)),i.g=o}else mf(i);0<e.j.length&&Ns(e)}else u[0]!="stop"&&u[0]!="close"||sn(e,7);else e.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?sn(e,7):vc(e):u[0]!="noop"&&e.h&&e.h.Aa(u),e.A=0)}}Gi(4)}catch{}}function hy(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(vs(n)){for(var t=[],e=n.length,i=0;i<e;i++)t.push(n[i]);return t}t=[],e=0;for(i in n)t[e++]=n[i];return t}function dy(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(vs(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let i in n)t[e++]=i;return t}}}function Qd(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(vs(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=dy(n),i=hy(n),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],e&&e[s],n)}var Hd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fy(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var i=n[e].indexOf("="),r=null;if(0<=i){var s=n[e].substring(0,i);r=n[e].substring(i+1)}else s=n[e];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function on(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof on){this.h=n.h,fs(this,n.j),this.s=n.s,this.g=n.g,ms(this,n.m),this.l=n.l;var t=n.i,e=new Ki;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),md(this,e),this.o=n.o}else n&&(t=String(n).match(Hd))?(this.h=!1,fs(this,t[1]||"",!0),this.s=Oi(t[2]||""),this.g=Oi(t[3]||"",!0),ms(this,t[4]),this.l=Oi(t[5]||"",!0),md(this,t[6]||"",!0),this.o=Oi(t[7]||"")):(this.h=!1,this.i=new Ki(null,this.h))}on.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Fi(t,pd,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Fi(t,pd,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Fi(e,e.charAt(0)=="/"?gy:py,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Fi(e,yy)),n.join("")};function he(n){return new on(n)}function fs(n,t,e){n.j=e?Oi(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function ms(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function md(n,t,e){t instanceof Ki?(n.i=t,vy(n.i,n.h)):(e||(t=Fi(t,_y)),n.i=new Ki(t,n.h))}function K(n,t,e){n.i.set(t,e)}function Cs(n){return K(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Oi(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Fi(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,my),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function my(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var pd=/[#\/\?@]/g,py=/[#\?:]/g,gy=/[#\?]/g,_y=/[#\?@]/g,yy=/#/g;function Ki(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function De(n){n.g||(n.g=new Map,n.h=0,n.i&&fy(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}T=Ki.prototype;T.add=function(n,t){De(this),this.i=null,n=Bn(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function Yd(n,t){De(n),t=Bn(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function Xd(n,t){return De(n),t=Bn(n,t),n.g.has(t)}T.forEach=function(n,t){De(this),this.g.forEach(function(e,i){e.forEach(function(r){n.call(t,r,i,this)},this)},this)};T.ta=function(){De(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let i=0;i<t.length;i++){let r=n[i];for(let s=0;s<r.length;s++)e.push(t[i])}return e};T.Z=function(n){De(this);let t=[];if(typeof n=="string")Xd(this,n)&&(t=t.concat(this.g.get(Bn(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};T.set=function(n,t){return De(this),this.i=null,n=Bn(this,n),Xd(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};T.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function Jd(n,t,e){Yd(n,t),0<e.length&&(n.i=null,n.g.set(Bn(n,t),nc(e)),n.h+=e.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var i=t[e];let s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;o[i]!==""&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};function Bn(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function vy(n,t){t&&!n.j&&(De(n),n.i=null,n.g.forEach(function(e,i){var r=i.toLowerCase();i!=r&&(Yd(this,i),Jd(this,r,e))},n)),n.j=t}var wy=class{constructor(n,t){this.g=n,this.map=t}};function Zd(n){this.l=n||Iy,k.PerformanceNavigationTiming?(n=k.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Iy=10;function tf(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function ef(n){return n.h?1:n.g?n.g.size:0}function Ja(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function gc(n,t){n.g?n.g.add(t):n.h=t}function nf(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}Zd.prototype.cancel=function(){if(this.i=rf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function rf(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return nc(n.i)}var Ey=class{stringify(n){return k.JSON.stringify(n,void 0)}parse(n){return k.JSON.parse(n,void 0)}};function Ty(){this.g=new Ey}function by(n,t,e){let i=e||"";try{Qd(n,function(r,s){let o=r;Wi(r)&&(o=uc(r)),t.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function Ay(n,t){let e=new bs;if(k.Image){let i=new Image;i.onload=os(hs,e,i,"TestLoadImage: loaded",!0,t),i.onerror=os(hs,e,i,"TestLoadImage: error",!1,t),i.onabort=os(hs,e,i,"TestLoadImage: abort",!1,t),i.ontimeout=os(hs,e,i,"TestLoadImage: timeout",!1,t),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else t(!1)}function hs(n,t,e,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch{}}function Zi(n){this.l=n.ec||null,this.j=n.ob||!1}dt(Zi,fc);Zi.prototype.g=function(){return new ks(this.l,this.j)};Zi.prototype.i=function(n){return function(){return n}}({});function ks(n,t){ht.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=_c,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}dt(ks,ht);var _c=0;T=ks.prototype;T.open=function(n,t){if(this.readyState!=_c)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,$i(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||k).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,tr(this)),this.readyState=_c};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$i(this)),this.g&&(this.readyState=3,$i(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof k.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;sf(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function sf(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?tr(this):$i(this),this.readyState==3&&sf(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,tr(this))};T.Ya=function(n){this.g&&(this.response=n,tr(this))};T.ka=function(){this.g&&tr(this)};function tr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$i(n)}T.setRequestHeader=function(n,t){this.v.append(n,t)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function $i(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(ks.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Sy=k.JSON.parse;function Q(n){ht.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=of,this.L=this.M=!1}dt(Q,ht);var of="",Ry=/^https?$/i,Dy=["POST","PUT"];T=Q.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,t,e,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Qa.g(),this.C=this.u?fd(this.u):fd(Qa),this.g.onreadystatechange=wt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){gd(this,s);return}if(n=e||"",e=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)e.set(r,i[r]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(let s of i.keys())e.set(s,i.get(s));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),r=k.FormData&&n instanceof k.FormData,!(0<=Id(Dy,t))||i||r||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{uf(this),0<this.B&&((this.L=Cy(this.g))?(this.g.timeout=this.B,this.g.ontimeout=wt(this.ua,this)):this.A=dc(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){gd(this,s)}};function Cy(n){return Ln&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof ec<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,gt(this,"timeout"),this.abort(8))};function gd(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,af(n),xs(n)}function af(n){n.F||(n.F=!0,gt(n,"complete"),gt(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,gt(this,"complete"),gt(this,"abort"),xs(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),xs(this,!0)),Q.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?cf(this):this.kb())};T.kb=function(){cf(this)};function cf(n){if(n.h&&typeof ec<"u"&&(!n.C[1]||Yt(n)!=4||n.da()!=2)){if(n.v&&Yt(n)==4)dc(n.La,0,n);else if(gt(n,"readystatechange"),Yt(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var i;if(i=o===0){var r=String(n.I).match(Hd)[1]||null;!r&&k.self&&k.self.location&&(r=k.self.location.protocol.slice(0,-1)),i=!Ry.test(r?r.toLowerCase():"")}e=i}if(e)gt(n,"complete"),gt(n,"success");else{n.m=6;try{var s=2<Yt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",af(n)}}finally{xs(n)}}}}function xs(n,t){if(n.g){uf(n);let e=n.g,i=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||gt(n,"ready");try{e.onreadystatechange=i}catch{}}}function uf(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(k.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function Yt(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<Yt(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Sy(t)}};function _d(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case of:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function ky(n){let t={};n=(n.g&&2<=Yt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let i=0;i<n.length;i++){if(Bi(n[i]))continue;var e=ny(n[i]);let r=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[r]||[];t[r]=s,s.push(e)}J_(t,function(i){return i.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function lf(n){let t="";return rc(n,function(e,i){t+=i,t+=":",t+=e,t+=`\r
`}),t}function yc(n,t,e){t:{for(i in e){var i=!1;break t}i=!0}i||(e=lf(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):K(n,t,e))}function Vi(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function hf(n){this.Ga=0,this.j=[],this.l=new bs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Vi("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Vi("baseRetryDelayMs",5e3,n),this.hb=Vi("retryDelaySeedMs",1e4,n),this.eb=Vi("forwardChannelMaxRetries",2,n),this.xa=Vi("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Zd(n&&n.concurrentRequestLimit),this.Ja=new Ty,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=hf.prototype;T.ra=8;T.H=1;function vc(n){if(df(n),n.H==3){var t=n.W++,e=he(n.I);if(K(e,"SID",n.K),K(e,"RID",t),K(e,"TYPE","terminate"),er(n,e),t=new Xi(n,n.l,t),t.L=2,t.A=Cs(he(e)),e=!1,k.navigator&&k.navigator.sendBeacon)try{e=k.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&k.Image&&(new Image().src=t.A,e=!0),e||(t.g=wf(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Ji(t)}yf(n)}function Ps(n){n.g&&(Ic(n),n.g.cancel(),n.g=null)}function df(n){Ps(n),n.u&&(k.clearTimeout(n.u),n.u=null),ps(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&k.clearTimeout(n.m),n.m=null)}function Ns(n){if(!tf(n.i)&&!n.m){n.m=!0;var t=n.Na;Ui||Nd(),qi||(Ui(),qi=!0),lc.add(t,n),n.C=0}}function xy(n,t){return ef(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Hi(wt(n.Na,n,t),_f(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let r=new Xi(this,this.l,n),s=this.s;if(this.U&&(s?(s=Ad(s),Sd(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var i=this.j[e];if("__data__"in i.map&&(i=i.map.__data__,typeof i=="string")){i=i.length;break e}i=void 0}if(i===void 0)break;if(t+=i,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=ff(this,r,t),e=he(this.I),K(e,"RID",n),K(e,"CVER",22),this.F&&K(e,"X-HTTP-Session-Id",this.F),er(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(lf(s)))+"&"+t:this.o&&yc(e,this.o,s)),gc(this.i,r),this.bb&&K(e,"TYPE","init"),this.P?(K(e,"$req",t),K(e,"SID","null"),r.aa=!0,Ya(r,e,null)):Ya(r,e,t),this.H=2}}else this.H==3&&(n?yd(this,n):this.j.length==0||tf(this.i)||yd(this))};function yd(n,t){var e;t?e=t.m:e=n.W++;let i=he(n.I);K(i,"SID",n.K),K(i,"RID",e),K(i,"AID",n.V),er(n,i),n.o&&n.s&&yc(i,n.o,n.s),e=new Xi(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=ff(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),gc(n.i,e),Ya(e,i,t)}function er(n,t){n.na&&rc(n.na,function(e,i){K(t,i,e)}),n.h&&Qd({},function(e,i){K(t,i,e)})}function ff(n,t,e){e=Math.min(n.j.length,e);var i=n.h?wt(n.h.Va,n.h,n):null;t:{var r=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=r[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<e;c++){let u=r[c].g,l=r[c].map;if(u-=s,0>u)s=Math.max(0,r[c].g-100),a=!1;else try{by(l,o,"req"+u+"_")}catch{i&&i(l)}}if(a){i=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,i}function mf(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Ui||Nd(),qi||(Ui(),qi=!0),lc.add(t,n),n.A=0}}function wc(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Hi(wt(n.Ma,n),_f(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,pf(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Hi(wt(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,At(10),Ps(this),pf(this))};function Ic(n){n.B!=null&&(k.clearTimeout(n.B),n.B=null)}function pf(n){n.g=new Xi(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=he(n.wa);K(t,"RID","rpc"),K(t,"SID",n.K),K(t,"AID",n.V),K(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&K(t,"TO",n.qa),K(t,"TYPE","xmlhttp"),er(n,t),n.o&&n.s&&yc(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=Cs(he(t)),e.u=null,e.S=!0,Gd(e,n)}T.ib=function(){this.v!=null&&(this.v=null,Ps(this),wc(this),At(19))};function ps(n){n.v!=null&&(k.clearTimeout(n.v),n.v=null)}function gf(n,t){var e=null;if(n.g==t){ps(n),Ic(n),n.g=null;var i=2}else if(Ja(n.i,t))e=t.F,nf(n.i,t),i=1;else return;if(n.H!=0){if(t.i)if(i==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var r=n.C;i=As(),gt(i,new Bd(i,e)),Ns(n)}else mf(n);else if(r=t.s,r==3||r==0&&0<t.ca||!(i==1&&xy(n,t)||i==2&&wc(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),r){case 1:sn(n,5);break;case 4:sn(n,10);break;case 3:sn(n,6);break;default:sn(n,2)}}}function _f(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function sn(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var i=wt(n.pb,n);e||(e=new on("//www.google.com/images/cleardot.gif"),k.location&&k.location.protocol=="http"||fs(e,"https"),Cs(e)),Ay(e.toString(),i)}else At(2);n.H=0,n.h&&n.h.za(t),yf(n),df(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),At(2)):(this.l.info("Failed to ping google.com"),At(1))};function yf(n){if(n.H=0,n.ma=[],n.h){let t=rf(n.i);(t.length!=0||n.j.length!=0)&&(ud(n.ma,t),ud(n.ma,n.j),n.i.i.length=0,nc(n.j),n.j.length=0),n.h.ya()}}function vf(n,t,e){var i=e instanceof on?he(e):new on(e);if(i.g!="")t&&(i.g=t+"."+i.g),ms(i,i.m);else{var r=k.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new on(null);i&&fs(s,i),t&&(s.g=t),r&&ms(s,r),e&&(s.l=e),i=s}return e=n.F,t=n.Da,e&&t&&K(i,e,t),K(i,"VER",n.ra),er(n,i),i}function wf(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new Q(new Zi({ob:e})):new Q(n.va),t.Oa(n.J),t}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function If(){}T=If.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function gs(){if(Ln&&!(10<=Number(Q_)))throw Error("Environmental error: no available transport.")}gs.prototype.g=function(n,t){return new xt(n,t)};function xt(n,t){ht.call(this),this.g=new hf(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Bi(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Bi(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new jn(this)}dt(xt,ht);xt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;At(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=vf(n,null,n.Y),Ns(n)};xt.prototype.close=function(){vc(this.g)};xt.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=uc(n),n=e);t.j.push(new wy(t.fb++,n)),t.H==3&&Ns(t)};xt.prototype.N=function(){this.g.h=null,delete this.j,vc(this.g),delete this.g,xt.$.N.call(this)};function Ef(n){mc.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}dt(Ef,mc);function Tf(){pc.call(this),this.status=1}dt(Tf,pc);function jn(n){this.g=n}dt(jn,If);jn.prototype.Ba=function(){gt(this.g,"a")};jn.prototype.Aa=function(n){gt(this.g,new Ef(n))};jn.prototype.za=function(n){gt(this.g,new Tf)};jn.prototype.ya=function(){gt(this.g,"b")};function Py(){this.blockSize=-1}function jt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}dt(jt,Py);jt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function La(n,t,e){e||(e=0);var i=Array(16);if(typeof t=="string")for(var r=0;16>r;++r)i[r]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(r=0;16>r;++r)i[r]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],r=n.g[2];var s=n.g[3],o=t+(s^e&(r^s))+i[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[2]+606105819&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[3]+3250441966&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[6]+2821735955&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[7]+4249261313&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[10]+4294925233&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[11]+2304563134&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(s^e&(r^s))+i[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(r^t&(e^r))+i[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=r+(e^s&(t^e))+i[14]+2792965006&4294967295,r=s+(o<<17&4294967295|o>>>15),o=e+(t^r&(s^t))+i[15]+1236535329&4294967295,e=r+(o<<22&4294967295|o>>>10),o=t+(r^s&(e^r))+i[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[11]+643717713&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[0]+3921069994&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[15]+3634488961&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[4]+3889429448&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[3]+4107603335&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[8]+1163531501&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(r^s&(e^r))+i[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^r&(t^e))+i[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=r+(t^e&(s^t))+i[7]+1735328473&4294967295,r=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(r^s))+i[12]+2368359562&4294967295,e=r+(o<<20&4294967295|o>>>12),o=t+(e^r^s)+i[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[11]+1839030562&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[14]+4259657740&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[7]+4139469664&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[10]+3200236656&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[3]+3572445317&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[6]+76029189&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(e^r^s)+i[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^r)+i[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=r+(s^t^e)+i[15]+530742520&4294967295,r=s+(o<<16&4294967295|o>>>16),o=e+(r^s^t)+i[2]+3299628645&4294967295,e=r+(o<<23&4294967295|o>>>9),o=t+(r^(e|~s))+i[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[14]+2878612391&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[5]+4237533241&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[10]+4293915773&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[1]+2240044497&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[6]+2734768916&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[13]+1309151649&4294967295,e=r+(o<<21&4294967295|o>>>11),o=t+(r^(e|~s))+i[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~r))+i[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=r+(t^(s|~e))+i[2]+718787259&4294967295,r=s+(o<<15&4294967295|o>>>17),o=e+(s^(r|~t))+i[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+r&4294967295,n.g[3]=n.g[3]+s&4294967295}jt.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(r==0)for(;s<=e;)La(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(i[r++]=n.charCodeAt(s++),r==this.blockSize){La(this,i),r=0;break}}else for(;s<t;)if(i[r++]=n[s++],r==this.blockSize){La(this,i),r=0;break}}this.h=r,this.i+=t};jt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var i=0;32>i;i+=8)n[e++]=this.g[t]>>>i&255;return n};function q(n,t){this.h=t;for(var e=[],i=!0,r=n.length-1;0<=r;r--){var s=n[r]|0;i&&s==t||(e[r]=s,i=!1)}this.g=e}var Ny={};function Ec(n){return-128<=n&&128>n?K_(n,function(t){return new q([t|0],0>t?-1:0)}):new q([n|0],0>n?-1:0)}function Xt(n){if(isNaN(n)||!isFinite(n))return Fn;if(0>n)return pt(Xt(-n));for(var t=[],e=1,i=0;n>=e;i++)t[i]=n/e|0,e*=Za;return new q(t,0)}function bf(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return pt(bf(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=Xt(Math.pow(t,8)),i=Fn,r=0;r<n.length;r+=8){var s=Math.min(8,n.length-r),o=parseInt(n.substring(r,r+s),t);8>s?(s=Xt(Math.pow(t,s)),i=i.R(s).add(Xt(o))):(i=i.R(e),i=i.add(Xt(o)))}return i}var Za=4294967296,Fn=Ec(0),tc=Ec(1),vd=Ec(16777216);T=q.prototype;T.ea=function(){if(Mt(this))return-pt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var i=this.D(e);n+=(0<=i?i:Za+i)*t,t*=Za}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(le(this))return"0";if(Mt(this))return"-"+pt(this).toString(n);for(var t=Xt(Math.pow(n,6)),e=this,i="";;){var r=ys(e,t).g;e=_s(e,r.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=r,le(e))return s+i;for(;6>s.length;)s="0"+s;i=s+i}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function le(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Mt(n){return n.h==-1}T.X=function(n){return n=_s(this,n),Mt(n)?-1:le(n)?0:1};function pt(n){for(var t=n.g.length,e=[],i=0;i<t;i++)e[i]=~n.g[i];return new q(e,~n.h).add(tc)}T.abs=function(){return Mt(this)?pt(this):this};T.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0,r=0;r<=t;r++){var s=i+(this.D(r)&65535)+(n.D(r)&65535),o=(s>>>16)+(this.D(r)>>>16)+(n.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,e[r]=o<<16|s}return new q(e,e[e.length-1]&-2147483648?-1:0)};function _s(n,t){return n.add(pt(t))}T.R=function(n){if(le(this)||le(n))return Fn;if(Mt(this))return Mt(n)?pt(this).R(pt(n)):pt(pt(this).R(n));if(Mt(n))return pt(this.R(pt(n)));if(0>this.X(vd)&&0>n.X(vd))return Xt(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],i=0;i<2*t;i++)e[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<n.g.length;r++){var s=this.D(i)>>>16,o=this.D(i)&65535,a=n.D(r)>>>16,c=n.D(r)&65535;e[2*i+2*r]+=o*c,ds(e,2*i+2*r),e[2*i+2*r+1]+=s*c,ds(e,2*i+2*r+1),e[2*i+2*r+1]+=o*a,ds(e,2*i+2*r+1),e[2*i+2*r+2]+=s*a,ds(e,2*i+2*r+2)}for(i=0;i<t;i++)e[i]=e[2*i+1]<<16|e[2*i];for(i=t;i<2*t;i++)e[i]=0;return new q(e,0)};function ds(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function Mi(n,t){this.g=n,this.h=t}function ys(n,t){if(le(t))throw Error("division by zero");if(le(n))return new Mi(Fn,Fn);if(Mt(n))return t=ys(pt(n),t),new Mi(pt(t.g),pt(t.h));if(Mt(t))return t=ys(n,pt(t)),new Mi(pt(t.g),t.h);if(30<n.g.length){if(Mt(n)||Mt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=tc,i=t;0>=i.X(n);)e=wd(e),i=wd(i);var r=Mn(e,1),s=Mn(i,1);for(i=Mn(i,2),e=Mn(e,2);!le(i);){var o=s.add(i);0>=o.X(n)&&(r=r.add(e),s=o),i=Mn(i,1),e=Mn(e,1)}return t=_s(n,r.R(t)),new Mi(r,t)}for(r=Fn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),i=Math.ceil(Math.log(e)/Math.LN2),i=48>=i?1:Math.pow(2,i-48),s=Xt(e),o=s.R(t);Mt(o)||0<o.X(n);)e-=i,s=Xt(e),o=s.R(t);le(s)&&(s=tc),r=r.add(s),n=_s(n,o)}return new Mi(r,n)}T.gb=function(n){return ys(this,n).h};T.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)&n.D(i);return new q(e,this.h&n.h)};T.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)|n.D(i);return new q(e,this.h|n.h)};T.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],i=0;i<t;i++)e[i]=this.D(i)^n.D(i);return new q(e,this.h^n.h)};function wd(n){for(var t=n.g.length+1,e=[],i=0;i<t;i++)e[i]=n.D(i)<<1|n.D(i-1)>>>31;return new q(e,n.h)}function Mn(n,t){var e=t>>5;t%=32;for(var i=n.g.length-e,r=[],s=0;s<i;s++)r[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new q(r,n.h)}gs.prototype.createWebChannel=gs.prototype.g;xt.prototype.send=xt.prototype.u;xt.prototype.open=xt.prototype.m;xt.prototype.close=xt.prototype.close;Ss.NO_ERROR=0;Ss.TIMEOUT=8;Ss.HTTP_ERROR=6;jd.COMPLETE="complete";Ud.EventType=Yi;Yi.OPEN="a";Yi.CLOSE="b";Yi.ERROR="c";Yi.MESSAGE="d";ht.prototype.listen=ht.prototype.O;Q.prototype.listenOnce=Q.prototype.P;Q.prototype.getLastError=Q.prototype.Sa;Q.prototype.getLastErrorCode=Q.prototype.Ia;Q.prototype.getStatus=Q.prototype.da;Q.prototype.getResponseJson=Q.prototype.Wa;Q.prototype.getResponseText=Q.prototype.ja;Q.prototype.send=Q.prototype.ha;Q.prototype.setWithCredentials=Q.prototype.Oa;jt.prototype.digest=jt.prototype.l;jt.prototype.reset=jt.prototype.reset;jt.prototype.update=jt.prototype.j;q.prototype.add=q.prototype.add;q.prototype.multiply=q.prototype.R;q.prototype.modulo=q.prototype.gb;q.prototype.compare=q.prototype.X;q.prototype.toNumber=q.prototype.ea;q.prototype.toString=q.prototype.toString;q.prototype.getBits=q.prototype.D;q.fromNumber=Xt;q.fromString=bf;var Af=Ut.createWebChannelTransport=function(){return new gs},Sf=Ut.getStatEventTarget=function(){return As()},Vs=Ut.ErrorCode=Ss,Rf=Ut.EventType=jd,Df=Ut.Event=an,Tc=Ut.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},LT=Ut.FetchXmlHttpFactory=Zi,nr=Ut.WebChannel=Ud,Cf=Ut.XhrIo=Q,kf=Ut.Md5=jt,cn=Ut.Integer=q;var xf="@firebase/firestore";var st=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};st.UNAUTHENTICATED=new st(null),st.GOOGLE_CREDENTIALS=new st("google-credentials-uid"),st.FIRST_PARTY=new st("first-party-uid"),st.MOCK_USER=new st("mock-user");var vi="10.10.0";var Ve=new Wr("@firebase/firestore");function Kn(){return Ve.logLevel}function QT(n){Ve.setLogLevel(n)}function _(n,...t){if(Ve.logLevel<=Wt.DEBUG){let e=t.map(Sl);Ve.debug(`Firestore (${vi}): ${n}`,...e)}}function X(n,...t){if(Ve.logLevel<=Wt.ERROR){let e=t.map(Sl);Ve.error(`Firestore (${vi}): ${n}`,...e)}}function ie(n,...t){if(Ve.logLevel<=Wt.WARN){let e=t.map(Sl);Ve.warn(`Firestore (${vi}): ${n}`,...e)}}function Sl(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function A(n="Unexpected state"){let t=`FIRESTORE (${vi}) INTERNAL ASSERTION FAILED: `+n;throw X(t),new Error(t)}function R(n,t){n||A()}function HT(n,t){n||A()}function E(n,t){return n}var p={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends Eh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ot=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Ks=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Dc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(st.UNAUTHENTICATED))}shutdown(){}},Cc=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},kc=class{constructor(t){this.t=t,this.currentUser=st.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i,r=c=>this.i!==i?(i=this.i,e(c)):Promise.resolve(),s=new ot;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ot,t.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>g(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ot)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(R(typeof i.accessToken=="string"),new Ks(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return R(t===null||typeof t=="string"),new st(t)}},xc=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=st.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Pc=class{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new xc(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Nc=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Vc=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let i=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>i(s))};let r=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(R(typeof e.token=="string"),this.R=e.token,new Nc(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Vy(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}var $s=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,i="";for(;i.length<20;){let r=Vy(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<e&&(i+=t.charAt(r[s]%t.length))}return i}};function N(n,t){return n<t?-1:n>t?1:0}function ei(n,t,e){return n.length===t.length&&n.every((i,r)=>e(i,t[r]))}function Pm(n){return n+"\0"}var J=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new n(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?N(this.nanoseconds,t.nanoseconds):N(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var D=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new J(0,0))}static max(){return new n(new J(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ws=class n{constructor(t,e,i){e===void 0?e=0:e>t.length&&A(),i===void 0?i=t.length-e:i>t.length-e&&A(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let i=Math.min(t.length,e.length);for(let r=0;r<i;r++){let s=t.get(r),o=e.get(r);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},L=class n extends Ws{construct(t,e,i){return new n(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let i of t){if(i.indexOf("//")>=0)throw new y(p.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(r=>r.length>0))}return new n(e)}static emptyPath(){return new n([])}},My=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ct=class n extends Ws{construct(t,e,i){return new n(t,e,i)}static isValidIdentifier(t){return My.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],i="",r=0,s=()=>{if(i.length===0)throw new y(p.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""},o=!1;for(;r<t.length;){let a=t[r];if(a==="\\"){if(r+1===t.length)throw new y(p.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(p.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new y(p.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var b=class n{constructor(t){this.path=t}static fromPath(t){return new n(L.fromString(t))}static fromName(t){return new n(L.fromString(t).popFirst(5))}static empty(){return new n(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&L.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return L.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new L(t.slice()))}};var ni=class{constructor(t,e,i,r){this.indexId=t,this.collectionGroup=e,this.fields=i,this.indexState=r}};function Mc(n){return n.fields.find(t=>t.kind===2)}function ln(n){return n.fields.filter(t=>t.kind!==2)}ni.UNKNOWN_ID=-1;var Xn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var mr=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,Ft.min())}};function Nm(n,t){let e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=D.fromTimestamp(i===1e9?new J(e+1,0):new J(e,i));return new Ft(r,b.empty(),t)}function Vm(n){return new Ft(n.readTime,n.key,-1)}var Ft=class n{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new n(D.min(),b.empty(),-1)}static max(){return new n(D.max(),b.empty(),-1)}};function Rl(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=b.comparator(n.documentKey,t.documentKey),e!==0?e:N(n.largestBatchId,t.largestBatchId))}var Mm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Qs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function $e(n){return g(this,null,function*(){if(n.code!==p.FAILED_PRECONDITION||n.message!==Mm)throw n;_("LocalStore","Unexpectedly lost primary lease")})}var m=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&A(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(e,s).next(i,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,i)=>{e(t)})}static reject(t){return new n((e,i)=>{i(t)})}static waitFor(t){return new n((e,i)=>{let r=0,s=0,o=!1;t.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&e()},c=>i(c))}),o=!0,s===r&&e()})}static or(t){let e=n.resolve(!1);for(let i of t)e=e.next(r=>r?n.resolve(r):i());return e}static forEach(t,e){let i=[];return t.forEach((r,s)=>{i.push(e.call(this,r,s))}),this.waitFor(i)}static mapArray(t,e){return new n((i,r)=>{let s=t.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;e(t[u]).next(l=>{o[u]=l,++a,a===s&&i(o)},l=>r(l))}})}static doWhile(t,e){return new n((i,r)=>{let s=()=>{t()===!0?e().next(()=>{s()},r):i()};s()})}};var Hs=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new ot,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new gn(t,e.error)):this.V.resolve()},this.transaction.onerror=i=>{let r=Dl(i.target.error);this.V.reject(new gn(t,r))}}static open(t,e,i,r){try{return new n(e,t.transaction(r,i))}catch(s){throw new gn(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(_("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Fc(e)}},me=class n{constructor(t,e,i){this.name=t,this.version=e,this.p=i,n.S(Si())===12.2&&X("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _("SimpleDb","Removing database:",t),hn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!$r())return!1;if(n.C())return!0;let t=Si(),e=n.S(t),i=0<e&&e<10,r=n.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static v(t){let e=t.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}O(t){return g(this,null,function*(){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;e(o)},r.onblocked=()=>{i(new gn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new y(p.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new y(p.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new gn(t,o))},r.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,r.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db})}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,i,r){return g(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=Hs.open(this.db,t,s?"readonly":"readwrite",i),c=r(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),m.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Oc=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return hn(this.k.delete())}},gn=class extends y{constructor(t,e){super(p.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function We(n){return n.name==="IndexedDbTransactionError"}var Fc=class{constructor(t){this.store=t}put(t,e){let i;return e!==void 0?(_("SimpleDb","PUT",this.store.name,t,e),i=this.store.put(e,t)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",t),i=this.store.put(t)),hn(i)}add(t){return _("SimpleDb","ADD",this.store.name,t,t),hn(this.store.add(t))}get(t){return hn(this.store.get(t)).next(e=>(e===void 0&&(e=null),_("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _("SimpleDb","DELETE",this.store.name,t),hn(this.store.delete(t))}count(){return _("SimpleDb","COUNT",this.store.name),hn(this.store.count())}W(t,e){let i=this.options(t,e),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new m((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(i),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(t,e){let i=this.store.getAll(t,e===null?void 0:e);return new m((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}H(t,e){_("SimpleDb","DELETE ALL",this.store.name);let i=this.options(t,e);i.J=!1;let r=this.cursor(i);return this.G(r,(s,o,a)=>a.delete())}Y(t,e){let i;e?i=t:(i={},e=t);let r=this.cursor(i);return this.G(r,e)}Z(t){let e=this.cursor({});return new m((i,r)=>{e.onerror=s=>{let o=Dl(s.target.error);r(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}G(t,e){let i=[];return new m((r,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let c=new Oc(a),u=e(a.primaryKey,a.value,c);if(u instanceof m){let l=u.catch(h=>(c.done(),m.reject(h)));i.push(l)}c.isDone?r():c.$===null?a.continue():a.continue(c.$)}}).next(()=>m.waitFor(i))}options(t,e){let i;return t!==void 0&&(typeof t=="string"?i=t:e=t),{index:i,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let i=this.store.index(t.index);return t.J?i.openKeyCursor(t.range,e):i.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function hn(n){return new m((t,e)=>{n.onsuccess=i=>{let r=i.target.result;t(r)},n.onerror=i=>{let r=Dl(i.target.error);e(r)}})}var Pf=!1;function Dl(n){let t=me.S(Si());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let i=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Pf||(Pf=!0,setTimeout(()=>{throw i},0)),i}}return n}var Lc=class{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(t){_("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>g(this,null,function*(){this.task=null;try{_("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(e){We(e)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield $e(e)}yield this.ee(6e4)}))}},Bc=class{constructor(t,e){this.localStore=t,this.persistence=e}te(t=50){return g(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ne(e,t))})}ne(t,e){let i=new Set,r=e,s=!0;return m.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!i.has(o))return _("IndexBackfiller",`Processing collection: ${o}`),this.re(t,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>e-r)}re(t,e,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(r=>this.localStore.localDocuments.getNextDocuments(t,e,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ie(r,s)).next(a=>(_("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ie(t,e){let i=t;return e.changes.forEach((r,s)=>{let o=Vm(s);Rl(o,i)>0&&(i=o)}),new Ft(i.readTime,i.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Pt=(()=>{class n{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=r=>this.se(r),this.oe=r=>i.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function Fr(n){return n==null}function pr(n){return n===0&&1/n==-1/0}function Om(n){return typeof n=="number"&&Number.isInteger(n)&&!pr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function St(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Nf(t)),t=Oy(n.get(e),t);return Nf(t)}function Oy(n,t){let e=t,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Nf(n){return n+""}function Jt(n){let t=n.length;if(R(t>=2),t===2)return R(n.charAt(0)===""&&n.charAt(1)===""),L.emptyPath();let e=t-2,i=[],r="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&A(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:A()}s=o+2}return new L(i)}var Vf=["userId","batchId"];function Bs(n,t){return[n,St(t)]}function Fm(n,t,e){return[n,St(t),e]}var Fy={},Ly=["prefixPath","collectionGroup","readTime","documentId"],By=["prefixPath","collectionGroup","documentId"],jy=["collectionGroup","readTime","prefixPath","documentId"],Uy=["canonicalId","targetId"],qy=["targetId","path"],zy=["path","targetId"],Gy=["collectionId","parent"],Ky=["indexId","uid"],$y=["uid","sequenceNumber"],Wy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Qy=["indexId","uid","orderedDocumentKey"],Hy=["userId","collectionPath","documentId"],Yy=["userId","collectionPath","largestBatchId"],Xy=["userId","collectionGroup","largestBatchId"],Lm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Jy=[...Lm,"documentOverlays"],Bm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jm=Bm,Zy=[...jm,"indexConfiguration","indexState","indexEntries"];var gr=class extends Qs{constructor(t,e){super(),this.ae=t,this.currentSequenceNumber=e}};function mt(n,t){let e=E(n);return me.M(e.ae,t)}function Mf(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Rn(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Um(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var $=class n{constructor(t,e){this.comparator=t,this.root=e||te.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,te.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,te.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(t,i.key);if(r===0)return e+i.left.size;r<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){let t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Yn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Yn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Yn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Yn(this.root,t,this.comparator,!0)}},Yn=class{constructor(t,e,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?i(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},te=class n{constructor(t,e,i,r,s){this.key=t,this.value=e,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,r,s){return new n(t??this.key,e??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this,s=i(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,i),null):s===0?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),e(t,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw A();let t=this.left.check();if(t!==this.right.check())throw A();return t+(this.isRed()?0:1)}};te.EMPTY=null,te.RED=!0,te.BLACK=!1;te.EMPTY=new class{constructor(){this.size=0}get key(){throw A()}get value(){throw A()}get color(){throw A()}get left(){throw A()}get right(){throw A()}copy(t,e,i,r,s){return this}insert(t,e,i){return new te(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var G=class n{constructor(t){this.comparator=t,this.data=new $(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){let i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ys(this.data.getIterator())}getIteratorFrom(t){return new Ys(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Ys=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Un(n){return n.hasNext()?n.getNext():void 0}var Nt=class n{constructor(t){this.fields=t,t.sort(ct.comparator)}static empty(){return new n([])}unionWith(t){let e=new G(ct.comparator);for(let i of this.fields)e=e.add(i);for(let i of t)e=e.add(i);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ei(this.fields,t.fields,(e,i)=>e.isEqual(i))}};var Xs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function XT(){return typeof atob<"u"}var ft=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Xs("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return N(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var tv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Me(n){if(R(!!n),typeof n=="string"){let t=0,e=tv.exec(n);if(R(!!e),e[1]){let r=e[1];r=(r+"000000000").substr(0,9),t=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:H(n.seconds),nanos:H(n.nanos)}}function H(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Oe(n){return typeof n=="string"?ft.fromBase64String(n):ft.fromUint8Array(n)}function qo(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Cl(n){let t=n.mapValue.fields.__previous_value__;return qo(t)?Cl(t):t}function _r(n){let t=Me(n.mapValue.fields.__local_write_time__.timestampValue);return new J(t.seconds,t.nanos)}var jc=class{constructor(t,e,i,r,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},ii=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Ne={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},js={nullValue:"NULL_VALUE"};function _n(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qo(n)?4:qm(n)?9007199254740991:10:A()}function re(n,t){if(n===t)return!0;let e=_n(n);if(e!==_n(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return _r(n).isEqual(_r(t));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=Me(r.timestampValue),a=Me(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(r,s){return Oe(r.bytesValue).isEqual(Oe(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(r,s){return H(r.geoPointValue.latitude)===H(s.geoPointValue.latitude)&&H(r.geoPointValue.longitude)===H(s.geoPointValue.longitude)}(n,t);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return H(r.integerValue)===H(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=H(r.doubleValue),a=H(s.doubleValue);return o===a?pr(o)===pr(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return ei(n.arrayValue.values||[],t.arrayValue.values||[],re);case 10:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(Mf(o)!==Mf(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!re(o[c],a[c])))return!1;return!0}(n,t);default:return A()}}function yr(n,t){return(n.values||[]).find(e=>re(e,t))!==void 0}function Fe(n,t){if(n===t)return 0;let e=_n(n),i=_n(t);if(e!==i)return N(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return N(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=H(s.integerValue||s.doubleValue),c=H(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,t);case 3:return Of(n.timestampValue,t.timestampValue);case 4:return Of(_r(n),_r(t));case 5:return N(n.stringValue,t.stringValue);case 6:return function(s,o){let a=Oe(s),c=Oe(o);return a.compareTo(c)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=N(a[u],c[u]);if(l!==0)return l}return N(a.length,c.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=N(H(s.latitude),H(o.latitude));return a!==0?a:N(H(s.longitude),H(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=Fe(a[u],c[u]);if(l)return l}return N(a.length,c.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Ne.mapValue&&o===Ne.mapValue)return 0;if(s===Ne.mapValue)return 1;if(o===Ne.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){let d=N(c[h],l[h]);if(d!==0)return d;let f=Fe(a[c[h]],u[l[h]]);if(f!==0)return f}return N(c.length,l.length)}(n.mapValue,t.mapValue);default:throw A()}}function Of(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return N(n,t);let e=Me(n),i=Me(t),r=N(e.seconds,i.seconds);return r!==0?r:N(e.nanos,i.nanos)}function ri(n){return Uc(n)}function Uc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let i=Me(e);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Oe(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return b.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let i="[",r=!0;for(let s of e.values||[])r?r=!1:i+=",",i+=Uc(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(e){let i=Object.keys(e.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${Uc(e.fields[o])}`;return r+"}"}(n.mapValue):A()}function yn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function qc(n){return!!n&&"integerValue"in n}function vr(n){return!!n&&"arrayValue"in n}function Ff(n){return!!n&&"nullValue"in n}function Lf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Us(n){return!!n&&"mapValue"in n}function ur(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Rn(n.mapValue.fields,(e,i)=>t.mapValue.fields[e]=ur(i)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ur(n.arrayValue.values[e]);return t}return Object.assign({},n)}function qm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function ev(n){return"nullValue"in n?js:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?yn(ii.empty(),b.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:A()}function nv(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?yn(ii.empty(),b.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ne:A()}function Bf(n,t){let e=Fe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function jf(n,t){let e=Fe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var Tt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Us(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ur(e)}setAll(t){let e=ct.emptyPath(),i={},r=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let c=this.getFieldsMap(e);this.applyChanges(c,i,r),i={},r=[],e=a.popLast()}o?i[a.lastSegment()]=ur(o):r.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,i,r)}delete(t){let e=this.field(t.popLast());Us(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return re(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let r=e.mapValue.fields[t.get(i)];Us(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,i){Rn(e,(r,s)=>t[r]=s);for(let r of i)delete t[r]}clone(){return new n(ur(this.value))}};function zm(n){let t=[];return Rn(n.fields,(e,i)=>{let r=new ct([e]);if(Us(i)){let s=zm(i.mapValue).fields;if(s.length===0)t.push(r);else for(let o of s)t.push(r.child(o))}else t.push(r)}),new Nt(t)}var at=class n{constructor(t,e,i,r,s,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,D.min(),D.min(),D.min(),Tt.empty(),0)}static newFoundDocument(t,e,i,r){return new n(t,1,e,D.min(),i,r,0)}static newNoDocument(t,e){return new n(t,2,e,D.min(),D.min(),Tt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,D.min(),D.min(),Tt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(D.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Tt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=D.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var se=class{constructor(t,e){this.position=t,this.inclusive=e}};function Uf(n,t,e){let i=0;for(let r=0;r<n.position.length;r++){let s=t[r],o=n.position[r];if(s.field.isKeyField()?i=b.comparator(b.fromName(o.referenceValue),e.key):i=Fe(o,e.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function qf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!re(n.position[e],t.position[e]))return!1;return!0}var vn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function iv(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Js=class{},O=class n extends Js{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new Kc(t,e,i):e==="array-contains"?new Qc(t,i):e==="in"?new Zs(t,i):e==="not-in"?new Hc(t,i):e==="array-contains-any"?new Yc(t,i):new n(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new $c(t,i):new Wc(t,i)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Fe(e,this.value)):e!==null&&_n(this.value)===_n(e)&&this.matchesComparison(Fe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return A()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},z=class n extends Js{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return si(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function si(n){return n.op==="and"}function zc(n){return n.op==="or"}function kl(n){return Gm(n)&&si(n)}function Gm(n){for(let t of n.filters)if(t instanceof z)return!1;return!0}function Gc(n){if(n instanceof O)return n.field.canonicalString()+n.op.toString()+ri(n.value);if(kl(n))return n.filters.map(t=>Gc(t)).join(",");{let t=n.filters.map(e=>Gc(e)).join(",");return`${n.op}(${t})`}}function Km(n,t){return n instanceof O?function(i,r){return r instanceof O&&i.op===r.op&&i.field.isEqual(r.field)&&re(i.value,r.value)}(n,t):n instanceof z?function(i,r){return r instanceof z&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&Km(o,r.filters[a]),!0):!1}(n,t):void A()}function $m(n,t){let e=n.filters.concat(t);return z.create(e,n.op)}function Wm(n){return n instanceof O?function(e){return`${e.field.canonicalString()} ${e.op} ${ri(e.value)}`}(n):n instanceof z?function(e){return e.op.toString()+" {"+e.getFilters().map(Wm).join(" ,")+"}"}(n):"Filter"}var Kc=class extends O{constructor(t,e,i){super(t,e,i),this.key=b.fromName(i.referenceValue)}matches(t){let e=b.comparator(t.key,this.key);return this.matchesComparison(e)}},$c=class extends O{constructor(t,e){super(t,"in",e),this.keys=Qm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Wc=class extends O{constructor(t,e){super(t,"not-in",e),this.keys=Qm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Qm(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>b.fromName(i.referenceValue))}var Qc=class extends O{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return vr(e)&&yr(e.arrayValue,this.value)}},Zs=class extends O{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&yr(this.value.arrayValue,e)}},Hc=class extends O{constructor(t,e){super(t,"not-in",e)}matches(t){if(yr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!yr(this.value.arrayValue,e)}},Yc=class extends O{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!vr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>yr(this.value.arrayValue,i))}};var Xc=class{constructor(t,e=null,i=[],r=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Jc(n,t=null,e=[],i=[],r=null,s=null,o=null){return new Xc(n,t,e,i,r,s,o)}function wn(n){let t=E(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>Gc(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Fr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>ri(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>ri(i)).join(",")),t.ce=e}return t.ce}function Lr(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!iv(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Km(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!qf(n.startAt,t.startAt)&&qf(n.endAt,t.endAt)}function to(n){return b.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function eo(n,t){return n.filters.filter(e=>e instanceof O&&e.field.isEqual(t))}function zf(n,t,e){let i=js,r=!0;for(let s of eo(n,t)){let o=js,a=!0;switch(s.op){case"<":case"<=":o=ev(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=js}Bf({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];Bf({value:i,inclusive:r},{value:o,inclusive:e.inclusive})<0&&(i=o,r=e.inclusive);break}}return{value:i,inclusive:r}}function Gf(n,t,e){let i=Ne,r=!0;for(let s of eo(n,t)){let o=Ne,a=!0;switch(s.op){case">=":case">":o=nv(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ne}jf({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];jf({value:i,inclusive:r},{value:o,inclusive:e.inclusive})>0&&(i=o,r=e.inclusive);break}}return{value:i,inclusive:r}}var qt=class{constructor(t,e=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Hm(n,t,e,i,r,s,o,a){return new qt(n,t,e,i,r,s,o,a)}function wi(n){return new qt(n)}function Kf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function xl(n){return n.collectionGroup!==null}function Jn(n){let t=E(n);if(t.le===null){t.le=[];let e=new Set;for(let s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());let i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new G(ct.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new vn(s,i))}),e.has(ct.keyField().canonicalString())||t.le.push(new vn(ct.keyField(),i))}return t.le}function Rt(n){let t=E(n);return t.he||(t.he=rv(t,Jn(n))),t.he}function rv(n,t){if(n.limitType==="F")return Jc(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new vn(r.field,s)});let e=n.endAt?new se(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new se(n.startAt.position,n.startAt.inclusive):null;return Jc(n.path,n.collectionGroup,t,n.filters,n.limit,e,i)}}function Zc(n,t){let e=n.filters.concat([t]);return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function no(n,t,e){return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Br(n,t){return Lr(Rt(n),Rt(t))&&n.limitType===t.limitType}function Ym(n){return`${wn(Rt(n))}|lt:${n.limitType}`}function $n(n){return`Query(target=${function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map(r=>Wm(r)).join(", ")}]`),Fr(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(r=>ri(r)).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(r=>ri(r)).join(",")),`Target(${i})`}(Rt(n))}; limitType=${n.limitType})`}function jr(n,t){return t.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):b.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,t)&&function(i,r){for(let s of Jn(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,t)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,t)&&function(i,r){return!(i.startAt&&!function(o,a,c){let u=Uf(o,a,c);return o.inclusive?u<=0:u<0}(i.startAt,Jn(i),r)||i.endAt&&!function(o,a,c){let u=Uf(o,a,c);return o.inclusive?u>=0:u>0}(i.endAt,Jn(i),r))}(n,t)}function Xm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Jm(n){return(t,e)=>{let i=!1;for(let r of Jn(n)){let s=sv(r,t,e);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function sv(n,t,e){let i=n.field.isKeyField()?b.comparator(t.key,e.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?Fe(c,u):A()}(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return A()}}var oe=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let i=this.mapKeyFn(t),r=this.inner[i];if(r===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],t))return i.length===1?delete this.inner[e]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Rn(this.inner,(e,i)=>{for(let[r,s]of i)t(r,s)})}isEmpty(){return Um(this.inner)}size(){return this.innerSize}};var ov=new $(b.comparator);function kt(){return ov}var Zm=new $(b.comparator);function ar(...n){let t=Zm;for(let e of n)t=t.insert(e.key,e);return t}function tp(n){let t=Zm;return n.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function Zt(){return lr()}function ep(){return lr()}function lr(){return new oe(n=>n.toString(),(n,t)=>n.isEqual(t))}var av=new $(b.comparator),cv=new G(b.comparator);function V(...n){let t=cv;for(let e of n)t=t.add(e);return t}var uv=new G(N);function Pl(){return uv}function np(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pr(t)?"-0":t}}function ip(n){return{integerValue:""+n}}function rp(n,t){return Om(t)?ip(t):np(n,t)}var oi=class{constructor(){this._=void 0}};function lv(n,t,e){return n instanceof Le?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&qo(s)&&(s=Cl(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof pe?op(n,t):n instanceof ge?ap(n,t):function(r,s){let o=sp(r,s),a=$f(o)+$f(r.Ie);return qc(o)&&qc(r.Ie)?ip(a):np(r.serializer,a)}(n,t)}function hv(n,t,e){return n instanceof pe?op(n,t):n instanceof ge?ap(n,t):e}function sp(n,t){return n instanceof Be?function(i){return qc(i)||function(s){return!!s&&"doubleValue"in s}(i)}(t)?t:{integerValue:0}:null}var Le=class extends oi{},pe=class extends oi{constructor(t){super(),this.elements=t}};function op(n,t){let e=cp(t);for(let i of n.elements)e.some(r=>re(r,i))||e.push(i);return{arrayValue:{values:e}}}var ge=class extends oi{constructor(t){super(),this.elements=t}};function ap(n,t){let e=cp(t);for(let i of n.elements)e=e.filter(r=>!re(r,i));return{arrayValue:{values:e}}}var Be=class extends oi{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function $f(n){return H(n.integerValue||n.doubleValue)}function cp(n){return vr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var In=class{constructor(t,e){this.field=t,this.transform=e}};function dv(n,t){return n.field.isEqual(t.field)&&function(i,r){return i instanceof pe&&r instanceof pe||i instanceof ge&&r instanceof ge?ei(i.elements,r.elements,re):i instanceof Be&&r instanceof Be?re(i.Ie,r.Ie):i instanceof Le&&r instanceof Le}(n.transform,t.transform)}var tu=class{constructor(t,e){this.version=t,this.transformResults=e}},Y=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function qs(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var ai=class{};function up(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Ue(n.key,Y.none()):new je(n.key,n.data,Y.none());{let e=n.data,i=Tt.empty(),r=new G(ct.comparator);for(let s of t.fields)if(!r.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new zt(n.key,i,new Nt(r.toArray()),Y.none())}}function fv(n,t,e){n instanceof je?function(r,s,o){let a=r.value.clone(),c=Qf(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof zt?function(r,s,o){if(!qs(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Qf(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(lp(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,t,e):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function hr(n,t,e,i){return n instanceof je?function(s,o,a,c){if(!qs(s.precondition,o))return a;let u=s.value.clone(),l=Hf(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,t,e,i):n instanceof zt?function(s,o,a,c){if(!qs(s.precondition,o))return a;let u=Hf(s.fieldTransforms,c,o),l=o.data;return l.setAll(lp(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,i):function(s,o,a){return qs(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function mv(n,t){let e=null;for(let i of n.fieldTransforms){let r=t.data.field(i.field),s=sp(i.transform,r||null);s!=null&&(e===null&&(e=Tt.empty()),e.set(i.field,s))}return e||null}function Wf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&ei(i,r,(s,o)=>dv(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var je=class extends ai{constructor(t,e,i,r=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},zt=class extends ai{constructor(t,e,i,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function lp(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let i=n.data.field(e);t.set(e,i)}}),t}function Qf(n,t,e){let i=new Map;R(n.length===e.length);for(let r=0;r<e.length;r++){let s=n[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,hv(o,a,e[r]))}return i}function Hf(n,t,e){let i=new Map;for(let r of n){let s=r.transform,o=e.data.field(r.field);i.set(r.field,lv(s,o,t))}return i}var Ue=class extends ai{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},wr=class extends ai{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ir=class{constructor(t,e,i,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(t,e){let i=e.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(t.key)&&fv(s,t,i[r])}}applyToLocalView(t,e){for(let i of this.baseMutations)i.key.isEqual(t.key)&&(e=hr(i,t,e,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(t.key)&&(e=hr(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let i=ep();return this.mutations.forEach(r=>{let s=t.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(r.key)?null:a;let c=up(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(D.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),V())}isEqual(t){return this.batchId===t.batchId&&ei(this.mutations,t.mutations,(e,i)=>Wf(e,i))&&ei(this.baseMutations,t.baseMutations,(e,i)=>Wf(e,i))}},eu=class n{constructor(t,e,i,r){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=r}static from(t,e,i){R(t.mutations.length===i.length);let r=function(){return av}(),s=t.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(t,e,i,r)}};var Er=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var nu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var it,F;function hp(n){switch(n){default:return A();case p.CANCELLED:case p.UNKNOWN:case p.DEADLINE_EXCEEDED:case p.RESOURCE_EXHAUSTED:case p.INTERNAL:case p.UNAVAILABLE:case p.UNAUTHENTICATED:return!1;case p.INVALID_ARGUMENT:case p.NOT_FOUND:case p.ALREADY_EXISTS:case p.PERMISSION_DENIED:case p.FAILED_PRECONDITION:case p.ABORTED:case p.OUT_OF_RANGE:case p.UNIMPLEMENTED:case p.DATA_LOSS:return!0}}function dp(n){if(n===void 0)return X("GRPC error has no .code"),p.UNKNOWN;switch(n){case it.OK:return p.OK;case it.CANCELLED:return p.CANCELLED;case it.UNKNOWN:return p.UNKNOWN;case it.DEADLINE_EXCEEDED:return p.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return p.RESOURCE_EXHAUSTED;case it.INTERNAL:return p.INTERNAL;case it.UNAVAILABLE:return p.UNAVAILABLE;case it.UNAUTHENTICATED:return p.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return p.INVALID_ARGUMENT;case it.NOT_FOUND:return p.NOT_FOUND;case it.ALREADY_EXISTS:return p.ALREADY_EXISTS;case it.PERMISSION_DENIED:return p.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return p.FAILED_PRECONDITION;case it.ABORTED:return p.ABORTED;case it.OUT_OF_RANGE:return p.OUT_OF_RANGE;case it.UNIMPLEMENTED:return p.UNIMPLEMENTED;case it.DATA_LOSS:return p.DATA_LOSS;default:return A()}}(F=it||(it={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";var Yf=null;function fp(){return new TextEncoder}var pv=new cn([4294967295,4294967295],0);function Xf(n){let t=fp().encode(n),e=new kf;return e.update(t),new Uint8Array(e.digest())}function Jf(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new cn([e,i],0),new cn([r,s],0)]}var iu=class n{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new pn(`Invalid padding: ${e}`);if(i<0)throw new pn(`Invalid hash count: ${i}`);if(t.length>0&&this.hashCount===0)throw new pn(`Invalid hash count: ${i}`);if(t.length===0&&e!==0)throw new pn(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=cn.fromNumber(this.Te)}de(t,e,i){let r=t.add(e.multiply(cn.fromNumber(i)));return r.compare(pv)===1&&(r=new cn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=Xf(t),[i,r]=Jf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);if(!this.Ae(o))return!1}return!0}static create(t,e,i){let r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,r,e);return i.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=Xf(t),[i,r]=Jf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(i,r,s);this.Re(o)}}Re(t){let e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}},pn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Tr=class n{constructor(t,e,i,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,i){let r=new Map;return r.set(t,br.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new n(D.min(),r,new $(N),kt(),V())}},br=class n{constructor(t,e,i,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new n(i,e,V(),V(),V())}};var Zn=class{constructor(t,e,i,r){this.Ve=t,this.removedTargetIds=e,this.key=i,this.me=r}},io=class{constructor(t,e){this.targetId=t,this.fe=e}},ro=class{constructor(t,e,i=ft.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=r}},so=class{constructor(){this.ge=0,this.pe=tm(),this.ye=ft.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=V(),e=V(),i=V();return this.pe.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:i=i.add(r);break;default:A()}}),new br(this.ye,this.we,t,e,i)}Fe(){this.Se=!1,this.pe=tm()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,R(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},ru=class{constructor(t){this.Be=t,this.ke=new Map,this.qe=kt(),this.Qe=Zf(),this.Ke=new $(N)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let i=this.ze(e);switch(t.state){case 0:this.je(e)&&i.Ce(t.resumeToken);break;case 1:i.Ne(),i.be||i.Fe(),i.Ce(t.resumeToken);break;case 2:i.Ne(),i.be||this.removeTarget(e);break;case 3:this.je(e)&&(i.Le(),i.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),i.Ce(t.resumeToken));break;default:A()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((i,r)=>{this.je(r)&&e(r)})}Je(t){let e=t.targetId,i=t.fe.count,r=this.Ye(e);if(r){let s=r.target;if(to(s))if(i===0){let o=new b(s.path);this.We(e,o,at.newNoDocument(o,D.min()))}else R(i===1);else{let o=this.Ze(e);if(o!==i){let a=this.Xe(t),c=a?this.et(a,t,o):1;if(c!==0){this.He(e);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,u)}Yf?.tt(function(l,h,d,f,I){var v,w,C,x,S,M;let B={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},U=h.unchangedNames;return U&&(B.bloomFilter={applied:I===0,hashCount:(v=U?.hashCount)!==null&&v!==void 0?v:0,bitmapLength:(x=(C=(w=U?.bits)===null||w===void 0?void 0:w.bitmap)===null||C===void 0?void 0:C.length)!==null&&x!==void 0?x:0,padding:(M=(S=U?.bits)===null||S===void 0?void 0:S.padding)!==null&&M!==void 0?M:0,mightContain:ut=>{var Gt;return(Gt=f?.mightContain(ut))!==null&&Gt!==void 0&&Gt}}),B}(o,t.fe,this.Be.nt(),a,c))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=e,o,a;try{o=Oe(i).toUint8Array()}catch(c){if(c instanceof Xs)return ie("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new iu(o,r,s)}catch(c){return ie(c instanceof pn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(t,e,i){return e.fe.count===i-this.rt(t,e.targetId)?0:2}rt(t,e){let i=this.Be.getRemoteKeysForTarget(e),r=0;return i.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),r++)}),r}it(t){let e=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&to(a.target)){let c=new b(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,at.newNoDocument(c,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let i=V();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let r=new Tr(t,e,this.Ke,this.qe,i);return this.qe=kt(),this.Qe=Zf(),this.Ke=new $(N),r}Ue(t,e){if(!this.je(t))return;let i=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,i),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,i){if(!this.je(t))return;let r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),i&&(this.qe=this.qe.insert(e,i))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new so,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new G(N),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||_("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new so),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function Zf(){return new $(b.comparator)}function tm(){return new $(b.comparator)}var gv={asc:"ASCENDING",desc:"DESCENDING"},_v={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yv={and:"AND",or:"OR"},su=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function ou(n,t){return n.useProto3Json||Fr(t)?t:{value:t}}function ci(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mp(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function vv(n,t){return ci(n,t.toTimestamp())}function Z(n){return R(!!n),D.fromTimestamp(function(e){let i=Me(e);return new J(i.seconds,i.nanos)}(n))}function Nl(n,t){return au(n,t).canonicalString()}function au(n,t){let e=function(r){return new L(["projects",r.projectId,"databases",r.database])}(n).child("documents");return t===void 0?e:e.child(t)}function pp(n){let t=L.fromString(n);return R(Ap(t)),t}function Ar(n,t){return Nl(n.databaseId,t.path)}function ee(n,t){let e=pp(t);if(e.get(1)!==n.databaseId.projectId)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new b(yp(e))}function gp(n,t){return Nl(n.databaseId,t)}function _p(n){let t=pp(n);return t.length===4?L.emptyPath():yp(t)}function cu(n){return new L(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function yp(n){return R(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function em(n,t,e){return{name:Ar(n,t),fields:e.value.mapValue.fields}}function vp(n,t,e){let i=ee(n,t.name),r=Z(t.updateTime),s=t.createTime?Z(t.createTime):D.min(),o=new Tt({mapValue:{fields:t.fields}}),a=at.newFoundDocument(i,r,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function wv(n,t){return"found"in t?function(i,r){R(!!r.found),r.found.name,r.found.updateTime;let s=ee(i,r.found.name),o=Z(r.found.updateTime),a=r.found.createTime?Z(r.found.createTime):D.min(),c=new Tt({mapValue:{fields:r.found.fields}});return at.newFoundDocument(s,o,a,c)}(n,t):"missing"in t?function(i,r){R(!!r.missing),R(!!r.readTime);let s=ee(i,r.missing),o=Z(r.readTime);return at.newNoDocument(s,o)}(n,t):A()}function Iv(n,t){let e;if("targetChange"in t){t.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:A()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(R(l===void 0||typeof l=="string"),ft.fromBase64String(l||"")):(R(l===void 0||l instanceof Uint8Array),ft.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(u){let l=u.code===void 0?p.UNKNOWN:dp(u.code);return new y(l,u.message||"")}(o);e=new ro(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=ee(n,i.document.name),s=Z(i.document.updateTime),o=i.document.createTime?Z(i.document.createTime):D.min(),a=new Tt({mapValue:{fields:i.document.fields}}),c=at.newFoundDocument(r,s,o,a),u=i.targetIds||[],l=i.removedTargetIds||[];e=new Zn(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=ee(n,i.document),s=i.readTime?Z(i.readTime):D.min(),o=at.newNoDocument(r,s),a=i.removedTargetIds||[];e=new Zn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=ee(n,i.document),s=i.removedTargetIds||[];e=new Zn([],s,r,null)}else{if(!("filter"in t))return A();{t.filter;let i=t.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new nu(r,s),a=i.targetId;e=new io(a,o)}}return e}function Sr(n,t){let e;if(t instanceof je)e={update:em(n,t.key,t.value)};else if(t instanceof Ue)e={delete:Ar(n,t.key)};else if(t instanceof zt)e={update:em(n,t.key,t.data),updateMask:Rv(t.fieldMask)};else{if(!(t instanceof wr))return A();e={verify:Ar(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof Le)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof pe)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ge)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Be)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw A()}(0,i))),t.precondition.isNone||(e.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:vv(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:A()}(n,t.precondition)),e}function uu(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?Y.updateTime(Z(s.updateTime)):s.exists!==void 0?Y.exists(s.exists):Y.none()}(t.currentDocument):Y.none(),i=t.updateTransforms?t.updateTransforms.map(r=>function(o,a){let c=null;if("setToServerValue"in a)R(a.setToServerValue==="REQUEST_TIME"),c=new Le;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];c=new pe(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];c=new ge(l)}else"increment"in a?c=new Be(o,a.increment):A();let u=ct.fromServerFormat(a.fieldPath);return new In(u,c)}(n,r)):[];if(t.update){t.update.name;let r=ee(n,t.update.name),s=new Tt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(c){let u=c.fieldPaths||[];return new Nt(u.map(l=>ct.fromServerFormat(l)))}(t.updateMask);return new zt(r,s,o,e,i)}return new je(r,s,e,i)}if(t.delete){let r=ee(n,t.delete);return new Ue(r,e)}if(t.verify){let r=ee(n,t.verify);return new wr(r,e)}return A()}function Ev(n,t){return n&&n.length>0?(R(t!==void 0),n.map(e=>function(r,s){let o=r.updateTime?Z(r.updateTime):Z(s);return o.isEqual(D.min())&&(o=Z(s)),new tu(o,r.transformResults||[])}(e,t))):[]}function wp(n,t){return{documents:[gp(n,t.path)]}}function Ip(n,t){let e={structuredQuery:{}},i=t.path,r;t.collectionGroup!==null?(r=i,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),e.structuredQuery.from=[{collectionId:i.lastSegment()}]),e.parent=gp(n,r);let s=function(u){if(u.length!==0)return bp(z.create(u,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(d){return{field:Wn(d.field),direction:bv(d.dir)}}(l))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=ou(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(t.endAt)),{ut:e,parent:r}}function Ep(n){let t=_p(n.parent),e=n.structuredQuery,i=e.from?e.from.length:0,r=null;if(i>0){R(i===1);let l=e.from[0];l.allDescendants?r=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){let d=Tp(h);return d instanceof z&&kl(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(I){return new vn(Qn(I.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Fr(d)?null:d}(e.limit));let c=null;e.startAt&&(c=function(h){let d=!!h.before,f=h.values||[];return new se(f,d)}(e.startAt));let u=null;return e.endAt&&(u=function(h){let d=!h.before,f=h.values||[];return new se(f,d)}(e.endAt)),Hm(t,r,o,s,a,"F",c,u)}function Tv(n,t){let e=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return A()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Tp(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let i=Qn(e.unaryFilter.field);return O.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Qn(e.unaryFilter.field);return O.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Qn(e.unaryFilter.field);return O.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Qn(e.unaryFilter.field);return O.create(o,"!=",{nullValue:"NULL_VALUE"});default:return A()}}(n):n.fieldFilter!==void 0?function(e){return O.create(Qn(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return A()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return z.create(e.compositeFilter.filters.map(i=>Tp(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return A()}}(e.compositeFilter.op))}(n):A()}function bv(n){return gv[n]}function Av(n){return _v[n]}function Sv(n){return yv[n]}function Wn(n){return{fieldPath:n.canonicalString()}}function Qn(n){return ct.fromServerFormat(n.fieldPath)}function bp(n){return n instanceof O?function(e){if(e.op==="=="){if(Lf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NAN"}};if(Ff(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Lf(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NAN"}};if(Ff(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wn(e.field),op:Av(e.op),value:e.value}}}(n):n instanceof z?function(e){let i=e.getFilters().map(r=>bp(r));return i.length===1?i[0]:{compositeFilter:{op:Sv(e.op),filters:i}}}(n):A()}function Rv(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ap(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ui=class n{constructor(t,e,i,r,s=D.min(),o=D.min(),a=ft.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var oo=class{constructor(t){this.ct=t}};function Dv(n,t){let e;if(t.document)e=vp(n.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let i=b.fromSegments(t.noDocument.path),r=Tn(t.noDocument.readTime);e=at.newNoDocument(i,r),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return A();{let i=b.fromSegments(t.unknownDocument.path),r=Tn(t.unknownDocument.version);e=at.newUnknownDocument(i,r)}}return t.readTime&&e.setReadTime(function(r){let s=new J(r[0],r[1]);return D.fromTimestamp(s)}(t.readTime)),e}function nm(n,t){let e=t.key,i={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:ao(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document=function(s,o){return{name:Ar(s,o.key),fields:o.data.value.mapValue.fields,updateTime:ci(s,o.version.toTimestamp()),createTime:ci(s,o.createTime.toTimestamp())}}(n.ct,t);else if(t.isNoDocument())i.noDocument={path:e.path.toArray(),readTime:En(t.version)};else{if(!t.isUnknownDocument())return A();i.unknownDocument={path:e.path.toArray(),version:En(t.version)}}return i}function ao(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function En(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Tn(n){let t=new J(n.seconds,n.nanoseconds);return D.fromTimestamp(t)}function dn(n,t){let e=(t.baseMutations||[]).map(s=>uu(n.ct,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let a=t.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let i=t.mutations.map(s=>uu(n.ct,s)),r=J.fromMillis(t.localWriteTimeMs);return new Ir(t.batchId,r,e,i)}function cr(n){let t=Tn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?Tn(n.lastLimboFreeSnapshotVersion):D.min(),i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){return R(s.documents.length===1),Rt(wi(_p(s.documents[0])))}(n.query):function(s){return Rt(Ep(s))}(n.query),new ui(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,ft.fromBase64String(n.resumeToken))}function Sp(n,t){let e=En(t.snapshotVersion),i=En(t.lastLimboFreeSnapshotVersion),r;r=to(t.target)?wp(n.ct,t.target):Ip(n.ct,t.target).ut;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:wn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Vl(n){let t=Ep({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?no(t,t.limit,"L"):t}function bc(n,t){return new Er(t.largestBatchId,uu(n.ct,t.overlayMutation))}function im(n,t){let e=t.path.lastSegment();return[n,St(t.path.popLast()),e]}function rm(n,t,e,i){return{indexId:n,uid:t,sequenceNumber:e,readTime:En(i.readTime),documentKey:St(i.documentKey.path),largestBatchId:i.largestBatchId}}var lu=class{getBundleMetadata(t,e){return sm(t).get(e).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:Tn(s.createTime),version:s.version}}(i)})}saveBundleMetadata(t,e){return sm(t).put(function(r){return{bundleId:r.id,createTime:En(Z(r.createTime)),version:r.version}}(e))}getNamedQuery(t,e){return om(t).get(e).next(i=>{if(i)return function(s){return{name:s.name,query:Vl(s.bundledQuery),readTime:Tn(s.readTime)}}(i)})}saveNamedQuery(t,e){return om(t).put(function(r){return{name:r.name,readTime:En(Z(r.readTime)),bundledQuery:r.bundledQuery}}(e))}};function sm(n){return mt(n,"bundles")}function om(n){return mt(n,"namedQueries")}var co=class n{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let i=e.uid||"";return new n(t,i)}getOverlay(t,e){return ir(t).get(im(this.userId,e)).next(i=>i?bc(this.serializer,i):null)}getOverlays(t,e){let i=Zt();return m.forEach(e,r=>this.getOverlay(t,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(t,e,i){let r=[];return i.forEach((s,o)=>{let a=new Er(e,o);r.push(this.ht(t,a))}),m.waitFor(r)}removeOverlaysForBatchId(t,e,i){let r=new Set;e.forEach(o=>r.add(St(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(ir(t).H("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(t,e,i){let r=Zt(),s=St(e),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ir(t).W("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=bc(this.serializer,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(t,e,i,r){let s=Zt(),o,a=IDBKeyRange.bound([this.userId,e,i],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ir(t).Y({index:"collectionGroupOverlayIndex",range:a},(c,u,l)=>{let h=bc(this.serializer,u);s.size()<r||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(t,e){return ir(t).put(function(r,s,o){let[a,c,u]=im(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Sr(r.ct,o.mutation)}}(this.serializer,this.userId,e))}};function ir(n){return mt(n,"documentOverlays")}var de=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(H(t.integerValue));else if("doubleValue"in t){let i=H(t.doubleValue);isNaN(i)?this.Et(e,13):(this.Et(e,15),pr(i)?e.dt(0):e.dt(i))}else if("timestampValue"in t){let i=t.timestampValue;this.Et(e,20),typeof i=="string"?e.At(i):(e.At(`${i.seconds||""}`),e.dt(i.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Oe(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let i=t.geoPointValue;this.Et(e,45),e.dt(i.latitude||0),e.dt(i.longitude||0)}else"mapValue"in t?qm(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):A()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let i=t.fields||{};this.Et(e,55);for(let r of Object.keys(i))this.Rt(r,e),this.It(i[r],e)}wt(t,e){let i=t.values||[];this.Et(e,50);for(let r of i)this.It(r,e)}gt(t,e){this.Et(e,37),b.fromName(t).path.forEach(i=>{this.Et(e,60),this.St(i,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};de.bt=new de;function Cv(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function am(n){let t=64-function(i){let r=0;for(let s=0;s<8;++s){let o=Cv(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(t/8)}var hu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){let e=t[Symbol.iterator](),i=e.next();for(;!i.done;)this.Ct(i.value),i=e.next();this.vt()}Ft(t){let e=t[Symbol.iterator](),i=e.next();for(;!i.done;)this.Mt(i.value),i=e.next();this.xt()}Ot(t){for(let e of t){let i=e.charCodeAt(0);if(i<128)this.Ct(i);else if(i<2048)this.Ct(960|i>>>6),this.Ct(128|63&i);else if(e<"\uD800"||"\uDBFF"<e)this.Ct(480|i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i);else{let r=e.codePointAt(0);this.Ct(240|r>>>18),this.Ct(128|63&r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r)}}this.vt()}Nt(t){for(let e of t){let i=e.charCodeAt(0);if(i<128)this.Mt(i);else if(i<2048)this.Mt(960|i>>>6),this.Mt(128|63&i);else if(e<"\uD800"||"\uDBFF"<e)this.Mt(480|i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i);else{let r=e.codePointAt(0);this.Mt(240|r>>>18),this.Mt(128|63&r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r)}}this.xt()}Lt(t){let e=this.Bt(t),i=am(e);this.kt(1+i),this.buffer[this.position++]=255&i;for(let r=e.length-i;r<e.length;++r)this.buffer[this.position++]=255&e[r]}qt(t){let e=this.Bt(t),i=am(e);this.kt(1+i),this.buffer[this.position++]=~(255&i);for(let r=e.length-i;r<e.length;++r)this.buffer[this.position++]=~(255&e[r])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),i=(128&e[0])!=0;e[0]^=i?255:128;for(let r=1;r<e.length;++r)e[r]^=i?255:0;return e}Ct(t){let e=255&t;e===0?(this.Kt(0),this.Kt(255)):e===255?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){let e=t+this.position;if(e<=this.buffer.length)return;let i=2*this.buffer.length;i<e&&(i=e);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},du=class{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Lt(t)}Tt(){this.Gt.Qt()}},fu=class{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}},fn=class{constructor(){this.Gt=new hu,this.zt=new du(this.Gt),this.jt=new fu(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return t===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var mn=class n{constructor(t,e,i,r){this.indexId=t,this.documentKey=e,this.arrayValue=i,this.directionalValue=r}Jt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,i=new Uint8Array(e);return i.set(this.directionalValue,0),e!==t?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function Ce(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=cm(n.arrayValue,t.arrayValue),e!==0?e:(e=cm(n.directionalValue,t.directionalValue),e!==0?e:b.comparator(n.documentKey,t.documentKey)))}function cm(n,t){for(let e=0;e<n.length&&e<t.length;++e){let i=n[e]-t[e];if(i!==0)return i}return n.length-t.length}var uo=class{constructor(t){this.Yt=new G((e,i)=>ct.comparator(e.field,i.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(let e of t.filters){let i=e;i.isInequality()?this.Yt=this.Yt.add(i):this.Xt.push(i)}}get en(){return this.Yt.size>1}tn(t){if(R(t.collectionGroup===this.collectionId),this.en)return!1;let e=Mc(t);if(e!==void 0&&!this.nn(e))return!1;let i=ln(t),r=new Set,s=0,o=0;for(;s<i.length&&this.nn(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!r.has(a.field.canonicalString())){let c=i[s];if(!this.rn(a,c)||!this.sn(this.Zt[o++],c))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let t=new G(ct.comparator),e=[];for(let i of this.Xt)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")e.push(new Xn(i.field,2));else{if(t.has(i.field))continue;t=t.add(i.field),e.push(new Xn(i.field,0))}for(let i of this.Zt)i.field.isKeyField()||t.has(i.field)||(t=t.add(i.field),e.push(new Xn(i.field,i.dir==="asc"?0:1)));return new ni(ni.UNKNOWN_ID,this.collectionId,e,mr.empty())}nn(t){for(let e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let i=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===i}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Rp(n){var t,e;if(R(n instanceof O||n instanceof z),n instanceof O){if(n instanceof Zs){let r=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>O.create(n.field,"==",s)))||[];return z.create(r,"or")}return n}let i=n.filters.map(r=>Rp(r));return z.create(i,n.op)}function kv(n){if(n.getFilters().length===0)return[];let t=gu(Rp(n));return R(Dp(t)),mu(t)||pu(t)?[t]:t.getFilters()}function mu(n){return n instanceof O}function pu(n){return n instanceof z&&kl(n)}function Dp(n){return mu(n)||pu(n)||function(e){if(e instanceof z&&zc(e)){for(let i of e.getFilters())if(!mu(i)&&!pu(i))return!1;return!0}return!1}(n)}function gu(n){if(R(n instanceof O||n instanceof z),n instanceof O)return n;if(n.filters.length===1)return gu(n.filters[0]);let t=n.filters.map(i=>gu(i)),e=z.create(t,n.op);return e=lo(e),Dp(e)?e:(R(e instanceof z),R(si(e)),R(e.filters.length>1),e.filters.reduce((i,r)=>Ml(i,r)))}function Ml(n,t){let e;return R(n instanceof O||n instanceof z),R(t instanceof O||t instanceof z),e=n instanceof O?t instanceof O?function(r,s){return z.create([r,s],"and")}(n,t):um(n,t):t instanceof O?um(t,n):function(r,s){if(R(r.filters.length>0&&s.filters.length>0),si(r)&&si(s))return $m(r,s.getFilters());let o=zc(r)?r:s,a=zc(r)?s:r,c=o.filters.map(u=>Ml(u,a));return z.create(c,"or")}(n,t),lo(e)}function um(n,t){if(si(t))return $m(t,n.getFilters());{let e=t.filters.map(i=>Ml(n,i));return z.create(e,"or")}}function lo(n){if(R(n instanceof O||n instanceof z),n instanceof O)return n;let t=n.getFilters();if(t.length===1)return lo(t[0]);if(Gm(n))return n;let e=t.map(r=>lo(r)),i=[];return e.forEach(r=>{r instanceof O?i.push(r):r instanceof z&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:z.create(i,n.op)}var _u=class{constructor(){this._n=new Rr}addToCollectionParentIndex(t,e){return this._n.add(e),m.resolve()}getCollectionParents(t,e){return m.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return m.resolve()}deleteFieldIndex(t,e){return m.resolve()}deleteAllFieldIndexes(t){return m.resolve()}createTargetIndexes(t,e){return m.resolve()}getDocumentsMatchingTarget(t,e){return m.resolve(null)}getIndexType(t,e){return m.resolve(0)}getFieldIndexes(t,e){return m.resolve([])}getNextCollectionGroupToUpdate(t){return m.resolve(null)}getMinOffset(t,e){return m.resolve(Ft.min())}getMinOffsetFromCollectionGroup(t,e){return m.resolve(Ft.min())}updateCollectionGroup(t,e,i){return m.resolve()}updateIndexEntries(t,e){return m.resolve()}},Rr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e]||new G(L.comparator),s=!r.has(i);return this.index[e]=r.add(i),s}has(t){let e=t.lastSegment(),i=t.popLast(),r=this.index[e];return r&&r.has(i)}getEntries(t){return(this.index[t]||new G(L.comparator)).toArray()}};var Ms=new Uint8Array(0),yu=class{constructor(t,e){this.databaseId=e,this.an=new Rr,this.un=new oe(i=>wn(i),(i,r)=>Lr(i,r)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){let i=e.lastSegment(),r=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});let s={collectionId:i,parent:St(r)};return lm(t).put(s)}return m.resolve()}getCollectionParents(t,e){let i=[],r=IDBKeyRange.bound([e,""],[Pm(e),""],!1,!0);return lm(t).W(r).next(s=>{for(let o of s){if(o.collectionId!==e)break;i.push(Jt(o.parent))}return i})}addFieldIndex(t,e){let i=rr(t),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete r.indexId;let s=i.add(r);if(e.indexState){let o=zn(t);return s.next(a=>{o.put(rm(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let i=rr(t),r=zn(t),s=qn(t);return i.delete(e.indexId).next(()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=rr(t),i=qn(t),r=zn(t);return e.H().next(()=>i.H()).next(()=>r.H())}createTargetIndexes(t,e){return m.forEach(this.cn(e),i=>this.getIndexType(t,i).next(r=>{if(r===0||r===1){let s=new uo(i).on();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let i=qn(t),r=!0,s=new Map;return m.forEach(this.cn(e),o=>this.ln(t,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=V(),a=[];return m.forEach(s,(c,u)=>{_("IndexedDbIndexManager",`Using index ${function(S){return`id=${S.indexId}|cg=${S.collectionGroup}|f=${S.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`}(c)} to execute ${wn(e)}`);let l=function(S,M){let B=Mc(M);if(B===void 0)return null;for(let U of eo(S,B.fieldPath))switch(U.op){case"array-contains-any":return U.value.arrayValue.values||[];case"array-contains":return[U.value]}return null}(u,c),h=function(S,M){let B=new Map;for(let U of ln(M))for(let ut of eo(S,U.fieldPath))switch(ut.op){case"==":case"in":B.set(U.fieldPath.canonicalString(),ut.value);break;case"not-in":case"!=":return B.set(U.fieldPath.canonicalString(),ut.value),Array.from(B.values())}return null}(u,c),d=function(S,M){let B=[],U=!0;for(let ut of ln(M)){let Gt=ut.kind===0?zf(S,ut.fieldPath,S.startAt):Gf(S,ut.fieldPath,S.startAt);B.push(Gt.value),U&&(U=Gt.inclusive)}return new se(B,U)}(u,c),f=function(S,M){let B=[],U=!0;for(let ut of ln(M)){let Gt=ut.kind===0?Gf(S,ut.fieldPath,S.endAt):zf(S,ut.fieldPath,S.endAt);B.push(Gt.value),U&&(U=Gt.inclusive)}return new se(B,U)}(u,c),I=this.hn(c,u,d),v=this.hn(c,u,f),w=this.Pn(c,u,h),C=this.In(c.indexId,l,I,d.inclusive,v,f.inclusive,w);return m.forEach(C,x=>i.j(x,e.limit).next(S=>{S.forEach(M=>{let B=b.fromSegments(M.documentKey);o.has(B)||(o=o.add(B),a.push(B))})}))}).next(()=>a)}return m.resolve(null)})}cn(t){let e=this.un.get(t);return e||(t.filters.length===0?e=[t]:e=kv(z.create(t.filters,"and")).map(i=>Jc(t.path,t.collectionGroup,t.orderBy,i.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,i,r,s,o,a){let c=(e!=null?e.length:1)*Math.max(i.length,s.length),u=c/(e!=null?e.length:1),l=[];for(let h=0;h<c;++h){let d=e?this.Tn(e[h/u]):Ms,f=this.En(t,d,i[h%u],r),I=this.dn(t,d,s[h%u],o),v=a.map(w=>this.En(t,d,w,!0));l.push(...this.createRange(f,I,v))}return l}En(t,e,i,r){let s=new mn(t,b.empty(),e,i);return r?s:s.Jt()}dn(t,e,i,r){let s=new mn(t,b.empty(),e,i);return r?s.Jt():s}ln(t,e){let i=new uo(e),r=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,r).next(s=>{let o=null;for(let a of s)i.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let i=2,r=this.cn(e);return m.forEach(r,s=>this.ln(t,s).next(o=>{o?i!==0&&o.fields.length<function(c){let u=new G(ct.comparator),l=!1;for(let h of c.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:u=u.add(d.field));for(let h of c.orderBy)h.field.isKeyField()||(u=u.add(h.field));return u.size+(l?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(e)&&r.length>1&&i===2?1:i)}An(t,e){let i=new fn;for(let r of ln(t)){let s=e.data.field(r.fieldPath);if(s==null)return null;let o=i.Ht(r.kind);de.bt.Pt(s,o)}return i.Wt()}Tn(t){let e=new fn;return de.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){let i=new fn;return de.bt.Pt(yn(this.databaseId,e),i.Ht(function(s){let o=ln(s);return o.length===0?0:o[o.length-1].kind}(t))),i.Wt()}Pn(t,e,i){if(i===null)return[];let r=[];r.push(new fn);let s=0;for(let o of ln(t)){let a=i[s++];for(let c of r)if(this.Vn(e,o.fieldPath)&&vr(a))r=this.mn(r,o,a);else{let u=c.Ht(o.kind);de.bt.Pt(a,u)}}return this.fn(r)}hn(t,e,i){return this.Pn(t,e,i.position)}fn(t){let e=[];for(let i=0;i<t.length;++i)e[i]=t[i].Wt();return e}mn(t,e,i){let r=[...t],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let c=new fn;c.seed(a.Wt()),de.bt.Pt(o,c.Ht(e.kind)),s.push(c)}return s}Vn(t,e){return!!t.filters.find(i=>i instanceof O&&i.field.isEqual(e)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(t,e){let i=rr(t),r=zn(t);return(e?i.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):i.W()).next(s=>{let o=[];return m.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(l,h){let d=h?new mr(h.sequenceNumber,new Ft(Tn(h.readTime),new b(Jt(h.documentKey)),h.largestBatchId)):mr.empty(),f=l.fields.map(([I,v])=>new Xn(ct.fromServerFormat(I),v));return new ni(l.indexId,l.collectionGroup,f,d)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:N(i.collectionGroup,r.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,i){let r=rr(t),s=zn(t);return this.gn(t).next(o=>r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>m.forEach(a,c=>s.put(rm(c.indexId,this.uid,o,i)))))}updateIndexEntries(t,e){let i=new Map;return m.forEach(e,(r,s)=>{let o=i.get(r.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(t,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),m.forEach(a,c=>this.pn(t,r,c).next(u=>{let l=this.yn(s,c);return u.isEqual(l)?m.resolve():this.wn(t,s,c,u,l)}))))})}Sn(t,e,i,r){return qn(t).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(i,e.key),documentKey:e.key.path.toArray()})}bn(t,e,i,r){return qn(t).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(i,e.key),e.key.path.toArray()])}pn(t,e,i){let r=qn(t),s=new G(Ce);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.Rn(i,e)])},(o,a)=>{s=s.add(new mn(i.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(t,e){let i=new G(Ce),r=this.An(e,t);if(r==null)return i;let s=Mc(e);if(s!=null){let o=t.data.field(s.fieldPath);if(vr(o))for(let a of o.arrayValue.values||[])i=i.add(new mn(e.indexId,t.key,this.Tn(a),r))}else i=i.add(new mn(e.indexId,t.key,Ms,r));return i}wn(t,e,i,r,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(c,u,l,h,d){let f=c.getIterator(),I=u.getIterator(),v=Un(f),w=Un(I);for(;v||w;){let C=!1,x=!1;if(v&&w){let S=l(v,w);S<0?x=!0:S>0&&(C=!0)}else v!=null?x=!0:C=!0;C?(h(w),w=Un(I)):x?(d(v),v=Un(f)):(v=Un(f),w=Un(I))}}(r,s,Ce,a=>{o.push(this.Sn(t,e,i,a))},a=>{o.push(this.bn(t,e,i,a))}),m.waitFor(o)}gn(t){let e=1;return zn(t).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),e=r.sequenceNumber+1}).next(()=>e)}createRange(t,e,i){i=i.sort((o,a)=>Ce(o,a)).filter((o,a,c)=>!a||Ce(o,c[a-1])!==0);let r=[];r.push(t);for(let o of i){let a=Ce(o,t),c=Ce(o,e);if(a===0)r[0]=t.Jt();else if(a>0&&c<0)r.push(o),r.push(o.Jt());else if(c>0)break}r.push(e);let s=[];for(let o=0;o<r.length;o+=2){if(this.Dn(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,Ms,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,Ms,[]];s.push(IDBKeyRange.bound(a,c))}return s}Dn(t,e){return Ce(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(hm)}getMinOffset(t,e){return m.mapArray(this.cn(e),i=>this.ln(t,i).next(r=>r||A())).next(hm)}};function lm(n){return mt(n,"collectionParents")}function qn(n){return mt(n,"indexEntries")}function rr(n){return mt(n,"indexConfiguration")}function zn(n){return mt(n,"indexState")}function hm(n){R(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;Rl(r,t)<0&&(t=r),e<r.largestBatchId&&(e=r.largestBatchId)}return new Ft(t.readTime,t.documentKey,e)}var dm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ot=class n{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Cp(n,t,e){let i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),a=0,c=i.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(c.next(()=>{R(a===1)}));let u=[];for(let l of e.mutations){let h=Fm(t,l.key.path,e.batchId);s.push(r.delete(h)),u.push(l.key)}return m.waitFor(s).next(()=>u)}function ho(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw A();t=n.noDocument}return JSON.stringify(t).length}Ot.DEFAULT_COLLECTION_PERCENTILE=10,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ot.DEFAULT=new Ot(41943040,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ot.DISABLED=new Ot(-1,0,0);var fo=class n{constructor(t,e,i,r){this.userId=t,this.serializer=e,this.indexManager=i,this.referenceDelegate=r,this.Cn={}}static lt(t,e,i,r){R(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,i,r)}checkEmpty(t){let e=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ke(t).Y({index:"userMutationsIndex",range:i},(r,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,i,r){let s=Hn(t),o=ke(t);return o.add({}).next(a=>{R(typeof a=="number");let c=new Ir(a,e,i,r),u=function(f,I,v){let w=v.baseMutations.map(x=>Sr(f.ct,x)),C=v.mutations.map(x=>Sr(f.ct,x));return{userId:I,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:w,mutations:C}}(this.serializer,this.userId,c),l=[],h=new G((d,f)=>N(d.canonicalString(),f.canonicalString()));for(let d of r){let f=Fm(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(u)),l.push(s.put(f,Fy))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Cn[a]=c.keys()}),m.waitFor(l).next(()=>c)})}lookupMutationBatch(t,e){return ke(t).get(e).next(i=>i?(R(i.userId===this.userId),dn(this.serializer,i)):null)}vn(t,e){return this.Cn[e]?m.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(i=>{if(i){let r=i.keys();return this.Cn[e]=r,r}return null})}getNextMutationBatchAfterBatchId(t,e){let i=e+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return ke(t).Y({index:"userMutationsIndex",range:r},(o,a,c)=>{a.userId===this.userId&&(R(a.batchId>=i),s=dn(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=-1;return ke(t).Y({index:"userMutationsIndex",range:e,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ke(t).W("userMutationsIndex",e).next(i=>i.map(r=>dn(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(t,e){let i=Bs(this.userId,e.path),r=IDBKeyRange.lowerBound(i),s=[];return Hn(t).Y({range:r},(o,a,c)=>{let[u,l,h]=o,d=Jt(l);if(u===this.userId&&e.path.isEqual(d))return ke(t).get(h).next(f=>{if(!f)throw A();R(f.userId===this.userId),s.push(dn(this.serializer,f))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new G(N),r=[];return e.forEach(s=>{let o=Bs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Hn(t).Y({range:a},(u,l,h)=>{let[d,f,I]=u,v=Jt(f);d===this.userId&&s.path.isEqual(v)?i=i.add(I):h.done()});r.push(c)}),m.waitFor(r).next(()=>this.Fn(t,i))}getAllMutationBatchesAffectingQuery(t,e){let i=e.path,r=i.length+1,s=Bs(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new G(N);return Hn(t).Y({range:o},(c,u,l)=>{let[h,d,f]=c,I=Jt(d);h===this.userId&&i.isPrefixOf(I)?I.length===r&&(a=a.add(f)):l.done()}).next(()=>this.Fn(t,a))}Fn(t,e){let i=[],r=[];return e.forEach(s=>{r.push(ke(t).get(s).next(o=>{if(o===null)throw A();R(o.userId===this.userId),i.push(dn(this.serializer,o))}))}),m.waitFor(r).next(()=>i)}removeMutationBatch(t,e){return Cp(t.ae,this.userId,e).next(i=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),m.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(t,r))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return m.resolve();let i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return Hn(t).Y({range:i},(s,o,a)=>{if(s[0]===this.userId){let c=Jt(s[1]);r.push(c)}else a.done()}).next(()=>{R(r.length===0)})})}containsKey(t,e){return kp(t,this.userId,e)}xn(t){return xp(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function kp(n,t,e){let i=Bs(t,e.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return Hn(n).Y({range:s,J:!0},(a,c,u)=>{let[l,h,d]=a;l===t&&h===r&&(o=!0),u.done()}).next(()=>o)}function ke(n){return mt(n,"mutations")}function Hn(n){return mt(n,"documentMutations")}function xp(n){return mt(n,"mutationQueues")}var li=class n{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var vu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let i=new li(e.highestTargetId);return e.highestTargetId=i.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>D.fromTimestamp(new J(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,i){return this.Bn(t).next(r=>(r.highestListenSequenceNumber=e,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.kn(t,r)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Bn(t).next(i=>(i.targetCount+=1,this.Qn(e,i),this.kn(t,i))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Gn(t).delete(e.targetId)).next(()=>this.Bn(t)).next(i=>(R(i.targetCount>0),i.targetCount-=1,this.kn(t,i)))}removeTargets(t,e,i){let r=0,s=[];return Gn(t).Y((o,a)=>{let c=cr(a);c.sequenceNumber<=e&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(t,c)))}).next(()=>m.waitFor(s)).next(()=>r)}forEachTarget(t,e){return Gn(t).Y((i,r)=>{let s=cr(r);e(s)})}Bn(t){return fm(t).get("targetGlobalKey").next(e=>(R(e!==null),e))}kn(t,e){return fm(t).put("targetGlobalKey",e)}qn(t,e){return Gn(t).put(Sp(this.serializer,e))}Qn(t,e){let i=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,i=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,i=!0),i}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let i=wn(e),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return Gn(t).Y({range:r,index:"queryTargetsIndex"},(o,a,c)=>{let u=cr(a);Lr(e,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(t,e,i){let r=[],s=xe(t);return e.forEach(o=>{let a=St(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(t,i,o))}),m.waitFor(r)}removeMatchingKeys(t,e,i){let r=xe(t);return m.forEach(e,s=>{let o=St(s.path);return m.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(t,i,s)])})}removeMatchingKeysForTargetId(t,e){let i=xe(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(t,e){let i=IDBKeyRange.bound([e],[e+1],!1,!0),r=xe(t),s=V();return r.Y({range:i,J:!0},(o,a,c)=>{let u=Jt(o[1]),l=new b(u);s=s.add(l)}).next(()=>s)}containsKey(t,e){let i=St(e.path),r=IDBKeyRange.bound([i],[Pm(i)],!1,!0),s=0;return xe(t).Y({index:"documentTargetsIndex",J:!0,range:r},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}_t(t,e){return Gn(t).get(e).next(i=>i?cr(i):null)}};function Gn(n){return mt(n,"targets")}function fm(n){return mt(n,"targetGlobal")}function xe(n){return mt(n,"targetDocuments")}function mm([n,t],[e,i]){let r=N(n,e);return r===0?N(t,i):r}var wu=class{constructor(t){this.Kn=t,this.buffer=new G(mm),this.$n=0}Un(){return++this.$n}Wn(t){let e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{let i=this.buffer.last();mm(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}}get maxValue(){return this.buffer.last()[0]}},Iu=class{constructor(t,e,i){this.garbageCollector=t,this.asyncQueue=e,this.localStore=i,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(t){_("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>g(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){We(e)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield $e(e)}yield this.zn(3e5)}))}},Eu=class{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(i=>Math.floor(e/100*i))}nthSequenceNumber(t,e){if(e===0)return m.resolve(Pt._e);let i=new wu(e);return this.jn.forEachTarget(t,r=>i.Wn(r.sequenceNumber)).next(()=>this.jn.Jn(t,r=>i.Wn(r))).next(()=>i.maxValue)}removeTargets(t,e,i){return this.jn.removeTargets(t,e,i)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(dm)):this.getCacheSize(t).next(i=>i<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dm):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let i,r,s,o,a,c,u,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(t,r))).next(h=>(i=h,a=Date.now(),this.removeTargets(t,i,e))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(t,i))).next(h=>(u=Date.now(),Kn()<=Wt.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(u-c)+`ms
Total Duration: ${u-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}};function xv(n,t){return new Eu(n,t)}var Tu=class{constructor(t,e){this.db=t,this.garbageCollector=xv(this,e)}Hn(t){let e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(i=>e.next(r=>i+r))}Zn(t){let e=0;return this.Jn(t,i=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(i,r)=>e(r))}addReference(t,e,i){return Os(t,i)}removeReference(t,e,i){return Os(t,i)}removeTargets(t,e,i){return this.db.getTargetCache().removeTargets(t,e,i)}markPotentiallyOrphaned(t,e){return Os(t,e)}er(t,e){return function(r,s){let o=!1;return xp(r).Z(a=>kp(r,a,s).next(c=>(c&&(o=!0),m.resolve(!c)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.Xn(t,(o,a)=>{if(a<=e){let c=this.er(t,o).next(u=>{if(!u)return s++,i.getEntry(t,o).next(()=>(i.removeEntry(o,D.min()),xe(t).delete(function(h){return[0,St(h.path)]}(o))))});r.push(c)}}).next(()=>m.waitFor(r)).next(()=>i.apply(t)).next(()=>s)}removeTarget(t,e){let i=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,i)}updateLimboDocument(t,e){return Os(t,e)}Xn(t,e){let i=xe(t),r,s=Pt._e;return i.Y({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==Pt._e&&e(new b(Jt(r)),s),s=u,r=c):s=Pt._e}).next(()=>{s!==Pt._e&&e(new b(Jt(r)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Os(n,t){return xe(n).put(function(i,r){return{targetId:0,path:St(i.path),sequenceNumber:r}}(t,n.currentSequenceNumber))}var mo=class{constructor(){this.changes=new oe(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,at.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let i=this.changes.get(e);return i!==void 0?m.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var bu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,i){return un(t).put(i)}removeEntry(t,e,i){return un(t).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ao(o),a[a.length-1]]}(e,i))}updateMetadata(t,e){return this.getMetadata(t).next(i=>(i.byteSize+=e,this.tr(t,i)))}getEntry(t,e){let i=at.newInvalidDocument(e);return un(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(sr(e))},(r,s)=>{i=this.nr(e,s)}).next(()=>i)}rr(t,e){let i={size:0,document:at.newInvalidDocument(e)};return un(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(sr(e))},(r,s)=>{i={document:this.nr(e,s),size:ho(s)}}).next(()=>i)}getEntries(t,e){let i=kt();return this.ir(t,e,(r,s)=>{let o=this.nr(r,s);i=i.insert(r,o)}).next(()=>i)}sr(t,e){let i=kt(),r=new $(b.comparator);return this.ir(t,e,(s,o)=>{let a=this.nr(s,o);i=i.insert(s,a),r=r.insert(s,ho(o))}).next(()=>({documents:i,_r:r}))}ir(t,e,i){if(e.isEmpty())return m.resolve();let r=new G(_m);e.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(sr(r.first()),sr(r.last())),o=r.getIterator(),a=o.getNext();return un(t).Y({index:"documentKeyIndex",range:s},(c,u,l)=>{let h=b.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&_m(a,h)<0;)i(a,null),a=o.getNext();a&&a.isEqual(h)&&(i(a,u),a=o.hasNext()?o.getNext():null),a?l.U(sr(a)):l.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,i,r,s){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),ao(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return un(t).W(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let l=kt();for(let h of u){let d=this.nr(b.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(jr(e,d)||r.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,i,r){let s=kt(),o=gm(e,i),a=gm(e,Ft.max());return un(t).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,l)=>{let h=this.nr(b.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(h.key,h),s.size===r&&l.done()}).next(()=>s)}newChangeBuffer(t){return new Au(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return pm(t).get("remoteDocumentGlobalKey").next(e=>(R(!!e),e))}tr(t,e){return pm(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){let i=Dv(this.serializer,e);if(!(i.isNoDocument()&&i.version.isEqual(D.min())))return i}return at.newInvalidDocument(t)}};function Pp(n){return new bu(n)}var Au=class extends mo{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new oe(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(t){let e=[],i=0,r=new G((s,o)=>N(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(e.push(this.ar.removeEntry(t,s,a.readTime)),o.isValidDocument()){let c=nm(this.ar.serializer,o);r=r.add(s.path.popLast());let u=ho(c);i+=u-a.size,e.push(this.ar.addEntry(t,s,c))}else if(i-=a.size,this.trackRemovals){let c=nm(this.ar.serializer,o.convertToNoDocument(D.min()));e.push(this.ar.addEntry(t,s,c))}}),r.forEach(s=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.ar.updateMetadata(t,i)),m.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(i=>(this.ur.set(e,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:i,_r:r})=>(r.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function pm(n){return mt(n,"remoteDocumentGlobal")}function un(n){return mt(n,"remoteDocumentsV14")}function sr(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function gm(n,t){let e=t.documentKey.path.toArray();return[n,ao(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function _m(n,t){let e=n.path.toArray(),i=t.path.toArray(),r=0;for(let s=0;s<e.length-2&&s<i.length-2;++s)if(r=N(e[s],i[s]),r)return r;return r=N(e.length,i.length),r||(r=N(e[e.length-2],i[i.length-2]),r||N(e[e.length-1],i[i.length-1]))}var Su=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var po=class{constructor(t,e,i,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=r}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(i=r,this.remoteDocumentCache.getEntry(t,e))).next(r=>(i!==null&&hr(i.mutation,r,Nt.empty(),J.now()),r))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,V()).next(()=>i))}getLocalViewOfDocuments(t,e,i=V()){let r=Zt();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,i).next(s=>{let o=ar();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let i=Zt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,V()))}populateOverlays(t,e,i){let r=[];return i.forEach(s=>{e.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(t,r).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,i,r){let s=kt(),o=lr(),a=function(){return lr()}();return e.forEach((c,u)=>{let l=i.get(u.key);r.has(u.key)&&(l===void 0||l.mutation instanceof zt)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),hr(l.mutation,u,l.mutation.getFieldMask(),J.now())):o.set(u.key,Nt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),e.forEach((u,l)=>{var h;return a.set(u,new Su(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let i=lr(),r=new $((o,a)=>o-a),s=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=e.get(c);if(u===null)return;let l=i.get(c)||Nt.empty();l=a.applyToLocalView(u,l),i.set(c,l);let h=(r.get(a.batchId)||V()).add(c);r=r.insert(a.batchId,h)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,h=ep();l.forEach(d=>{if(!s.has(d)){let f=up(e.get(d),i.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,u,h))}return m.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i,r){return function(o){return b.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):xl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,r):this.getDocumentsMatchingCollectionQuery(t,e,i,r)}getNextDocuments(t,e,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,r-s.size):m.resolve(Zt()),a=-1,c=s;return o.next(u=>m.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{c=c.insert(l,d)}))).next(()=>this.populateOverlays(t,u,s)).next(()=>this.computeViews(t,c,u,V())).next(l=>({batchId:a,changes:tp(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new b(e)).next(i=>{let r=ar();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(t,e,i,r){let s=e.collectionGroup,o=ar();return this.indexManager.getCollectionParents(t,s).next(a=>m.forEach(a,c=>{let u=function(h,d){return new qt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,u,i,r).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,s,r))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,at.newInvalidDocument(l)))});let a=ar();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&hr(l.mutation,u,Nt.empty(),J.now()),jr(e,u)&&(a=a.insert(c,u))}),a})}};var Ru=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return m.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(r){return{id:r.id,version:r.version,createTime:Z(r.createTime)}}(e)),m.resolve()}getNamedQuery(t,e){return m.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(r){return{name:r.name,query:Vl(r.bundledQuery),readTime:Z(r.readTime)}}(e)),m.resolve()}};var Du=class{constructor(){this.overlays=new $(b.comparator),this.hr=new Map}getOverlay(t,e){return m.resolve(this.overlays.get(e))}getOverlays(t,e){let i=Zt();return m.forEach(e,r=>this.getOverlay(t,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((r,s)=>{this.ht(t,e,s)}),m.resolve()}removeOverlaysForBatchId(t,e,i){let r=this.hr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(i)),m.resolve()}getOverlaysForCollection(t,e,i){let r=Zt(),s=e.length+1,o=new b(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!e.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return m.resolve(r)}getOverlaysForCollectionGroup(t,e,i,r){let s=new $((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===e&&u.largestBatchId>i){let l=s.get(u.largestBatchId);l===null&&(l=Zt(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=Zt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=r)););return m.resolve(a)}ht(t,e,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.hr.get(r.largestBatchId).delete(i.key);this.hr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Er(e,i));let s=this.hr.get(e);s===void 0&&(s=V(),this.hr.set(e,s)),this.hr.set(e,s.add(i.key))}};var Dr=class{constructor(){this.Pr=new G(rt.Ir),this.Tr=new G(rt.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let i=new rt(t,e);this.Pr=this.Pr.add(i),this.Tr=this.Tr.add(i)}dr(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.Ar(new rt(t,e))}Rr(t,e){t.forEach(i=>this.removeReference(i,e))}Vr(t){let e=new b(new L([])),i=new rt(e,t),r=new rt(e,t+1),s=[];return this.Tr.forEachInRange([i,r],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new b(new L([])),i=new rt(e,t),r=new rt(e,t+1),s=V();return this.Tr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new rt(t,0),i=this.Pr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}},rt=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return b.comparator(t.key,e.key)||N(t.pr,e.pr)}static Er(t,e){return N(t.pr,e.pr)||b.comparator(t.key,e.key)}};var Cu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new G(rt.Ir)}checkEmpty(t){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,r){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ir(s,e,i,r);this.mutationQueue.push(o);for(let a of r)this.wr=this.wr.add(new rt(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(t,e){return m.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let i=e+1,r=this.br(i),s=r<0?0:r;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let i=new rt(e,0),r=new rt(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([i,r],o=>{let a=this.Sr(o.pr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new G(N);return e.forEach(r=>{let s=new rt(r,0),o=new rt(r,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{i=i.add(a.pr)})}),m.resolve(this.Dr(i))}getAllMutationBatchesAffectingQuery(t,e){let i=e.path,r=i.length+1,s=i;b.isDocumentKey(s)||(s=s.child(""));let o=new rt(new b(s),0),a=new G(N);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(c.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(t){let e=[];return t.forEach(i=>{let r=this.Sr(i);r!==null&&e.push(r)}),e}removeMutationBatch(t,e){R(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let i=this.wr;return m.forEach(e.mutations,r=>{let s=new rt(r.key,e.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.wr=i})}Mn(t){}containsKey(t,e){let i=new rt(e,0),r=this.wr.firstAfterOrEqual(i);return m.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,m.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var ku=class{constructor(t){this.vr=t,this.docs=function(){return new $(b.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let i=e.key,r=this.docs.get(i),s=r?r.size:0,o=this.vr(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let i=this.docs.get(e);return m.resolve(i?i.document.mutableCopy():at.newInvalidDocument(e))}getEntries(t,e){let i=kt();return e.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():at.newInvalidDocument(r))}),m.resolve(i)}getDocumentsMatchingQuery(t,e,i,r){let s=kt(),o=e.path,a=new b(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Rl(Vm(l),i)<=0||(r.has(l.key)||jr(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(t,e,i,r){A()}Fr(t,e){return m.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new xu(this)}getSize(t){return m.resolve(this.size)}},xu=class extends mo{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(i)}),m.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var Pu=class{constructor(t){this.persistence=t,this.Mr=new oe(e=>wn(e),Lr),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Dr,this.targetCount=0,this.Lr=li.Nn()}forEachTarget(t,e){return this.Mr.forEach((i,r)=>e(r)),m.resolve()}getLastRemoteSnapshotVersion(t){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return m.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Or&&(this.Or=e),m.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Lr=new li(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,m.resolve()}updateTargetData(t,e){return this.qn(e),m.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,m.resolve()}removeTargets(t,e,i){let r=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),r++)}),m.waitFor(s).next(()=>r)}getTargetCount(t){return m.resolve(this.targetCount)}getTargetData(t,e){let i=this.Mr.get(e)||null;return m.resolve(i)}addMatchingKeys(t,e,i){return this.Nr.dr(e,i),m.resolve()}removeMatchingKeys(t,e,i){this.Nr.Rr(e,i);let r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(o=>{s.push(r.markPotentiallyOrphaned(t,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),m.resolve()}getMatchingKeysForTargetId(t,e){let i=this.Nr.gr(e);return m.resolve(i)}containsKey(t,e){return m.resolve(this.Nr.containsKey(e))}};var go=class{constructor(t,e){this.Br={},this.overlays={},this.kr=new Pt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Pu(this),this.indexManager=new _u,this.remoteDocumentCache=function(r){return new ku(r)}(i=>this.referenceDelegate.Kr(i)),this.serializer=new oo(e),this.$r=new Ru(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Du,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.Br[t.toKey()];return i||(i=new Cu(e,this.referenceDelegate),this.Br[t.toKey()]=i),i}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,i){_("MemoryPersistence","Starting transaction:",t);let r=new Nu(this.kr.next());return this.referenceDelegate.Ur(),i(r).next(s=>this.referenceDelegate.Wr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Gr(t,e){return m.or(Object.values(this.Br).map(i=>()=>i.containsKey(t,e)))}},Nu=class extends Qs{constructor(t){super(),this.currentSequenceNumber=t}},_o=class n{constructor(t){this.persistence=t,this.zr=new Dr,this.jr=null}static Hr(t){return new n(t)}get Jr(){if(this.jr)return this.jr;throw A()}addReference(t,e,i){return this.zr.addReference(i,e),this.Jr.delete(i.toString()),m.resolve()}removeReference(t,e,i){return this.zr.removeReference(i,e),this.Jr.add(i.toString()),m.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),m.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(r=>this.Jr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(r=>{r.forEach(s=>this.Jr.add(s.toString()))}).next(()=>i.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,i=>{let r=b.fromPath(i);return this.Yr(t,r).next(s=>{s||e.removeEntry(r,D.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(i=>{i?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return m.or([()=>m.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var Vu=class{constructor(t){this.serializer=t}N(t,e,i,r){let s=new Hs("createOrUpgrade",e);i<1&&r>=1&&(function(c){c.createObjectStore("owner")}(t),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vf,{unique:!0}),c.createObjectStore("documentMutations")}(t),ym(t),function(c){c.createObjectStore("remoteDocuments")}(t));let o=m.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(t),ym(t)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:D.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",l)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").W().next(l=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vf,{unique:!0});let h=u.store("mutations"),d=l.map(f=>h.put(f));return m.waitFor(d)})}(t,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),i<5&&r>=5&&(o=o.next(()=>this.Xr(s))),i<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(t),this.ei(s)))),i<7&&r>=7&&(o=o.next(()=>this.ti(s))),i<8&&r>=8&&(o=o.next(()=>this.ni(t,s))),i<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),i<10&&r>=10&&(o=o.next(()=>this.ri(s))),i<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),i<12&&r>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:Hy});u.createIndex("collectionPathOverlayIndex",Yy,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Xy,{unique:!1})})(t)})),i<13&&r>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:Ly});u.createIndex("documentKeyIndex",By),u.createIndex("collectionGroupIndex",jy)}(t)).next(()=>this.ii(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.si(t,s))),i<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Ky}).createIndex("sequenceNumberIndex",$y,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Wy}).createIndex("documentKeyIndex",Qy,{unique:!1})}(t))),o}ei(t){let e=0;return t.store("remoteDocuments").Y((i,r)=>{e+=ho(r)}).next(()=>{let i={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Xr(t){let e=t.store("mutationQueues"),i=t.store("mutations");return e.W().next(r=>m.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",o).next(a=>m.forEach(a,c=>{R(c.userId===s.userId);let u=dn(this.serializer,c);return Cp(t,s.userId,u).next(()=>{})}))}))}ti(t){let e=t.store("targetDocuments"),i=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return i.Y((o,a)=>{let c=new L(o),u=function(h){return[0,St(h)]}(c);s.push(e.get(u).next(l=>l?m.resolve():(h=>e.put({targetId:0,path:St(h),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>m.waitFor(s))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:Gy});let i=e.store("collectionParents"),r=new Rr,s=o=>{if(r.add(o)){let a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:St(c)})}};return e.store("remoteDocuments").Y({J:!0},(o,a)=>{let c=new L(o);return s(c.popLast())}).next(()=>e.store("documentMutations").Y({J:!0},([o,a,c],u)=>{let l=Jt(a);return s(l.popLast())}))}ri(t){let e=t.store("targets");return e.Y((i,r)=>{let s=cr(r),o=Sp(this.serializer,s);return e.put(o)})}ii(t,e){let i=e.store("remoteDocuments"),r=[];return i.Y((s,o)=>{let a=e.store("remoteDocumentsV14"),c=function(h){return h.document?new b(L.fromString(h.document.name).popFirst(5)):h.noDocument?b.fromSegments(h.noDocument.path):h.unknownDocument?b.fromSegments(h.unknownDocument.path):A()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))}).next(()=>m.waitFor(r))}si(t,e){let i=e.store("mutations"),r=Pp(this.serializer),s=new go(_o.Hr,this.serializer.ct);return i.W().next(o=>{let a=new Map;return o.forEach(c=>{var u;let l=(u=a.get(c.userId))!==null&&u!==void 0?u:V();dn(this.serializer,c).keys().forEach(h=>l=l.add(h)),a.set(c.userId,l)}),m.forEach(a,(c,u)=>{let l=new st(u),h=co.lt(this.serializer,l),d=s.getIndexManager(l),f=fo.lt(l,this.serializer,d,s.referenceDelegate);return new po(r,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new gr(e,Pt._e),c).next()})})}};function ym(n){n.createObjectStore("targetDocuments",{keyPath:qy}).createIndex("documentTargetsIndex",zy,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Uy,{unique:!0}),n.createObjectStore("targetGlobal")}var Ac="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Mu=class n{constructor(t,e,i,r,s,o,a,c,u,l,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=i,this.oi=s,this.window=o,this.document=a,this._i=u,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new y(p.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Tu(this,r),this.Ti=e+"main",this.serializer=new oo(c),this.Ei=new me(this.Ti,this.ui,new Vu(this.serializer)),this.Qr=new vu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Pp(this.serializer),this.$r=new lu,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&X("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(p.FAILED_PRECONDITION,Ac);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Pt(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){return this.Ii=e=>g(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.B(e=>g(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Fs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(We(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return or(t).get("owner").next(e=>m.resolve(this.Si(e)))}bi(t){return Fs(t).delete(this.clientId)}Di(){return g(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let i=mt(e,"clientMetadata");return i.W().next(r=>{let s=this.vi(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let e of t)this.di.removeItem(this.Fi(e.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?m.resolve(!0):or(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new y(p.FAILED_PRECONDITION,Ac);return!1}}return!(!this.networkEnabled||!this.inForeground)||Fs(t).W().next(i=>this.vi(i,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return g(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new gr(t,Pt._e);return this.yi(e).next(()=>this.bi(e))}),this.Ei.close(),this.Li()})}vi(t,e){return t.filter(i=>this.Ci(i.updateTimeMs,e)&&!this.Mi(i.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>Fs(t).W().next(e=>this.vi(e,18e5).map(i=>i.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return fo.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new yu(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return co.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,i){_("IndexedDbPersistence","Starting transaction:",t);let r=e==="readonly"?"readonly":"readwrite",s=function(c){return c===15?Zy:c===14?jm:c===13?Bm:c===12?Jy:c===11?Lm:void A()}(this.ui),o;return this.Ei.runTransaction(t,r,s,a=>(o=new gr(a,this.kr?this.kr.next():Pt._e),e==="readwrite-primary"?this.gi(o).next(c=>!!c||this.pi(o)).next(c=>{if(!c)throw X(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new y(p.FAILED_PRECONDITION,Mm);return i(o)}).next(c=>this.wi(o).next(()=>c)):this.ki(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(t){return or(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new y(p.FAILED_PRECONDITION,Ac)})}wi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return or(t).put("owner",e)}static D(){return me.D()}yi(t){let e=or(t);return e.get("owner").next(i=>this.Si(i)?(_("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):m.resolve())}Ci(t,e){let i=Date.now();return!(t<i-e)&&(!(t>i)||(X(`Detected an update time that is in the future: ${t} > ${i}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;ua()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{let i=((e=this.di)===null||e===void 0?void 0:e.getItem(this.Fi(t)))!==null;return _("IndexedDbPersistence",`Client '${t}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return X("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){X("Failed to set zombie client id.",t)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function or(n){return mt(n,"owner")}function Fs(n){return mt(n,"clientMetadata")}function Ol(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Ou=class n{constructor(t,e,i,r){this.targetId=t,this.fromCache=e,this.qi=i,this.Qi=r}static Ki(t,e){let i=V(),r=V();for(let s of e.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(t,e.fromCache,i,r)}};var Fu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var yo=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return ua()?8:me.v(Si())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,i,r){let s={result:null};return this.ji(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,e,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Fu;return this.Ji(t,e,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,e,o,a.size)})}).next(()=>s.result)}Yi(t,e,i,r){return i.documentReadCount<this.Wi?(Kn()<=Wt.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",$n(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(Kn()<=Wt.DEBUG&&_("QueryEngine","Query:",$n(e),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Gi*r?(Kn()<=Wt.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",$n(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Rt(e))):m.resolve())}ji(t,e){if(Kf(e))return m.resolve(null);let i=Rt(e);return this.indexManager.getIndexType(t,i).next(r=>r===0?null:(e.limit!==null&&r===1&&(e=no(e,null,"F"),i=Rt(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(s=>{let o=V(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,i).next(c=>{let u=this.Zi(e,a);return this.Xi(e,u,o,c.readTime)?this.ji(t,no(e,null,"F")):this.es(t,u,e,c)}))})))}Hi(t,e,i,r){return Kf(e)||r.isEqual(D.min())?m.resolve(null):this.zi.getDocuments(t,i).next(s=>{let o=this.Zi(e,s);return this.Xi(e,o,i,r)?m.resolve(null):(Kn()<=Wt.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),$n(e)),this.es(t,o,e,Nm(r,-1)).next(a=>a))})}Zi(t,e){let i=new G(Jm(t));return e.forEach((r,s)=>{jr(t,s)&&(i=i.add(s))}),i}Xi(t,e,i,r){if(t.limit===null)return!1;if(i.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,i){return Kn()<=Wt.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",$n(e)),this.zi.getDocumentsMatchingQuery(t,e,Ft.min(),i)}es(t,e,i,r){return this.zi.getDocumentsMatchingQuery(t,i,r).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Lu=class{constructor(t,e,i,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new $(N),this.rs=new oe(s=>wn(s),Lr),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(i)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new po(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function Np(n,t,e,i){return new Lu(n,t,e,i)}function Vp(n,t){return g(this,null,function*(){let e=E(n);return yield e.persistence.runTransaction("Handle user change","readonly",i=>{let r;return e.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,e._s(t),e.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=V();for(let u of r){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return e.localDocuments.getDocuments(i,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function Pv(n,t){let e=E(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let h=u.batch,d=h.keys(),f=m.resolve();return d.forEach(I=>{f=f.next(()=>l.getEntry(c,I)).next(v=>{let w=u.docVersions.get(I);R(w!==null),v.version.compareTo(w)<0&&(h.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),l.addEntry(v)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(e,i,t,s).next(()=>s.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,r,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=V();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(t))).next(()=>e.localDocuments.getDocuments(i,r))})}function Mp(n){let t=E(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function Nv(n,t){let e=E(n),i=t.snapshotVersion,r=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.os.newChangeBuffer({trackRemovals:!0});r=e.ns;let a=[];t.targetChanges.forEach((l,h)=>{let d=r.get(h);if(!d)return;a.push(e.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?f=f.withResumeToken(ft.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,i)),r=r.insert(h,f),function(v,w,C){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(d,f,l)&&a.push(e.Qr.updateTargetData(s,f))});let c=kt(),u=V();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Op(s,o,t.documentUpdates).next(l=>{c=l.cs,u=l.ls})),!i.isEqual(D.min())){let l=e.Qr.getLastRemoteSnapshotVersion(s).next(h=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(e.ns=r,s))}function Op(n,t,e){let i=V(),r=V();return e.forEach(s=>i=i.add(s)),t.getEntries(n,i).next(s=>{let o=kt();return e.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(D.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{cs:o,ls:r}})}function Vv(n,t){let e=E(n);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function hi(n,t){let e=E(n);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return e.Qr.getTargetData(i,t).next(s=>s?(r=s,m.resolve(r)):e.Qr.allocateTargetId(i).next(o=>(r=new ui(t,o,"TargetPurposeListen",i.currentSequenceNumber),e.Qr.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=e.ns.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(i.targetId,i),e.rs.set(t,i.targetId)),i})}function di(n,t,e){return g(this,null,function*(){let i=E(n),r=i.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!We(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}i.ns=i.ns.remove(t),i.rs.delete(r.target)})}function vo(n,t,e){let i=E(n),r=D.min(),s=V();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let h=E(c),d=h.rs.get(l);return d!==void 0?m.resolve(h.ns.get(d)):h.Qr.getTargetData(u,l)}(i,o,Rt(t)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.ts.getDocumentsMatchingQuery(o,t,e?r:D.min(),e?s:V())).next(a=>(Bp(i,Xm(t),a),{documents:a,hs:s})))}function Fp(n,t){let e=E(n),i=E(e.Qr),r=e.ns.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",s=>i._t(s,t).next(o=>o?o.target:null))}function Lp(n,t){let e=E(n),i=e.ss.get(t)||D.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.os.getAllFromCollectionGroup(r,t,Nm(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(Bp(e,t,r),r))}function Bp(n,t,e){let i=n.ss.get(t)||D.min();e.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.ss.set(t,i)}function Mv(n,t,e,i){return g(this,null,function*(){let r=E(n),s=V(),o=kt();for(let u of e){let l=t.Ps(u.metadata.name);u.document&&(s=s.add(l));let h=t.Is(u);h.setReadTime(t.Ts(u.metadata.readTime)),o=o.insert(l,h)}let a=r.os.newChangeBuffer({trackRemovals:!0}),c=yield hi(r,function(l){return Rt(wi(L.fromString(`__bundle__/docs/${l}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",u=>Op(u,a,o).next(l=>(a.apply(u),l)).next(l=>r.Qr.removeMatchingKeysForTargetId(u,c.targetId).next(()=>r.Qr.addMatchingKeys(u,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,l.cs,l.ls)).next(()=>l.cs)))})}function Ov(i,r){return g(this,arguments,function*(n,t,e=V()){let s=yield hi(n,Rt(Vl(t.bundledQuery))),o=E(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=Z(t.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.$r.saveNamedQuery(a,t);let u=s.withResumeToken(ft.EMPTY_BYTE_STRING,c);return o.ns=o.ns.insert(u.targetId,u),o.Qr.updateTargetData(a,u).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,e,s.targetId)).next(()=>o.$r.saveNamedQuery(a,t))})})}function vm(n,t){return`firestore_clients_${n}_${t}`}function wm(n,t,e){let i=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(i+=`_${t.uid}`),i}function Sc(n,t){return`firestore_targets_${n}_${t}`}var wo=class n{constructor(t,e,i,r){this.user=t,this.batchId=e,this.state=i,this.error=r}static Es(t,e,i){let r=JSON.parse(i),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new y(r.error.code,r.error.message))),o?new n(t,e,r.state,s):(X("SharedClientState",`Failed to parse mutation state for ID '${e}': ${i}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},dr=class n{constructor(t,e,i){this.targetId=t,this.state=e,this.error=i}static Es(t,e){let i=JSON.parse(e),r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new y(i.error.code,i.error.message))),s?new n(t,i.state,r):(X("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Io=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){let i=JSON.parse(e),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Pl();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=Om(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(t,s):(X("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Bu=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(X("SharedClientState",`Failed to parse online state: ${t}`),null)}},Cr=class{constructor(){this.activeTargetIds=Pl()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},fr=class{constructor(t,e,i,r,s){this.window=t,this.oi=e,this.persistenceKey=i,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new $(N),this.started=!1,this.ys=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=vm(this.persistenceKey,this.Vs),this.Ss=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Cr),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){return g(this,null,function*(){let t=yield this.syncEngine.Bi();for(let i of t){if(i===this.Vs)continue;let r=this.getItem(vm(this.persistenceKey,i));if(r){let s=Io.Es(i,r);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let i=this.xs(e);i&&this.Os(i)}for(let i of this.ys)this.gs(i);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((i,r)=>{r.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ls(t,"pending")}updateMutationState(t,e,i){this.Ls(t,e,i),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(Sc(this.persistenceKey,t));if(i){let r=dr.Es(t,i);r&&(e=r.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Sc(this.persistenceKey,t))}updateQueryState(t,e,i){this.qs(t,e,i)}handleUserChange(t,e,i){e.forEach(r=>{this.Bs(r)}),this.currentUser=t,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return _("SharedClientState","READ",t,e),e}setItem(t,e){_("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){let e=t;if(e.storageArea===this.storage){if(_("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void X("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>g(this,null,function*(){if(this.started){if(e.key!==null){if(this.bs.test(e.key)){if(e.newValue==null){let i=this.$s(e.key);return this.Us(i,null)}{let i=this.Ws(e.key,e.newValue);if(i)return this.Us(i.clientId,i)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let i=this.Gs(e.key,e.newValue);if(i)return this.zs(i)}}else if(this.Cs.test(e.key)){if(e.newValue!==null){let i=this.js(e.key,e.newValue);if(i)return this.Hs(i)}}else if(e.key===this.vs){if(e.newValue!==null){let i=this.xs(e.newValue);if(i)return this.Os(i)}}else if(e.key===this.Ss){let i=function(s){let o=Pt._e;if(s!=null)try{let a=JSON.parse(s);R(typeof a=="number"),o=a}catch(a){X("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);i!==Pt._e&&this.sequenceNumberHandler(i)}else if(e.key===this.Fs){let i=this.Js(e.newValue);yield Promise.all(i.map(r=>this.syncEngine.Ys(r)))}}}else this.ys.push(e)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(t,e,i){let r=new wo(this.currentUser,t,e,i),s=wm(this.persistenceKey,this.currentUser,t);this.setItem(s,r.ds())}Bs(t){let e=wm(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){let e={clientId:this.Vs,onlineState:t};this.storage.setItem(this.vs,JSON.stringify(e))}qs(t,e,i){let r=Sc(this.persistenceKey,t),s=new dr(t,e,i);this.setItem(r,s.ds())}Ks(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){let e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){let i=this.$s(t);return Io.Es(i,e)}Gs(t,e){let i=this.Ds.exec(t),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return wo.Es(new st(s),r,e)}js(t,e){let i=this.Cs.exec(t),r=Number(i[1]);return dr.Es(r,e)}xs(t){return Bu.Es(t)}Js(t){return JSON.parse(t)}zs(t){return g(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Zs(t.batchId,t.state,t.error);_("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){let i=e?this.ps.insert(t,e):this.ps.remove(t),r=this.Ns(this.ps),s=this.Ns(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.eo(o,a).then(()=>{this.ps=i})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=Pl();return t.forEach((i,r)=>{e=e.unionWith(r.activeTargetIds)}),e}},Eo=class{constructor(){this.no=new Cr,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,i){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Cr,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var ju=class{io(t){}shutdown(){}};var To=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ls=null;function Rc(){return Ls===null?Ls=function(){return 268435456+Math.round(2147483648*Math.random())}():Ls++,"0x"+Ls.toString(16)}var Fv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Uu=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var Et="WebChannelConnection",qu=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let i=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=i+"://"+e.host,this.po=`projects/${r}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get wo(){return!1}So(e,i,r,s,o){let a=Rc(),c=this.bo(e,i.toUriEncodedString());_("RestConnection",`Sending RPC '${e}' ${a}:`,c,r);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(e,c,u,r).then(l=>(_("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw ie("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",c,"request:",r),l})}vo(e,i,r,s,o,a){return this.So(e,i,r,s,o)}Do(e,i,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+vi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}bo(e,i){let r=Fv[e];return`${this.fo}/v1/${i}:${r}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,i,r){let s=Rc();return new Promise((o,a)=>{let c=new Cf;c.setWithCredentials(!0),c.listenOnce(Rf.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Vs.NO_ERROR:let l=c.getResponseJson();_(Et,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Vs.TIMEOUT:_(Et,`RPC '${t}' ${s} timed out`),a(new y(p.DEADLINE_EXCEEDED,"Request time out"));break;case Vs.HTTP_ERROR:let h=c.getStatus();if(_(Et,`RPC '${t}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let I=function(w){let C=w.toLowerCase().replace(/_/g,"-");return Object.values(p).indexOf(C)>=0?C:p.UNKNOWN}(f.status);a(new y(I,f.message))}else a(new y(p.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new y(p.UNAVAILABLE,"Connection failed."));break;default:A()}}finally{_(Et,`RPC '${t}' ${s} completed.`)}});let u=JSON.stringify(r);_(Et,`RPC '${t}' ${s} sending request:`,r),c.send(e,"POST",u,i,15)})}Fo(t,e,i){let r=Rc(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Af(),a=Sf(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,e,i),c.encodeInitMessageHeaders=!0;let l=s.join("");_(Et,`Creating RPC '${t}' stream ${r}: ${l}`,c);let h=o.createWebChannel(l,c),d=!1,f=!1,I=new Uu({lo:w=>{f?_(Et,`Not sending because RPC '${t}' stream ${r} is closed:`,w):(d||(_(Et,`Opening RPC '${t}' stream ${r} transport.`),h.open(),d=!0),_(Et,`RPC '${t}' stream ${r} sending:`,w),h.send(w))},ho:()=>h.close()}),v=(w,C,x)=>{w.listen(C,S=>{try{x(S)}catch(M){setTimeout(()=>{throw M},0)}})};return v(h,nr.EventType.OPEN,()=>{f||_(Et,`RPC '${t}' stream ${r} transport opened.`)}),v(h,nr.EventType.CLOSE,()=>{f||(f=!0,_(Et,`RPC '${t}' stream ${r} transport closed`),I.Vo())}),v(h,nr.EventType.ERROR,w=>{f||(f=!0,ie(Et,`RPC '${t}' stream ${r} transport errored:`,w),I.Vo(new y(p.UNAVAILABLE,"The operation could not be completed")))}),v(h,nr.EventType.MESSAGE,w=>{var C;if(!f){let x=w.data[0];R(!!x);let S=x,M=S.error||((C=S[0])===null||C===void 0?void 0:C.error);if(M){_(Et,`RPC '${t}' stream ${r} received error:`,M);let B=M.status,U=function(gg){let ih=it[gg];if(ih!==void 0)return dp(ih)}(B),ut=M.message;U===void 0&&(U=p.INTERNAL,ut="Unknown error status: "+B+" with message "+M.message),f=!0,I.Vo(new y(U,ut)),h.close()}else _(Et,`RPC '${t}' stream ${r} received:`,x),I.mo(x)}}),v(a,Df.STAT_EVENT,w=>{w.stat===Tc.PROXY?_(Et,`RPC '${t}' stream ${r} detected buffering proxy`):w.stat===Tc.NOPROXY&&_(Et,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{I.Ro()},0),I}};function jp(){return typeof window<"u"?window:null}function zs(){return typeof document<"u"?document:null}function Ur(n){return new su(n,!0)}var kr=class{constructor(t,e,i=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=i,this.xo=r,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let e=Math.floor(this.No+this.Qo()),i=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-i);r>0&&_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Bo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var bo=class{constructor(t,e,i,r,s,o,a,c){this.oi=t,this.$o=i,this.Uo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new kr(t,e)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return g(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return g(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,e){return g(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():e&&e.code===p.RESOURCE_EXHAUSTED?(X(e.toString()),X("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===p.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(e)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Wo===e&&this.o_(i,r)},i=>{t(()=>{let r=new y(p.UNKNOWN,"Fetching auth token failed: "+i.message);return this.__(r)})})}o_(t,e){let i=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po(()=>{i(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(r=>{i(()=>this.__(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Yo(){this.state=5,this.jo.qo(()=>g(this,null,function*(){this.state=0,this.start()}))}__(t){return _("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget(()=>this.Wo===t?e():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},zu=class extends bo{constructor(t,e,i,r,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();let e=Iv(this.serializer,t),i=function(s){if(!("targetChange"in s))return D.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?D.min():o.readTime?Z(o.readTime):D.min()}(t);return this.listener.u_(e,i)}c_(t){let e={};e.database=cu(this.serializer),e.addTarget=function(s,o){let a,c=o.target;if(a=to(c)?{documents:wp(s,c)}:{query:Ip(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=mp(s,o.resumeToken);let u=ou(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(D.min())>0){a.readTime=ci(s,o.snapshotVersion.toTimestamp());let u=ou(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,t);let i=Tv(this.serializer,t);i&&(e.labels=i),this.t_(e)}l_(t){let e={};e.database=cu(this.serializer),e.removeTarget=t,this.t_(e)}},Gu=class extends bo{constructor(t,e,i,r,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,r,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(R(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let e=Ev(t.writeResults,t.commitTime),i=Z(t.commitTime);return this.listener.T_(i,e)}return R(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=cu(this.serializer),this.t_(t)}I_(t){let e={streamToken:this.lastStreamToken,writes:t.map(i=>Sr(this.serializer,i))};this.t_(e)}};var Ku=class extends class{}{constructor(t,e,i,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,i,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,au(e,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(p.UNKNOWN,s.toString())})}vo(t,e,i,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,au(e,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(p.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var $u=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(X(e),this.g_=!1):_("OnlineStateTracker",e)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Wu=class{constructor(t,e,i,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{i.enqueueAndForget(()=>g(this,null,function*(){Qe(this)&&(_("RemoteStore","Restarting streams for network reachability change."),yield function(c){return g(this,null,function*(){let u=E(c);u.v_.add(4),yield Ii(u),u.x_.set("Unknown"),u.v_.delete(4),yield qr(u)})}(this))}))}),this.x_=new $u(i,r)}};function qr(n){return g(this,null,function*(){if(Qe(n))for(let t of n.F_)yield t(!0)})}function Ii(n){return g(this,null,function*(){for(let t of n.F_)yield t(!1)})}function zo(n,t){let e=E(n);e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),Bl(e)?Ll(e):Ti(e).Jo()&&Fl(e,t))}function fi(n,t){let e=E(n),i=Ti(e);e.C_.delete(t),i.Jo()&&Up(e,t),e.C_.size===0&&(i.Jo()?i.Xo():Qe(e)&&e.x_.set("Unknown"))}function Fl(n,t){if(n.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(D.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Ti(n).c_(t)}function Up(n,t){n.O_.Oe(t),Ti(n).l_(t)}function Ll(n){n.O_=new ru({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.C_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),Ti(n).start(),n.x_.p_()}function Bl(n){return Qe(n)&&!Ti(n).Ho()&&n.C_.size>0}function Qe(n){return E(n).v_.size===0}function qp(n){n.O_=void 0}function Lv(n){return g(this,null,function*(){n.C_.forEach((t,e)=>{Fl(n,t)})})}function Bv(n,t){return g(this,null,function*(){qp(n),Bl(n)?(n.x_.S_(t),Ll(n)):n.x_.set("Unknown")})}function jv(n,t,e){return g(this,null,function*(){if(n.x_.set("Online"),t instanceof ro&&t.state===2&&t.cause)try{yield function(r,s){return g(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.C_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.C_.delete(a),r.O_.removeTarget(a))})}(n,t)}catch(i){_("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield Ao(n,i)}else if(t instanceof Zn?n.O_.$e(t):t instanceof io?n.O_.Je(t):n.O_.Ge(t),!e.isEqual(D.min()))try{let i=yield Mp(n.localStore);e.compareTo(i)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.C_.get(u);l&&s.C_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.C_.get(c);if(!l)return;s.C_.set(c,l.withResumeToken(ft.EMPTY_BYTE_STRING,l.snapshotVersion)),Up(s,c);let h=new ui(l.target,c,u,l.sequenceNumber);Fl(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(i){_("RemoteStore","Failed to raise snapshot:",i),yield Ao(n,i)}})}function Ao(n,t,e){return g(this,null,function*(){if(!We(t))throw t;n.v_.add(1),yield Ii(n),n.x_.set("Offline"),e||(e=()=>Mp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){_("RemoteStore","Retrying IndexedDB access"),yield e(),n.v_.delete(1),yield qr(n)}))})}function zp(n,t){return t().catch(e=>Ao(n,e,t))}function Ei(n){return g(this,null,function*(){let t=E(n),e=qe(t),i=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Uv(t);)try{let r=yield Vv(t.localStore,i);if(r===null){t.D_.length===0&&e.Xo();break}i=r.batchId,qv(t,r)}catch(r){yield Ao(t,r)}Gp(t)&&Kp(t)})}function Uv(n){return Qe(n)&&n.D_.length<10}function qv(n,t){n.D_.push(t);let e=qe(n);e.Jo()&&e.P_&&e.I_(t.mutations)}function Gp(n){return Qe(n)&&!qe(n).Ho()&&n.D_.length>0}function Kp(n){qe(n).start()}function zv(n){return g(this,null,function*(){qe(n).d_()})}function Gv(n){return g(this,null,function*(){let t=qe(n);for(let e of n.D_)t.I_(e.mutations)})}function Kv(n,t,e){return g(this,null,function*(){let i=n.D_.shift(),r=eu.from(i,t,e);yield zp(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Ei(n)})}function $v(n,t){return g(this,null,function*(){t&&qe(n).P_&&(yield function(i,r){return g(this,null,function*(){if(function(o){return hp(o)&&o!==p.ABORTED}(r.code)){let s=i.D_.shift();qe(i).Zo(),yield zp(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield Ei(i)}})}(n,t)),Gp(n)&&Kp(n)})}function Im(n,t){return g(this,null,function*(){let e=E(n);e.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");let i=Qe(e);e.v_.add(3),yield Ii(e),i&&e.x_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),yield qr(e)})}function Qu(n,t){return g(this,null,function*(){let e=E(n);t?(e.v_.delete(2),yield qr(e)):t||(e.v_.add(2),yield Ii(e),e.x_.set("Unknown"))})}function Ti(n){return n.N_||(n.N_=function(e,i,r){let s=E(e);return s.R_(),new zu(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Po:Lv.bind(null,n),To:Bv.bind(null,n),u_:jv.bind(null,n)}),n.F_.push(t=>g(this,null,function*(){t?(n.N_.Zo(),Bl(n)?Ll(n):n.x_.set("Unknown")):(yield n.N_.stop(),qp(n))}))),n.N_}function qe(n){return n.L_||(n.L_=function(e,i,r){let s=E(e);return s.R_(),new Gu(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Po:zv.bind(null,n),To:$v.bind(null,n),E_:Gv.bind(null,n),T_:Kv.bind(null,n)}),n.F_.push(t=>g(this,null,function*(){t?(n.L_.Zo(),yield Ei(n)):(yield n.L_.stop(),n.D_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var Hu=class n{constructor(t,e,i,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new ot,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,r,s){let o=Date.now()+i,a=new n(t,e,o,r,s);return a.start(i),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(p.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function bi(n,t){if(X("AsyncQueue",`${t}: ${n}`),We(n))return new y(p.UNAVAILABLE,`${t}: ${n}`);throw n}var So=class n{constructor(t){this.comparator=t?(e,i)=>t(e,i)||b.comparator(e.key,i.key):(e,i)=>b.comparator(e.key,i.key),this.keyedMap=ar(),this.sortedSet=new $(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){let r=e.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let i=new n;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}};var Ro=class{constructor(){this.B_=new $(b.comparator)}track(t){let e=t.doc.key,i=this.B_.get(e);i?t.type!==0&&i.type===3?this.B_=this.B_.insert(e,t):t.type===3&&i.type!==1?this.B_=this.B_.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.B_=this.B_.remove(e):t.type===1&&i.type===2?this.B_=this.B_.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):A():this.B_=this.B_.insert(e,t)}k_(){let t=[];return this.B_.inorderTraversal((e,i)=>{t.push(i)}),t}},mi=class n{constructor(t,e,i,r,s,o,a,c,u){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(t,e,i,r,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,So.emptySet(e),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Br(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==i[r].type||!e[r].doc.isEqual(i[r].doc))return!1;return!0}};var Yu=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(t=>t.U_())}},Xu=class{constructor(){this.queries=new oe(t=>Ym(t),Br),this.onlineState="Unknown",this.W_=new Set}};function jl(n,t){return g(this,null,function*(){let e=E(n),i=3,r=t.query,s=e.queries.get(r);s?!s.K_()&&t.U_()&&(i=2):(s=new Yu,i=t.U_()?0:1);try{switch(i){case 0:s.q_=yield e.onListen(r,!0);break;case 1:s.q_=yield e.onListen(r,!1);break;case 2:yield e.onFirstRemoteStoreListen(r)}}catch(o){let a=bi(o,`Initialization of query '${$n(t.query)}' failed`);return void t.onError(a)}e.queries.set(r,s),s.Q_.push(t),t.G_(e.onlineState),s.q_&&t.z_(s.q_)&&ql(e)})}function Ul(n,t){return g(this,null,function*(){let e=E(n),i=t.query,r=3,s=e.queries.get(i);if(s){let o=s.Q_.indexOf(t);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?r=t.U_()?0:1:!s.K_()&&t.U_()&&(r=2))}switch(r){case 0:return e.queries.delete(i),e.onUnlisten(i,!0);case 1:return e.queries.delete(i),e.onUnlisten(i,!1);case 2:return e.onLastRemoteStoreUnlisten(i);default:return}})}function Wv(n,t){let e=E(n),i=!1;for(let r of t){let s=r.query,o=e.queries.get(s);if(o){for(let a of o.Q_)a.z_(r)&&(i=!0);o.q_=r}}i&&ql(e)}function Qv(n,t,e){let i=E(n),r=i.queries.get(t);if(r)for(let s of r.Q_)s.onError(e);i.queries.delete(t)}function ql(n){n.W_.forEach(t=>{t.next()})}var Ju,Em;(Em=Ju||(Ju={})).j_="default",Em.Cache="cache";var xr=class{constructor(t,e,i){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=i||{}}z_(t){if(!this.options.includeMetadataChanges){let i=[];for(let r of t.docChanges)r.type!==3&&i.push(r);t=new mi(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache||!this.U_())return!0;let i=e!=="Offline";return(!this.options.ta||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Z_(t){if(t.docChanges.length>0)return!0;let e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ea(t){t=mi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Ju.Cache}};var Zu=class{constructor(t,e){this.na=t,this.byteLength=e}ra(){return"metadata"in this.na}};var Do=class{constructor(t){this.serializer=t}Ps(t){return ee(this.serializer,t)}Is(t){return t.metadata.exists?vp(this.serializer,t.document,!1):at.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return Z(t)}},tl=class{constructor(t,e,i){this.ia=t,this.localStore=e,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$p(t)}sa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.na.namedQuery)this.queries.push(t.na.namedQuery);else if(t.na.documentMetadata){this.documents.push({metadata:t.na.documentMetadata}),t.na.documentMetadata.exists||++e;let i=L.fromString(t.na.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else t.na.document&&(this.documents[this.documents.length-1].document=t.na.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}oa(t){let e=new Map,i=new Do(this.serializer);for(let r of t)if(r.metadata.queries){let s=i.Ps(r.metadata.name);for(let o of r.metadata.queries){let a=(e.get(o)||V()).add(s);e.set(o,a)}}return e}complete(){return g(this,null,function*(){let t=yield Mv(this.localStore,new Do(this.serializer),this.documents,this.ia.id),e=this.oa(this.documents);for(let i of this.queries)yield Ov(this.localStore,i,e.get(i.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:t}})}};function $p(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Co=class{constructor(t){this.key=t}},ko=class{constructor(t){this.key=t}},xo=class{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=V(),this.mutatedKeys=V(),this.ha=Jm(t),this.Pa=new So(this.ha)}get Ia(){return this.ua}Ta(t,e){let i=e?e.Ea:new Ro,r=e?e.Pa:this.Pa,s=e?e.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((l,h)=>{let d=r.get(l),f=jr(this.query,h)?h:null,I=!!d&&this.mutatedKeys.has(d.key),v=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),w=!1;d&&f?d.data.isEqual(f.data)?I!==v&&(i.track({type:3,doc:f}),w=!0):this.da(d,f)||(i.track({type:2,doc:f}),w=!0,(c&&this.ha(f,c)>0||u&&this.ha(f,u)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),w=!0):d&&!f&&(i.track({type:1,doc:d}),w=!0,(c||u)&&(a=!0)),w&&(f?(o=o.add(f),s=v?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),i.track({type:1,doc:l})}return{Pa:o,Ea:i,Xi:a,mutatedKeys:s}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,r){let s=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;let o=t.Ea.k_();o.sort((l,h)=>function(f,I){let v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A()}};return v(f)-v(I)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(i),r=r!=null&&r;let a=e&&!r?this.Ra():[],c=this.la.size===0&&this.current&&!r?1:0,u=c!==this.ca;return this.ca=c,o.length!==0||u?{snapshot:new mi(this.query,t.Pa,s,o,t.mutatedKeys,c===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Ro,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach(e=>this.ua=this.ua.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.ua=this.ua.delete(e)),this.current=t.current)}Ra(){if(!this.current)return[];let t=this.la;this.la=V(),this.Pa.forEach(i=>{this.ma(i.key)&&(this.la=this.la.add(i.key))});let e=[];return t.forEach(i=>{this.la.has(i)||e.push(new ko(i))}),this.la.forEach(i=>{t.has(i)||e.push(new Co(i))}),e}fa(t){this.ua=t.hs,this.la=V();let e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return mi.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},el=class{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}},nl=class{constructor(t){this.key=t,this.pa=!1}},il=class{constructor(t,e,i,r,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new oe(a=>Ym(a),Br),this.Sa=new Map,this.ba=new Set,this.Da=new $(b.comparator),this.Ca=new Map,this.va=new Dr,this.Fa={},this.Ma=new Map,this.xa=li.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function Hv(n,t,e=!0){return g(this,null,function*(){let i=Go(n),r,s=i.wa.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ga()):r=yield Wp(i,t,e,!0),r})}function Yv(n,t){return g(this,null,function*(){let e=Go(n);yield Wp(e,t,!0,!1)})}function Wp(n,t,e,i){return g(this,null,function*(){let r=yield hi(n.localStore,Rt(t)),s=r.targetId,o=e?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return i&&(a=yield zl(n,t,s,o==="current",r.resumeToken)),n.isPrimaryClient&&e&&zo(n.remoteStore,r),a})}function zl(n,t,e,i,r){return g(this,null,function*(){n.Na=(h,d,f)=>function(v,w,C,x){return g(this,null,function*(){let S=w.view.Ta(C);S.Xi&&(S=yield vo(v.localStore,w.query,!1).then(({documents:ut})=>w.view.Ta(ut,S)));let M=x&&x.targetChanges.get(w.targetId),B=x&&x.targetMismatches.get(w.targetId)!=null,U=w.view.applyChanges(S,v.isPrimaryClient,M,B);return rl(v,w.targetId,U.Va),U.snapshot})}(n,h,d,f);let s=yield vo(n.localStore,t,!0),o=new xo(t,s.hs),a=o.Ta(s.documents),c=br.createSynthesizedTargetChangeForCurrentChange(e,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,c);rl(n,e,u.Va);let l=new el(t,e,o);return n.wa.set(t,l),n.Sa.has(e)?n.Sa.get(e).push(t):n.Sa.set(e,[t]),u.snapshot})}function Xv(n,t,e){return g(this,null,function*(){let i=E(n),r=i.wa.get(t),s=i.Sa.get(r.targetId);if(s.length>1)return i.Sa.set(r.targetId,s.filter(o=>!Br(o,t))),void i.wa.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield di(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),e&&fi(i.remoteStore,r.targetId),pi(i,r.targetId)}).catch($e))):(pi(i,r.targetId),yield di(i.localStore,r.targetId,!0))})}function Jv(n,t){return g(this,null,function*(){let e=E(n),i=e.wa.get(t),r=e.Sa.get(i.targetId);e.isPrimaryClient&&r.length===1&&(e.sharedClientState.removeLocalQueryTarget(i.targetId),fi(e.remoteStore,i.targetId))})}function Zv(n,t,e){return g(this,null,function*(){let i=Wl(n);try{let r=yield function(o,a){let c=E(o),u=J.now(),l=a.reduce((f,I)=>f.add(I.key),V()),h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let I=kt(),v=V();return c.os.getEntries(f,l).next(w=>{I=w,I.forEach((C,x)=>{x.isValidDocument()||(v=v.add(C))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,I)).next(w=>{h=w;let C=[];for(let x of a){let S=mv(x,h.get(x.key).overlayedDocument);S!=null&&C.push(new zt(x.key,S,zm(S.value.mapValue),Y.exists(!0)))}return c.mutationQueue.addMutationBatch(f,u,C,a)}).next(w=>{d=w;let C=w.applyToLocalDocumentSet(h,v);return c.documentOverlayCache.saveOverlays(f,w.batchId,C)})}).then(()=>({batchId:d.batchId,changes:tp(h)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let u=o.Fa[o.currentUser.toKey()];u||(u=new $(N)),u=u.insert(a,c),o.Fa[o.currentUser.toKey()]=u}(i,r.batchId,e),yield ve(i,r.changes),yield Ei(i.remoteStore)}catch(r){let s=bi(r,"Failed to persist write");e.reject(s)}})}function Qp(n,t){return g(this,null,function*(){let e=E(n);try{let i=yield Nv(e.localStore,t);t.targetChanges.forEach((r,s)=>{let o=e.Ca.get(s);o&&(R(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.pa=!0:r.modifiedDocuments.size>0?R(o.pa):r.removedDocuments.size>0&&(R(o.pa),o.pa=!1))}),yield ve(e,i,t)}catch(i){yield $e(i)}})}function Tm(n,t,e){let i=E(n);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){let r=[];i.wa.forEach((s,o)=>{let a=o.view.G_(t);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=E(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(u=!0)}),u&&ql(c)}(i.eventManager,t),r.length&&i.ya.u_(r),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function tw(n,t,e){return g(this,null,function*(){let i=E(n);i.sharedClientState.updateQueryState(t,"rejected",e);let r=i.Ca.get(t),s=r&&r.key;if(s){let o=new $(b.comparator);o=o.insert(s,at.newNoDocument(s,D.min()));let a=V().add(s),c=new Tr(D.min(),new Map,new $(N),o,a);yield Qp(i,c),i.Da=i.Da.remove(s),i.Ca.delete(t),$l(i)}else yield di(i.localStore,t,!1).then(()=>pi(i,t,e)).catch($e)})}function ew(n,t){return g(this,null,function*(){let e=E(n),i=t.batch.batchId;try{let r=yield Pv(e.localStore,t);Kl(e,i,null),Gl(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),yield ve(e,r)}catch(r){yield $e(r)}})}function nw(n,t,e){return g(this,null,function*(){let i=E(n);try{let r=yield function(o,a){let c=E(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(R(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(i.localStore,t);Kl(i,t,e),Gl(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),yield ve(i,r)}catch(r){yield $e(r)}})}function iw(n,t){return g(this,null,function*(){let e=E(n);Qe(e.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield function(o){let a=E(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(i===-1)return void t.resolve();let r=e.Ma.get(i)||[];r.push(t),e.Ma.set(i,r)}catch(i){let r=bi(i,"Initialization of waitForPendingWrites() operation failed");t.reject(r)}})}function Gl(n,t){(n.Ma.get(t)||[]).forEach(e=>{e.resolve()}),n.Ma.delete(t)}function Kl(n,t,e){let i=E(n),r=i.Fa[i.currentUser.toKey()];if(r){let s=r.get(t);s&&(e?s.reject(e):s.resolve(),r=r.remove(t)),i.Fa[i.currentUser.toKey()]=r}}function pi(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let i of n.Sa.get(t))n.wa.delete(i),e&&n.ya.La(i,e);n.Sa.delete(t),n.isPrimaryClient&&n.va.Vr(t).forEach(i=>{n.va.containsKey(i)||Hp(n,i)})}function Hp(n,t){n.ba.delete(t.path.canonicalString());let e=n.Da.get(t);e!==null&&(fi(n.remoteStore,e),n.Da=n.Da.remove(t),n.Ca.delete(e),$l(n))}function rl(n,t,e){for(let i of e)i instanceof Co?(n.va.addReference(i.key,t),rw(n,i)):i instanceof ko?(_("SyncEngine","Document no longer in limbo: "+i.key),n.va.removeReference(i.key,t),n.va.containsKey(i.key)||Hp(n,i.key)):A()}function rw(n,t){let e=t.key,i=e.path.canonicalString();n.Da.get(e)||n.ba.has(i)||(_("SyncEngine","New document in limbo: "+e),n.ba.add(i),$l(n))}function $l(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let t=n.ba.values().next().value;n.ba.delete(t);let e=new b(L.fromString(t)),i=n.xa.next();n.Ca.set(i,new nl(e)),n.Da=n.Da.insert(e,i),zo(n.remoteStore,new ui(Rt(wi(e.path)),i,"TargetPurposeLimboResolution",Pt._e))}}function ve(n,t,e){return g(this,null,function*(){let i=E(n),r=[],s=[],o=[];i.wa.isEmpty()||(i.wa.forEach((a,c)=>{o.push(i.Na(c,t,e).then(u=>{if((u||e)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){r.push(u);let l=Ou.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),i.ya.u_(r),yield function(c,u){return g(this,null,function*(){let l=E(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>m.forEach(u,d=>m.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>m.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!We(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(let h of u){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),I=f.snapshotVersion,v=f.withLastLimboFreeSnapshotVersion(I);l.ns=l.ns.insert(d,v)}}})}(i.localStore,s))})}function sw(n,t){return g(this,null,function*(){let e=E(n);if(!e.currentUser.isEqual(t)){_("SyncEngine","User change. New user:",t.toKey());let i=yield Vp(e.localStore,t);e.currentUser=t,function(s,o){s.Ma.forEach(a=>{a.forEach(c=>{c.reject(new y(p.CANCELLED,o))})}),s.Ma.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),yield ve(e,i.us)}})}function ow(n,t){let e=E(n),i=e.Ca.get(t);if(i&&i.pa)return V().add(i.key);{let r=V(),s=e.Sa.get(t);if(!s)return r;for(let o of s){let a=e.wa.get(o);r=r.unionWith(a.view.Ia)}return r}}function aw(n,t){return g(this,null,function*(){let e=E(n),i=yield vo(e.localStore,t.query,!0),r=t.view.fa(i);return e.isPrimaryClient&&rl(e,t.targetId,r.Va),r})}function cw(n,t){return g(this,null,function*(){let e=E(n);return Lp(e.localStore,t).then(i=>ve(e,i))})}function uw(n,t,e,i){return g(this,null,function*(){let r=E(n),s=yield function(a,c){let u=E(a),l=E(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,c).next(d=>d?u.localDocuments.getDocuments(h,d):m.resolve(null)))}(r.localStore,t);s!==null?(e==="pending"?yield Ei(r.remoteStore):e==="acknowledged"||e==="rejected"?(Kl(r,t,i||null),Gl(r,t),function(a,c){E(E(a).mutationQueue).Mn(c)}(r.localStore,t)):A(),yield ve(r,s)):_("SyncEngine","Cannot apply mutation batch with id: "+t)})}function lw(n,t){return g(this,null,function*(){let e=E(n);if(Go(e),Wl(e),t===!0&&e.Oa!==!0){let i=e.sharedClientState.getAllActiveQueryTargets(),r=yield bm(e,i.toArray());e.Oa=!0,yield Qu(e.remoteStore,!0);for(let s of r)zo(e.remoteStore,s)}else if(t===!1&&e.Oa!==!1){let i=[],r=Promise.resolve();e.Sa.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(pi(e,o),di(e.localStore,o,!0))),fi(e.remoteStore,o)}),yield r,yield bm(e,i),function(o){let a=E(o);a.Ca.forEach((c,u)=>{fi(a.remoteStore,u)}),a.va.mr(),a.Ca=new Map,a.Da=new $(b.comparator)}(e),e.Oa=!1,yield Qu(e.remoteStore,!1)}})}function bm(n,t,e){return g(this,null,function*(){let i=E(n),r=[],s=[];for(let o of t){let a,c=i.Sa.get(o);if(c&&c.length!==0){a=yield hi(i.localStore,Rt(c[0]));for(let u of c){let l=i.wa.get(u),h=yield aw(i,l);h.snapshot&&s.push(h.snapshot)}}else{let u=yield Fp(i.localStore,o);a=yield hi(i.localStore,u),yield zl(i,Yp(u),o,!1,a.resumeToken)}r.push(a)}return i.ya.u_(s),r})}function Yp(n){return Hm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function hw(n){return function(e){return E(E(e).persistence).Bi()}(E(n).localStore)}function dw(n,t,e,i){return g(this,null,function*(){let r=E(n);if(r.Oa)return void _("SyncEngine","Ignoring unexpected query state notification.");let s=r.Sa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield Lp(r.localStore,Xm(s[0])),a=Tr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);yield ve(r,o,a);break}case"rejected":yield di(r.localStore,t,!0),pi(r,t,i);break;default:A()}})}function fw(n,t,e){return g(this,null,function*(){let i=Go(n);if(i.Oa){for(let r of t){if(i.Sa.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){_("SyncEngine","Adding an already active target "+r);continue}let s=yield Fp(i.localStore,r),o=yield hi(i.localStore,s);yield zl(i,Yp(s),o.targetId,!1,o.resumeToken),zo(i.remoteStore,o)}for(let r of e)i.Sa.has(r)&&(yield di(i.localStore,r,!1).then(()=>{fi(i.remoteStore,r),pi(i,r)}).catch($e))}})}function Go(n){let t=E(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Qp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ow.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=tw.bind(null,t),t.ya.u_=Wv.bind(null,t.eventManager),t.ya.La=Qv.bind(null,t.eventManager),t}function Wl(n){let t=E(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ew.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=nw.bind(null,t),t}function mw(n,t,e){let i=E(n);(function(s,o,a){return g(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(f,I){let v=E(f),w=Z(I.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",C=>v.$r.getBundleMetadata(C,I.id)).then(C=>!!C&&C.createTime.compareTo(w)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress($p(c));let u=new tl(c,s.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield u.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield u.complete();return yield ve(s,h.aa,void 0),yield function(f,I){let v=E(f);return v.persistence.runTransaction("Save bundle","readwrite",w=>v.$r.saveBundleMetadata(w,I))}(s.localStore,c),a._completeWith(h.progress),Promise.resolve(h._a)}catch(c){return ie("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(i,t,e).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}var Pr=class{constructor(){this.synchronizeTabs=!1}initialize(t){return g(this,null,function*(){this.serializer=Ur(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Np(this.persistence,new yo,t.initialUser,this.serializer)}createPersistence(t){return new go(_o.Hr,this.serializer)}createSharedClientState(t){return new Eo}terminate(){return g(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Po=class n extends Pr{constructor(t,e,i){super(),this.ka=t,this.cacheSizeBytes=e,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(t){return g(this,null,function*(){yield Xo(n.prototype,this,"initialize").call(this,t),yield this.ka.initialize(this,t),yield Wl(this.ka.syncEngine),yield Ei(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Np(this.persistence,new yo,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let i=this.persistence.referenceDelegate.garbageCollector;return new Iu(i,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let i=new Bc(e,this.persistence);return new Lc(t.asyncQueue,i)}createPersistence(t){let e=Ol(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new Mu(this.synchronizeTabs,e,t.clientId,i,t.asyncQueue,jp(),zs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new Eo}},sl=class n extends Po{constructor(t,e){super(t,e,!1),this.ka=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return g(this,null,function*(){yield Xo(n.prototype,this,"initialize").call(this,t);let e=this.ka.syncEngine;this.sharedClientState instanceof fr&&(this.sharedClientState.syncEngine={Zs:uw.bind(null,e),Xs:dw.bind(null,e),eo:fw.bind(null,e),Bi:hw.bind(null,e),Ys:cw.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.fi(i=>g(this,null,function*(){yield lw(this.ka.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=jp();if(!fr.D(e))throw new y(p.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=Ol(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new fr(e,t.asyncQueue,i,t.clientId,t.initialUser)}},Nr=class{initialize(t,e){return g(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Tm(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=sw.bind(null,this.syncEngine),yield Qu(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Xu}()}createDatastore(t){let e=Ur(t.databaseInfo.databaseId),i=function(s){return new qu(s)}(t.databaseInfo);return function(s,o,a,c){return new Ku(s,o,a,c)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(i,r,s,o,a){return new Wu(i,r,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>Tm(this.syncEngine,e,0),function(){return To.D()?new To:new ju}())}createSyncEngine(t,e){return function(r,s,o,a,c,u,l){let h=new il(r,s,o,a,c,u);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return g(this,null,function*(){var t;yield function(i){return g(this,null,function*(){let r=E(i);_("RemoteStore","RemoteStore shutting down."),r.v_.add(5),yield Ii(r),r.M_.shutdown(),r.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function Am(n,t=10240){let e=0;return{read(){return g(this,null,function*(){if(e<n.byteLength){let r={value:n.slice(e,e+t),done:!1};return e+=t,r}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var gi=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):X("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var ol=class{constructor(t,e){this.Ka=t,this.serializer=e,this.metadata=new ot,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(i=>{i&&i.ra()?this.metadata.resolve(i.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.na)}`))},i=>this.metadata.reject(i))}close(){return this.Ka.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}Ba(){return g(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return g(this,null,function*(){let t=yield this.Wa();if(t===null)return null;let e=this.$a.decode(t),i=Number(e);isNaN(i)&&this.Ga(`length string (${e}) is not valid number`);let r=yield this.za(i);return new Zu(JSON.parse(r),t.length+i)})}ja(){return this.buffer.findIndex(t=>t===123)}Wa(){return g(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let t=this.ja();t<0&&this.Ga("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}za(t){return g(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let e=this.$a.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Ga(t){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${t}`)}Ha(){return g(this,null,function*(){let t=yield this.Ka.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var al=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(p.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(r,s){return g(this,null,function*(){let o=E(r),a={documents:s.map(h=>Ar(o.serializer,h))},c=yield o.vo("BatchGetDocuments",o.serializer.databaseId,L.emptyPath(),a,s.length),u=new Map;c.forEach(h=>{let d=wv(o.serializer,h);u.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=u.get(h.toString());R(!!d),l.push(d)}),l})}(this.datastore,t);return e.forEach(i=>this.recordVersion(i)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ue(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,i)=>{let r=b.fromPath(i);this.mutations.push(new wr(r,this.precondition(r)))}),yield function(i,r){return g(this,null,function*(){let s=E(i),o={writes:r.map(a=>Sr(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,L.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw A();e=D.min()}let i=this.readVersions.get(t.key.toString());if(i){if(!e.isEqual(i))throw new y(p.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(D.min())?Y.exists(!1):Y.updateTime(e):Y.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(D.min()))throw new y(p.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Y.updateTime(e)}return Y.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var cl=class{constructor(t,e,i,r,s){this.asyncQueue=t,this.datastore=e,this.options=i,this.updateFunction=r,this.deferred=s,this.Ja=i.maxAttempts,this.jo=new kr(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>g(this,null,function*(){let t=new al(this.datastore),e=this.Xa(t);e&&e.then(i=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.eu(r)}))}).catch(i=>{this.eu(i)})}))}Xa(t){try{let e=this.updateFunction(t);return!Fr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}eu(t){this.Ja>0&&this.tu(t)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(t)}tu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!hp(e)}return!1}};var ul=class{constructor(t,e,i,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=r,this.user=st.UNAUTHENTICATED,this.clientId=$s.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>g(this,null,function*(){_("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new ot;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let i=bi(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}};function Gs(n,t){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener(r=>g(this,null,function*(){i.isEqual(r)||(yield Vp(t.localStore,r),i=r)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function ll(n,t){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Ql(n);_("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(i=>Im(t.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>Im(t.remoteStore,r)),n._onlineComponents=t})}function Xp(n){return n.name==="FirebaseError"?n.code===p.FAILED_PRECONDITION||n.code===p.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Ql(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Gs(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!Xp(e))throw e;ie("Error using user provided cache. Falling back to memory cache: "+e),yield Gs(n,new Pr)}}else _("FirestoreClient","Using default OfflineComponentProvider"),yield Gs(n,new Pr);return n._offlineComponents})}function Ko(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),yield ll(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),yield ll(n,new Nr))),n._onlineComponents})}function Jp(n){return Ql(n).then(t=>t.persistence)}function Hl(n){return Ql(n).then(t=>t.localStore)}function Zp(n){return Ko(n).then(t=>t.remoteStore)}function Yl(n){return Ko(n).then(t=>t.syncEngine)}function pw(n){return Ko(n).then(t=>t.datastore)}function _i(n){return g(this,null,function*(){let t=yield Ko(n),e=t.eventManager;return e.onListen=Hv.bind(null,t.syncEngine),e.onUnlisten=Xv.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Yv.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Jv.bind(null,t.syncEngine),e})}function gw(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let t=yield Jp(n),e=yield Zp(n);return t.setNetworkEnabled(!0),function(r){let s=E(r);return s.v_.delete(0),qr(s)}(e)}))}function _w(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let t=yield Jp(n),e=yield Zp(n);return t.setNetworkEnabled(!1),function(r){return g(this,null,function*(){let s=E(r);s.v_.add(0),yield Ii(s),s.x_.set("Offline")})}(e)}))}function yw(n,t){let e=new ot;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(r,s,o){return g(this,null,function*(){try{let a=yield function(u,l){let h=E(u);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(p.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=bi(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield Hl(n),t,e)})),e.promise}function tg(n,t,e={}){let i=new ot;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,c,u){let l=new gi({next:d=>{o.enqueueAndForget(()=>Ul(s,h));let f=d.docs.has(a);!f&&d.fromCache?u.reject(new y(p.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&c&&c.source==="server"?u.reject(new y(p.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new xr(wi(a.path),l,{includeMetadataChanges:!0,ta:!0});return jl(s,h)}(yield _i(n),n.asyncQueue,t,e,i)})),i.promise}function vw(n,t){let e=new ot;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(r,s,o){return g(this,null,function*(){try{let a=yield vo(r,s,!0),c=new xo(s,a.hs),u=c.Ta(a.documents),l=c.applyChanges(u,!1);o.resolve(l.snapshot)}catch(a){let c=bi(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield Hl(n),t,e)})),e.promise}function eg(n,t,e={}){let i=new ot;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,c,u){let l=new gi({next:d=>{o.enqueueAndForget(()=>Ul(s,h)),d.fromCache&&c.source==="server"?u.reject(new y(p.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new xr(a,l,{includeMetadataChanges:!0,ta:!0});return jl(s,h)}(yield _i(n),n.asyncQueue,t,e,i)})),i.promise}function ww(n,t){let e=new gi(t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(r,s){E(r).W_.add(s),s.next()}(yield _i(n),e)})),()=>{e.Qa(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(r,s){E(r).W_.delete(s)}(yield _i(n),e)}))}}function Iw(n,t,e,i){let r=function(o,a){let c;return c=typeof o=="string"?fp().encode(o):o,function(l,h){return new ol(l,h)}(function(l,h){if(l instanceof Uint8Array)return Am(l,h);if(l instanceof ArrayBuffer)return Am(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(e,Ur(t));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){mw(yield Yl(n),r,i)}))}function Ew(n,t){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return function(i,r){let s=E(i);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,r))}(yield Hl(n),t)}))}function ng(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Sm=new Map;function Xl(n,t,e){if(!e)throw new y(p.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Tw(n,t,e,i){if(t===!0&&i===!0)throw new y(p.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Rm(n){if(!b.isDocumentKey(n))throw new y(p.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Dm(n){if(b.isDocumentKey(n))throw new y(p.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $o(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(i){return i.constructor?i.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":A()}function j(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new y(p.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=$o(n);throw new y(p.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function ig(n,t){if(t<=0)throw new y(p.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var No=class{constructor(t){var e,i;if(t.host===void 0){if(t.ssl!==void 0)throw new y(p.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new y(p.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Tw("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ng((i=t.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},bn=class{constructor(t,e,i,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new No({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(p.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new y(p.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new No(t),t.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Dc;switch(i.type){case"firstParty":return new Pc(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new y(p.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let i=Sm.get(e);i&&(_("ComponentProvider","Removing Datastore"),Sm.delete(e),i.terminate())}(this),Promise.resolve()}};function bw(n,t,e,i={}){var r;let s=(n=j(n,bn))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&ie("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=st.MOCK_USER;else{a=Ih(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new y(p.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new st(u)}n._authCredentials=new Cc(new Ks(a,c))}}var _t=class n{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},tt=class n{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ne(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},ne=class n extends _t{constructor(t,e,i){super(t,e,wi(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new tt(this.firestore,null,new b(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function t0(n,t,...e){if(n=nt(n),Xl("collection","path",t),n instanceof bn){let i=L.fromString(t,...e);return Dm(i),new ne(n,null,i)}{if(!(n instanceof tt||n instanceof ne))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(L.fromString(t,...e));return Dm(i),new ne(n.firestore,null,i)}}function e0(n,t){if(n=j(n,bn),Xl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new y(p.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new _t(n,null,function(i){return new qt(L.emptyPath(),i)}(t))}function Aw(n,t,...e){if(n=nt(n),arguments.length===1&&(t=$s.newId()),Xl("doc","path",t),n instanceof bn){let i=L.fromString(t,...e);return Rm(i),new tt(n,null,new b(i))}{if(!(n instanceof tt||n instanceof ne))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(L.fromString(t,...e));return Rm(i),new tt(n.firestore,n instanceof ne?n.converter:null,new b(i))}}function n0(n,t){return n=nt(n),t=nt(t),(n instanceof tt||n instanceof ne)&&(t instanceof tt||t instanceof ne)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Sw(n,t){return n=nt(n),t=nt(t),n instanceof _t&&t instanceof _t&&n.firestore===t.firestore&&Br(n._query,t._query)&&n.converter===t.converter}var hl=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new kr(this,"async_queue_retry"),this.cu=()=>{let e=zs();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let t=zs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;let e=zs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise(()=>{});let e=new ot;return this.hu(()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.ru.push(t),this.Pu()))}Pu(){return g(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!We(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(t){let e=this.nu.then(()=>(this._u=!0,t().catch(i=>{this.ou=i,this._u=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw X("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this._u=!1,i))));return this.nu=e,e}enqueueAfterDelay(t,e,i){this.lu(),this.uu.indexOf(t)>-1&&(e=0);let r=Hu.createAndSchedule(this,t,e,i,s=>this.Iu(s));return this.su.push(r),r}lu(){this.ou&&A()}verifyOperationInProgress(){}Tu(){return g(this,null,function*(){let t;do t=this.nu,yield t;while(t!==this.nu)})}Eu(t){for(let e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then(()=>{this.su.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(let e of this.su)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tu()})}Au(t){this.uu.push(t)}Iu(t){let e=this.su.indexOf(t);this.su.splice(e,1)}};function dl(n){return function(e,i){if(typeof e!="object"||e===null)return!1;let r=e;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var fl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ot,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,i){this._progressObserver={next:t,error:e,complete:i}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var i0=-1,W=class extends bn{constructor(t,e,i,r){super(t,e,i,r),this.type="firestore",this._queue=function(){return new hl}(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||rg(this),this._firestoreClient.terminate()}};function r0(n,t){let e=typeof n=="object"?n:Qr(),i=typeof n=="string"?n:t||"(default)",r=ha(e,"firestore").getImmediate({identifier:i});if(!r._initialized){let s=wh("firestore");s&&bw(r,...s)}return r}function yt(n){return n._firestoreClient||rg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function rg(n){var t,e,i;let r=n._freezeSettings(),s=function(a,c,u,l){return new jc(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,ng(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new ul(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=r.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}function s0(n,t){og(n=j(n,W));let e=yt(n);if(e._uninitializedComponentsProvider)throw new y(p.FAILED_PRECONDITION,"SDK cache is already specified.");ie("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let i=n._freezeSettings(),r=new Nr;return sg(e,r,new Po(r,i.cacheSizeBytes,t?.forceOwnership))}function o0(n){og(n=j(n,W));let t=yt(n);if(t._uninitializedComponentsProvider)throw new y(p.FAILED_PRECONDITION,"SDK cache is already specified.");ie("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),i=new Nr;return sg(t,i,new sl(i,e.cacheSizeBytes))}function sg(n,t,e){let i=new ot;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield Gs(n,e),yield ll(n,t),i.resolve()}catch(r){let s=r;if(!Xp(s))throw s;ie("Error enabling indexeddb cache. Falling back to memory cache: "+s),i.reject(s)}})).then(()=>i.promise)}function a0(n){if(n._initialized&&!n._terminated)throw new y(p.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new ot;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield function(i){return g(this,null,function*(){if(!me.D())return Promise.resolve();let r=i+"main";yield me.delete(r)})}(Ol(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function c0(n){return function(e){let i=new ot;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return iw(yield Yl(e),i)})),i.promise}(yt(n=j(n,W)))}function u0(n){return gw(yt(n=j(n,W)))}function l0(n){return _w(yt(n=j(n,W)))}function h0(n,t){let e=yt(n=j(n,W)),i=new fl;return Iw(e,n._databaseId,t,i),i}function d0(n,t){return Ew(yt(n=j(n,W)),t).then(e=>e?new _t(n,null,e.query):null)}function og(n){if(n._initialized||n._terminated)throw new y(p.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var yi=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(ft.fromBase64String(t))}catch(e){throw new y(p.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var ze=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new y(p.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ct(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var _e=class{constructor(t){this._methodName=t}};var Vr=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new y(p.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new y(p.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return N(this._lat,t._lat)||N(this._long,t._long)}};var Rw=/^__.*__$/,ml=class{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return this.fieldMask!==null?new zt(t,this.data,this.fieldMask,e,this.fieldTransforms):new je(t,this.data,e,this.fieldTransforms)}},Vo=class{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return new zt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function ag(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A()}}var Mo=class n{constructor(t,e,i,r,s,o){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;let i=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.mu({path:i,gu:!1});return r.pu(t),r}yu(t){var e;let i=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.mu({path:i,gu:!1});return r.Ru(),r}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return Oo(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(t.length===0)throw this.Su("Document fields must not be empty");if(ag(this.Vu)&&Rw.test(t))throw this.Su('Document fields cannot begin and end with "__"')}},pl=class{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||Ur(t)}Cu(t,e,i,r=!1){return new Mo({Vu:t,methodName:e,Du:i,path:ct.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Dn(n){let t=n._freezeSettings(),e=Ur(n._databaseId);return new pl(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Wo(n,t,e,i,r,s={}){let o=n.Cu(s.merge||s.mergeFields?2:0,t,e,r);th("Data must be an object, but it was:",o,i);let a=lg(i,o),c,u;if(s.merge)c=new Nt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=wl(t,h,e);if(!o.contains(d))throw new y(p.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);dg(l,d)||l.push(d)}c=new Nt(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new ml(new Tt(a),c,u)}var Mr=class n extends _e{_toFieldTransform(t){if(t.Vu!==2)throw t.Vu===1?t.Su(`${this._methodName}() can only appear at the top level of your update data`):t.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function cg(n,t,e){return new Mo({Vu:3,Du:t.settings.Du,methodName:n._methodName,gu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var gl=class n extends _e{_toFieldTransform(t){return new In(t.path,new Le)}isEqual(t){return t instanceof n}},_l=class n extends _e{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=cg(this,t,!0),i=this.vu.map(s=>Cn(s,e)),r=new pe(i);return new In(t.path,r)}isEqual(t){return t instanceof n&&la(this.vu,t.vu)}},yl=class n extends _e{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=cg(this,t,!0),i=this.vu.map(s=>Cn(s,e)),r=new ge(i);return new In(t.path,r)}isEqual(t){return t instanceof n&&la(this.vu,t.vu)}},vl=class n extends _e{constructor(t,e){super(t),this.Fu=e}_toFieldTransform(t){let e=new Be(t.serializer,rp(t.serializer,this.Fu));return new In(t.path,e)}isEqual(t){return t instanceof n&&this.Fu===t.Fu}};function Jl(n,t,e,i){let r=n.Cu(1,t,e);th("Data must be an object, but it was:",r,i);let s=[],o=Tt.empty();Rn(i,(c,u)=>{let l=eh(t,c,e);u=nt(u);let h=r.yu(l);if(u instanceof Mr)s.push(l);else{let d=Cn(u,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Nt(s);return new Vo(o,a,r.fieldTransforms)}function Zl(n,t,e,i,r,s){let o=n.Cu(1,t,e),a=[wl(t,i,e)],c=[r];if(s.length%2!=0)throw new y(p.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(wl(t,s[d])),c.push(s[d+1]);let u=[],l=Tt.empty();for(let d=a.length-1;d>=0;--d)if(!dg(u,a[d])){let f=a[d],I=c[d];I=nt(I);let v=o.yu(f);if(I instanceof Mr)u.push(f);else{let w=Cn(I,v);w!=null&&(u.push(f),l.set(f,w))}}let h=new Nt(u);return new Vo(l,h,o.fieldTransforms)}function ug(n,t,e,i=!1){return Cn(e,n.Cu(i?4:3,t))}function Cn(n,t){if(hg(n=nt(n)))return th("Unsupported field value:",t,n),lg(n,t);if(n instanceof _e)return function(i,r){if(!ag(r.Vu))throw r.Su(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Su(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.gu&&t.Vu!==4)throw t.Su("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let c=Cn(a,r.wu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,t)}return function(i,r){if((i=nt(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return rp(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=J.fromDate(i);return{timestampValue:ci(r.serializer,s)}}if(i instanceof J){let s=new J(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:ci(r.serializer,s)}}if(i instanceof Vr)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof yi)return{bytesValue:mp(r.serializer,i._byteString)};if(i instanceof tt){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Nl(i.firestore._databaseId||r.databaseId,i._key.path)}}throw r.Su(`Unsupported field value: ${$o(i)}`)}(n,t)}function lg(n,t){let e={};return Um(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Rn(n,(i,r)=>{let s=Cn(r,t.fu(i));s!=null&&(e[i]=s)}),{mapValue:{fields:e}}}function hg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof Vr||n instanceof yi||n instanceof tt||n instanceof _e)}function th(n,t,e){if(!hg(e)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(e)){let i=$o(e);throw i==="an object"?t.Su(n+" a custom object"):t.Su(n+" "+i)}}function wl(n,t,e){if((t=nt(t))instanceof ze)return t._internalPath;if(typeof t=="string")return eh(n,t);throw Oo("Field path arguments must be of type string or ",n,!1,void 0,e)}var Dw=new RegExp("[~\\*/\\[\\]]");function eh(n,t,e){if(t.search(Dw)>=0)throw Oo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new ze(...t.split("."))._internalPath}catch{throw Oo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Oo(n,t,e,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new y(p.INVALID_ARGUMENT,a+n+c)}function dg(n,t){return n.some(e=>e.isEqual(t))}var An=class{constructor(t,e,i,r,s){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Il(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Qo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Il=class extends An{data(){return super.data()}};function Qo(n,t){return typeof t=="string"?eh(n,t):t instanceof ze?t._internalPath:t._delegate._internalPath}function fg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(p.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Or=class{},Sn=class extends Or{};function f0(n,t,...e){let i=[];t instanceof Or&&i.push(t),i=i.concat(e),function(s){let o=s.filter(c=>c instanceof El).length,a=s.filter(c=>c instanceof Fo).length;if(o>1||o>0&&a>0)throw new y(p.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var Fo=class n extends Sn{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new n(t,e,i)}_apply(t){let e=this._parse(t);return pg(t._query,e),new _t(t.firestore,t.converter,Zc(t._query,e))}_parse(t){let e=Dn(t.firestore);return function(s,o,a,c,u,l,h){let d;if(u.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(p.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){km(h,l);let f=[];for(let I of h)f.push(Cm(c,s,I));d={arrayValue:{values:f}}}else d=Cm(c,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||km(h,l),d=ug(a,o,h,l==="in"||l==="not-in");return O.create(u,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function m0(n,t,e){let i=t,r=Qo("where",n);return Fo._create(r,i,e)}var El=class n extends Or{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(i=>i._parse(t)).filter(i=>i.getFilters().length>0);return e.length===1?e[0]:z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let c of a)pg(o,c),o=Zc(o,c)}(t._query,e),new _t(t.firestore,t.converter,Zc(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Tl=class n extends Sn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(r,s,o){if(r.startAt!==null)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vn(s,o)}(t._query,this._field,this._direction);return new _t(t.firestore,t.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new qt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(t._query,e))}};function p0(n,t="asc"){let e=t,i=Qo("orderBy",n);return Tl._create(i,e)}var Lo=class n extends Sn{constructor(t,e,i){super(),this.type=t,this._limit=e,this._limitType=i}static _create(t,e,i){return new n(t,e,i)}_apply(t){return new _t(t.firestore,t.converter,no(t._query,this._limit,this._limitType))}};function g0(n){return ig("limit",n),Lo._create("limit",n,"F")}function _0(n){return ig("limitToLast",n),Lo._create("limitToLast",n,"L")}var Bo=class n extends Sn{constructor(t,e,i){super(),this.type=t,this._docOrFields=e,this._inclusive=i}static _create(t,e,i){return new n(t,e,i)}_apply(t){let e=mg(t,this.type,this._docOrFields,this._inclusive);return new _t(t.firestore,t.converter,function(r,s){return new qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(t._query,e))}};function y0(...n){return Bo._create("startAt",n,!0)}function v0(...n){return Bo._create("startAfter",n,!1)}var jo=class n extends Sn{constructor(t,e,i){super(),this.type=t,this._docOrFields=e,this._inclusive=i}static _create(t,e,i){return new n(t,e,i)}_apply(t){let e=mg(t,this.type,this._docOrFields,this._inclusive);return new _t(t.firestore,t.converter,function(r,s){return new qt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(t._query,e))}};function w0(...n){return jo._create("endBefore",n,!1)}function I0(...n){return jo._create("endAt",n,!0)}function mg(n,t,e,i){if(e[0]=nt(e[0]),e[0]instanceof An)return function(s,o,a,c,u){if(!c)throw new y(p.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Jn(s))if(h.field.isKeyField())l.push(yn(o,c.key));else{let d=c.data.field(h.field);if(qo(d))throw new y(p.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new y(p.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new se(l,u)}(n._query,n.firestore._databaseId,t,e[0]._document,i);{let r=Dn(n.firestore);return function(o,a,c,u,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(p.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let I=0;I<l.length;I++){let v=l[I];if(d[I].field.isKeyField()){if(typeof v!="string")throw new y(p.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof v}`);if(!xl(o)&&v.indexOf("/")!==-1)throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${v}' contains a slash.`);let w=o.path.child(L.fromString(v));if(!b.isDocumentKey(w))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${w}' is not because it contains an odd number of segments.`);let C=new b(w);f.push(yn(a,C))}else{let w=ug(c,u,v);f.push(w)}}return new se(f,h)}(n._query,n.firestore._databaseId,r,t,e,i)}}function Cm(n,t,e){if(typeof(e=nt(e))=="string"){if(e==="")throw new y(p.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xl(t)&&e.indexOf("/")!==-1)throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let i=t.path.child(L.fromString(e));if(!b.isDocumentKey(i))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return yn(n,new b(i))}if(e instanceof tt)return yn(n,e._key);throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$o(e)}.`)}function km(n,t){if(!Array.isArray(n)||n.length===0)throw new y(p.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function pg(n,t){let e=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new y(p.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new y(p.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Uo=class{convertValue(t,e="none"){switch(_n(t)){case 0:return null;case 1:return t.booleanValue;case 2:return H(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Oe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw A()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let i={};return Rn(t,(r,s)=>{i[r]=this.convertValue(s,e)}),i}convertGeoPoint(t){return new Vr(H(t.latitude),H(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":let i=Cl(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(_r(t));default:return null}}convertTimestamp(t){let e=Me(t);return new J(e.seconds,e.nanos)}convertDocumentKey(t,e){let i=L.fromString(t);R(Ap(i));let r=new ii(i.get(1),i.get(3)),s=new b(i.popFirst(5));return r.isEqual(e)||X(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Ho(n,t,e){let i;return i=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,i}var bl=class extends Uo{constructor(t){super(),this.firestore=t}convertBytes(t){return new yi(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}};var fe=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ge=class extends An{constructor(t,e,i,r,s,o){super(t,e,i,r,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new ti(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let i=this._document.data.field(Qo("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}},ti=class extends Ge{data(t={}){return super.data(t)}},Ke=class{constructor(t,e,i,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new fe(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new ti(this._firestore,this._userDataWriter,i.key,i,new fe(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new y(p.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new ti(r._firestore,r._userDataWriter,a.doc.key,a.doc,new fe(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new ti(r._firestore,r._userDataWriter,a.doc.key,a.doc,new fe(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Cw(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Cw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A()}}function E0(n,t){return n instanceof Ge&&t instanceof Ge?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Ke&&t instanceof Ke&&n._firestore===t._firestore&&Sw(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function T0(n){n=j(n,tt);let t=j(n.firestore,W);return tg(yt(t),n._key).then(e=>nh(t,n,e))}var ye=class extends Uo{constructor(t){super(),this.firestore=t}convertBytes(t){return new yi(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new tt(this.firestore,null,e)}};function b0(n){n=j(n,tt);let t=j(n.firestore,W),e=yt(t),i=new ye(t);return yw(e,n._key).then(r=>new Ge(t,i,n._key,r,new fe(r!==null&&r.hasLocalMutations,!0),n.converter))}function A0(n){n=j(n,tt);let t=j(n.firestore,W);return tg(yt(t),n._key,{source:"server"}).then(e=>nh(t,n,e))}function S0(n){n=j(n,_t);let t=j(n.firestore,W),e=yt(t),i=new ye(t);return fg(n._query),eg(e,n._query).then(r=>new Ke(t,i,n,r))}function R0(n){n=j(n,_t);let t=j(n.firestore,W),e=yt(t),i=new ye(t);return vw(e,n._query).then(r=>new Ke(t,i,n,r))}function D0(n){n=j(n,_t);let t=j(n.firestore,W),e=yt(t),i=new ye(t);return eg(e,n._query,{source:"server"}).then(r=>new Ke(t,i,n,r))}function C0(n,t,e){n=j(n,tt);let i=j(n.firestore,W),r=Ho(n.converter,t,e);return Yo(i,[Wo(Dn(i),"setDoc",n._key,r,n.converter!==null,e).toMutation(n._key,Y.none())])}function k0(n,t,e,...i){n=j(n,tt);let r=j(n.firestore,W),s=Dn(r),o;return o=typeof(t=nt(t))=="string"||t instanceof ze?Zl(s,"updateDoc",n._key,t,e,i):Jl(s,"updateDoc",n._key,t),Yo(r,[o.toMutation(n._key,Y.exists(!0))])}function x0(n){return Yo(j(n.firestore,W),[new Ue(n._key,Y.none())])}function P0(n,t){let e=j(n.firestore,W),i=Aw(n),r=Ho(n.converter,t);return Yo(e,[Wo(Dn(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Y.exists(!1))]).then(()=>i)}function N0(n,...t){var e,i,r;n=nt(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||dl(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(dl(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),t[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let c,u,l;if(n instanceof tt)u=j(n.firestore,W),l=wi(n._key.path),c={next:h=>{t[o]&&t[o](nh(u,n,h))},error:t[o+1],complete:t[o+2]};else{let h=j(n,_t);u=j(h.firestore,W),l=h._query;let d=new ye(u);c={next:f=>{t[o]&&t[o](new Ke(u,d,h,f))},error:t[o+1],complete:t[o+2]},fg(n._query)}return function(d,f,I,v){let w=new gi(v),C=new xr(f,w,I);return d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return jl(yield _i(d),C)})),()=>{w.Qa(),d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return Ul(yield _i(d),C)}))}}(yt(u),l,a,c)}function V0(n,t){return ww(yt(n=j(n,W)),dl(t)?t:{next:t})}function Yo(n,t){return function(i,r){let s=new ot;return i.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return Zv(yield Yl(i),r,s)})),s.promise}(yt(n),t)}function nh(n,t,e){let i=e.docs.get(t._key),r=new ye(n);return new Ge(n,r,t._key,i,new fe(e.hasPendingWrites,e.fromCache),t.converter)}var kw={maxAttempts:5};var xm=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Dn(t)}set(t,e,i){this._verifyNotCommitted();let r=Pe(t,this._firestore),s=Ho(r.converter,e,i),o=Wo(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Y.none())),this}update(t,e,i,...r){this._verifyNotCommitted();let s=Pe(t,this._firestore),o;return o=typeof(e=nt(e))=="string"||e instanceof ze?Zl(this._dataReader,"WriteBatch.update",s._key,e,i,r):Jl(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Y.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Pe(t,this._firestore);return this._mutations=this._mutations.concat(new Ue(e._key,Y.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(p.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Pe(n,t){if((n=nt(n)).firestore!==t)throw new y(p.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Al=class extends class{constructor(e,i){this._firestore=e,this._transaction=i,this._dataReader=Dn(e)}get(e){let i=Pe(e,this._firestore),r=new bl(this._firestore);return this._transaction.lookup([i._key]).then(s=>{if(!s||s.length!==1)return A();let o=s[0];if(o.isFoundDocument())return new An(this._firestore,r,o.key,o,i.converter);if(o.isNoDocument())return new An(this._firestore,r,i._key,null,i.converter);throw A()})}set(e,i,r){let s=Pe(e,this._firestore),o=Ho(s.converter,i,r),a=Wo(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,a),this}update(e,i,r,...s){let o=Pe(e,this._firestore),a;return a=typeof(i=nt(i))=="string"||i instanceof ze?Zl(this._dataReader,"Transaction.update",o._key,i,r,s):Jl(this._dataReader,"Transaction.update",o._key,i),this._transaction.update(o._key,a),this}delete(e){let i=Pe(e,this._firestore);return this._transaction.delete(i._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Pe(t,this._firestore),i=new ye(this._firestore);return super.get(t).then(r=>new Ge(this._firestore,i,e._key,r._document,new fe(!1,!1),e.converter))}};function O0(n,t,e){n=j(n,W);let i=Object.assign(Object.assign({},kw),e);return function(s){if(s.maxAttempts<1)throw new y(p.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,o,a){let c=new ot;return s.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let u=yield pw(s);new cl(s.asyncQueue,u,a,o,c).Ya()})),c.promise}(yt(n),r=>t(new Al(n,r)),i)}function F0(){return new Mr("deleteField")}function L0(){return new gl("serverTimestamp")}function B0(...n){return new _l("arrayUnion",n)}function j0(...n){return new yl("arrayRemove",n)}function U0(n){return new vl("increment",n)}(function(t,e=!0){(function(r){vi=r})(bh),Di(new Ri("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new W(new kc(i.getProvider("auth-internal")),new Vc(i.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new y(p.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ii(u.options.projectId,l)}(o,r),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ue(xf,"4.5.1",t),ue(xf,"4.5.1","esm2017")})();export{Xr as a,Bw as b,vg as c,Ci as d,Ah as e,jw as f,fa as g,Uw as h,Yh as i,Xh as j,Zr as k,ts as l,ma as m,Yw as n,Dh as o,x_ as p,P_ as q,N_ as r,V_ as s,M_ as t,O_ as u,F_ as v,OT as w,QT as x,ie as y,HT as z,y as A,J as B,ct as C,b as D,XT as E,ii as F,Tw as G,j as H,bw as I,tt as J,t0 as K,e0 as L,Aw as M,n0 as N,Sw as O,i0 as P,r0 as Q,yt as R,s0 as S,o0 as T,a0 as U,c0 as V,u0 as W,l0 as X,h0 as Y,d0 as Z,yi as _,ze as $,Vr as aa,f0 as ba,m0 as ca,p0 as da,g0 as ea,_0 as fa,y0 as ga,v0 as ha,w0 as ia,I0 as ja,Uo as ka,Ge as la,ti as ma,Ke as na,E0 as oa,T0 as pa,b0 as qa,A0 as ra,S0 as sa,R0 as ta,D0 as ua,C0 as va,k0 as wa,x0 as xa,P0 as ya,N0 as za,V0 as Aa,Yo as Ba,xm as Ca,O0 as Da,F0 as Ea,L0 as Fa,B0 as Ga,j0 as Ha,U0 as Ia,aI as Ja,Lt as Ka,mI as La,Nn as Ma,jg as Na,Ug as Oa,tn as Pa,_I as Qa,tE as Ra,rs as Sa,jh as Ta,UE as Ua,qE as Va,zE as Wa,GE as Xa};
